<?php
/**
 * GForge Project Management Facility
 *
 * Copyright 2002 GForge, LLC
 * http://gforge.org/
 *
 * @version   $Id$
 */
/*

	Project/Task Manager
	By Tim Perdue, Sourceforge, 11/99
	Heavy rewrite by Tim Perdue April 2000

	Total rewrite in OO and GForge coding guidelines 12/2002 by Tim Perdue
*/

require_once('common/pm/ProjectGroup.class');

function pm_header($params) {
	global $group_id,$is_pm_page,$words,$group_project_id,$DOCUMENT_ROOT,$order,$pg, $Language;

	//required by site_project_header
	$params['group']=$group_id;
	$params['toptab']='pm';

	//only projects can use the bug tracker, and only if they have it turned on
	$project =& group_get_object($group_id);
	if (!$project || !is_object($project)) {
		exit_no_group();
	}   

	if (!$project->usesPm()) {
		exit_error($Language->getText('general','error'),$Language->getText('pm_include_grouphtml','error_disabled'));
	}

	site_project_header($params);

	if ($pg) {
		echo "<h3>".$Language->getText('pm_include_grouphtml','project').": ". $pg->getName() ."</h3>";
	}
	echo "<p><strong>";

	if ($group_project_id) {
		if (session_loggedin()) {
			echo "<a href=\"/pm/task.php?group_id=$group_id&group_project_id=$group_project_id&func=addtask\">".$Language->getText('pm_include_grouphtml','add_task')."</a> | ";
		}
		echo "<a href=\"/pm/task.php?group_id=$group_id&group_project_id=$group_project_id&func=browse\">".$Language->getText('pm_include_grouphtml','browse_task')."</a> | ";
		echo "<a href=\"/pm/task.php?group_id=$group_id&group_project_id=$group_project_id&func=ganttpage\" target=\"_blank\">".$Language->getText('pm_include_grouphtml','gantt_chart')."</a> | ";
	}
	echo '
		<a href="/pm/reporting/?group_id='.$group_id.'">'.$Language->getText('pm_include_grouphtml','reporting').'</a> | 
		<a href="/pm/admin/?group_id='.$group_id.'">'.$Language->getText('pm_include_grouphtml','admin').'</a> </strong>';
}

function pm_footer($params) {
	site_project_footer($params);
}

class ProjectGroupHTML extends ProjectGroup {

	function ProjectGroupHTML(&$Group, $group_project_id=false, $arr=false) {
		if (!$this->ProjectGroup($Group,$group_project_id,$arr)) {
			return false;
		} else {
			return true;
		}
	}

	function statusBox($name='status_id',$checked='xyxy',$text_100='None') {
		return html_build_select_box($this->getStatuses(),$name,$checked,true,$text_100);
	}

	function categoryBox($name='category_id',$checked='xzxz') {
		return html_build_select_box($this->getCategories(),$name,$checked);
	}

	function percentCompleteBox($name='percent_complete',$selected=0) {
		global $Language;
		echo '
		<select name="'.$name.'">';
		echo '
		<option value="0">'.$Language->getText('pm_include_grouphtml','not_started');
		for ($i=5; $i<101; $i+=5) {
			echo '
			<option value="'.$i.'"';
			if ($i==$selected) {
				echo ' SELECTED';
			}	
			echo '>'.$i.'%';
		}
		echo '
		</select>';
	}

	function showMonthBox($name,$select_month=0) {
		global $Language;
		echo '
		<select name="'.$name.'" size="1">';
		$monthlist = array(
			'1'=>$Language->getText('calendar','january'),
			'2'=>$Language->getText('calendar','february'),
			'3'=>$Language->getText('calendar','march'),
			'4'=>$Language->getText('calendar','april'),
			'5'=>$Language->getText('calendar','may'),
			'6'=>$Language->getText('calendar','june'),
			'7'=>$Language->getText('calendar','july'),
			'8'=>$Language->getText('calendar','august'),
			'9'=>$Language->getText('calendar','september'),
			'10'=>$Language->getText('calendar','october'),
			'11'=>$Language->getText('calendar','november'),
			'12'=>$Language->getText('calendar','december'));

		for ($i=1; $i<=count($monthlist); $i++) {
			if ($i == $select_month) {
				echo '
				<option selected value="'.$i.'">'.$monthlist[$i];
			} else {
				echo '
				<option value="'.$i.'">'.$monthlist[$i];
			}
		}
		echo '
		</SELECT>';
	}

	function showDayBox($name,$day=1) {
		echo '
		<select name="'.$name.'" size="1">';
		for ($i=1; $i<=31; $i++) {
			if ($i == $day) {
				echo '
				<option selected value="'.$i.'">'.$i;
			} else {
				echo '
				<option value="'.$i.'">'.$i;
			}
		}
		echo '
		</select>';
	}

	function showYearBox($name,$year=1) {
		echo '
		<select name="'.$name.'" size="1">';
		for ($i=1999; $i<=2013; $i++) {
			if ($i == $year) {
				echo '
				<option selected value="'.$i.'">'.$i;
			} else {
				echo '
				<option value="'.$i.'">'.$i;
			}
		}
		echo '
		</select>';
	}

	function showHourBox($name,$hour=1) {

		echo '
		<select name="'.$name.'" size="1">';
		for ($i=0; $i<=23; $i++) {
			if ($i == $hour) {
				echo '
				<option selected value="'.$i.'">'.$i;
			} else {
				echo '
				<option value="'.$i.'">'.$i;
			}
		}
		echo '
		</select>';
	}

	function showMinuteBox($name,$minute=0) {
		echo '	<select name="'.$name.'" size="1">';
		for ($i=0; $i<=45; $i=$i+15) {
			if ($i == $minute) {
				echo '	<option selected value="'.$i.'">'.$i;
			} else {
				echo '
				<option value="'.$i.'">'.$i;
			}
		}
		echo '
		</select>';
	}


	function showbrowseList($pt_arr){
		global $Language;
		global $group_id;
		global $group_project_id;

		$title_arr = array();
		$title_arr[] = $Language->getText('pm','task_id');
		$title_arr[] = $Language->getText('pm','summary');
		$title_arr[] = $Language->getText('pm','start_date');
		$title_arr[] = $Language->getText('pm','end_date');
		$title_arr[] = $Language->getText('pm','percent_complete');
		

		$rows=count($pt_arr);
		echo $GLOBALS['HTML']->listTableTop ($title_arr);
		$now=time();

		for ( $i = 0; $i < $rows; $i++ ) {

			
		
			echo '
			<tr bgcolor="'.html_get_priority_color( $pt_arr[$i]->getPriority() ).'">'.
			'<td><a href="/pm/task.php?func=detailtask'.
			'&project_task_id='. $pt_arr[$i]->getID() .
			'&group_id='.$group_id.
			'&group_project_id='. $group_project_id .'">'.
			$pt_arr[$i]->getID() .'</a></td>'.
			'<td>'. $pt_arr[$i]->getSummary() .'</td>'.
			'<td>'.date('Y-m-d', $pt_arr[$i]->getStartDate() ).'</td>'.
			'<td>'. (($now>$pt_arr[$i]->getEndDate() )?'<strong>* ':'&nbsp; ') .
				date('Y-m-d',$pt_arr[$i]->getEndDate() ).'</td>'.
			'<td>'. $pt_arr[$i]->getPercentComplete() .'%</td></tr>';

		       
			
		}
		
		echo $GLOBALS['HTML']->listTableBottom();

	



	}

}

?>
