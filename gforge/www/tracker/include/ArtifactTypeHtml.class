<?php
/**
  *
  * SourceForge Generic Tracker facility
  *
  * SourceForge: Breaking Down the Barriers to Open Source Development
  * Copyright 1999-2001 (c) VA Linux Systems
  * http://sourceforge.net
  *
  * @version   $Id$
  *
  */


require_once('common/tracker/ArtifactType.class');

class ArtifactTypeHtml extends ArtifactType {

	/**
	 *  ArtifactType() - constructor
	 *
	 *  @param $Group object
	 *  @param $artifact_type_id - the id # assigned to this artifact type in the db
	 */
	function ArtifactTypeHtml(&$Group,$artifact_type_id=false, $arr=false) {
		return $this->ArtifactType($Group,$artifact_type_id,$arr);
	}

	function header($params) {
		global $DOCUMENT_ROOT, $HTML, $Language, $sys_use_tracker;
		if (!$sys_use_tracker) {
			exit_disabled();
		}
		$group_id= $this->Group->getID();

		//required by new site_project_header
		$params['group']=$group_id;
		$params['toptab']='tracker';
		$params['tabtext']=$this->getName();

		site_project_header($params);

		$labels = array();
		$links  = array();

		$labels[] = $Language->getText('group','short_tracker');
		$links[]  = '/tracker/?group_id='.$group_id;

		$labels[] = $Language->getText('tracker_artifacttype','submit_new');
		$links[]  = '/tracker/?func=add&group_id='.$group_id.'&atid='. $this->getID();
		$labels[] = $Language->getText('tracker_artifacttype','browse');
		$links[]  = '/tracker/?func=browse&group_id='.$group_id.'&atid='. $this->getID();

		if (session_loggedin()) {
			$labels[] = $Language->getText('tracker_artifacttype','reporting');
			$links[]  = '/tracker/reporting/?group_id='.$group_id.'&atid='. $this->getID();
		}
		$labels[] = $Language->getText('tracker_artifacttype','admin');
		$links[]  = '/tracker/admin/?group_id='.$group_id;

		echo $HTML->subMenu($labels,$links);

		echo '<h3>'.$Language->getText('tracker', 'pagetitle').': <a href="/tracker/?group_id='.$group_id.'&atid='.$this->getID().'">'.$this->getName().'</a></h3><p>';
	}

	function footer($params) {
		site_project_footer($params);
	}

	function adminHeader($params) {
		global $Language;
		echo $this->header($params);
		$group_id= $this->Group->getID();
		echo '<strong>'.$Language->getText('tracker_artifacttype','admin_functions').': <a href="/tracker/admin/?group_id='.$group_id.'">'.$Language->getText('tracker_artifacttype','add_artifact_types').'</a>';
		echo ' | <a href="/tracker/admin/?group_id='.$group_id.'&atid='. $this->getID() .'">'.$Language->getText('tracker_artifacttype','edit_options').': '. $this->getName() .'</a></strong>';
	}
	/**
	 *	buildPopUpBoxes - presents the pop-up boxes and choices  
	 *	configured by the admin
	 */
	 	function buildPopUpBoxes () {
			global $Language, $group_id;
   			$result=$this->getSelectionBoxes(); 
			echo "<p>&nbsp;</p>";
   			$rows=db_numrows($result);
			if ($result &&$rows > 0) {
				echo '<tr>';
				for ($i=0; $i < $rows; $i++) {
				$newrow= is_integer($i/2);
				echo '<td><strong>'.db_result($result,$i,'selection_box_name').'</strong><br \>';
				echo $this->selectionBox(db_result($result,$i,'id'));
				echo '&nbsp;<a href="/tracker/admin/?group_id='.$group_id.'&amp;atid='. $this->getID() . '&amp;build_box=1">('.$Language->getText('tracker','admin').')</a>';
				if (!$newrow) {
					echo '</tr><tr>';
				}
			}
		}
	}
	/**
	 *	selectionBox - this function builds pop up
	 *	box with choices.
	 *	
	 *	@param		int 	The result set
	 *	@param 		string	The item that should be checked
	 *	@param		string	What to call the '100 row'
	 *	@return		box and choices	
	 */	
	function selectionBox ($name,$checked='xzxz',$text_100='none') {
		global $Language;
		if ($text_100 == 'none'){
			$text_100=$Language->getText('tracker_artifacttype','none');
		}
		return html_build_select_box ($this->getSelectionBoxOptions($name),'extra_fields_choice[]',$checked,true,$text_100);
	}

	function categoryBox ($name='category_id',$checked='xzxz',$text_100='none') {
		global $Language;
		if ($text_100 == 'none'){
			$text_100=$Language->getText('tracker_artifacttype','none');
		}
		return html_build_select_box ($this->getCategories(),$name,$checked,true,$text_100);
	}

	function artifactGroupBox ($name='artifact_group_id',$checked='xzxz',$text_100='none') {
		global $Language;
		if ($text_100=='none'){
			$text_100=$Language->getText('tracker_artifacttype','none');
		}
		return html_build_select_box ($this->getGroups(),$name,$checked,true,$text_100);
	}

	function technicianBox ($name='assigned_to',$checked='xzxz',$show_100=true,$text_100='none',$extra_id='',$extra_name='') {
		global $Language;
		if ($text_100=='none'){
			$text_100=$Language->getText('tracker_artifacttype','nobody');
		}
		$result = $this->getTechnicians();
		//	this was a bad hack to allow you to mass-update to unassigned, which is ID=100, which 
		//	conflicted with the "No Change" ID of 100.
		$ids =& util_result_column_to_array($result,0);
		$names =& util_result_column_to_array($result,1);
		if ($extra_id) {
			$ids[]=$extra_id;
			$names[]=$extra_name;
		}
		return html_build_select_box_from_arrays ($ids,$names,$name,$checked,$show_100,$text_100);
	}

	function cannedResponseBox ($name='canned_response',$checked='xzxz') {
		return html_build_select_box ($this->getCannedResponses(),$name,$checked);
	}

	function statusBox ($name='status_id',$checked='xzxz',$show_100=false,$text_100='none') {
		global $Language;
		if ($text_100=='none'){
			$text_100=$Language->getText('tracker_artifacttype','none');
		}
		return html_build_select_box($this->getStatuses(),$name,$checked,$show_100,$text_100);
	}

	function resolutionBox ($name='resolution_id',$checked='xzxz',$show_100=false,$text_100='none') {
		global $Language;
		if ($text_100=='none'){
			$text_100=$Language->getText('tracker_artifacttype','none');
		}
		return html_build_select_box($this->getResolutions(),$name,$checked,$show_100,$text_100);
	}

}

?>
