***************
*** 19,154 ****
  
  class Layout extends Error {
  
- 	/**
- 	 * The root location for images
- 	 *
- 	 * @var		string	$imgroot
- 	 */
- 	var $imgroot = '/themes/forged/images/';
- 
- 	// Color Constants
- 	/**
- 	 * The content background color
- 	 *
- 	 * @var		constant		$COLOR_CONTENT_BACK
- 	 */
  	var $COLOR_CONTENT_BACK= '#FFFFFF';
- 
- 	/**
- 	 * The primary light background color
- 	 *
- 	 * @var		constant		$COLOR_LTBACK1
- 	 */
  	var $COLOR_LTBACK1= '#EAECEF';
- 
- 	/**
- 	 * The secondary light background color
- 	 *
- 	 * @var		constant		$COLOR_LTBACk2
- 	 */
  	var $COLOR_LTBACK2= '#FAFAFA';
- 	
- 	/**
- 	 * The HTML box title color
- 	 *
- 	 * @var		constant		$COLOR_HTMLBOX_TITLE
- 	 */
  	var $COLOR_HTMLBOX_TITLE = '#D1D5D7';
- 
- 	/**
- 	 * The HTML box background color
- 	 *
- 	 * @var		constant		$COLOR_HTMLBOX_BACK
- 	 */
  	var $COLOR_HTMLBOX_BACK = '#EAECEF';
- 
- 	// Font Face Constants
- 	/**
- 	 * The content font
- 	 *
- 	 * @var		constant		$FONT_CONTENT
- 	 */
  	var $FONT_CONTENT = 'Helvetica';
- 
- 	/**
- 	 * The HTML box title font
- 	 *
- 	 * @var		constant		$FONT_HTMLBOX_TITLE
- 	 */
  	var $FONT_HTMLBOX_TITLE = 'Helvetica';
- 
- 	// Font Color Constants
- 	/**
- 	 * The HTML box title font color
- 	 *
- 	 * @var		constant		$FONTCOLOR_HTMLBOX_TITLE
- 	 */
  	var $FONTCOLOR_HTMLBOX_TITLE = '#333333';
- 
- 	/**
- 	 * The content font color
- 	 *
- 	 * @var		constant		$FONTCOLOR_CONTENT
- 	 */
  	var $FONTCOLOR_CONTENT = '#333333';
- 
- 	// Font Size Constants
- 	/**
- 	 * The font size
- 	 *
- 	 * @var		constant		$FONTSIZE
- 	 */
  	var $FONTSIZE = 'small';
- 
- 	/**
- 	 * The smaller font size
- 	 *
- 	 * @var		constant		$FONTSIZE_SMALLER
- 	 */
  	var $FONTSIZE_SMALLER='x-small';
- 
- 	/**
- 	 * The smallest font size
- 	 *
- 	 * @var		constnat		$FONTSIZE_SMALLEST
- 	 */
  	var $FONTSIZE_SMALLEST='xx-small';
- 
- 	/**
- 	 * The HTML box title font size
- 	 *
- 	 * @var		constant		$FONTSIZE_HTMLBOX_TITLE
- 	 */
  	var $FONTSIZE_HTMLBOX_TITLE = 'small';
- 
- 	//Define all the icons for this theme
- 	/**
- 	 * Icons array
- 	 *
- 	 * @var		array	$icons
- 	 */
- 	var $icons = array(
- 		'Summary' => '/images/ic/anvil24.png',
- 		'Admin' => '/images/ic/anvil24.png',
- 		'Homepage' => '/images/ic/home.png',
- 		'Forums' => '/images/ic/notes.png',
- 		'Bugs' => '/images/ic/bug.png',
- 		'Support' => '/images/ic/support.png',
- 		'Patches' => '/images/ic/patch.png',
- 		'Lists' => '/images/ic/mail.png',
- 		'Tasks' => '/images/ic/index.png',
- 		'Docs' => '/images/ic/docman.png',
- 		'Surveys' => '/images/ic/survey.png',
- 		'News' => '/images/ic/news.png',
- 		'CVS' => '/images/ic/convert.png',
- 		'Files' => '/images/ic/save.png'
- 		);
- 
- 	/**
- 	 * Hell if I know?
- 	 *
- 	 * @var		array	$bgpri
- 	 */
  	var $bgpri = array();
  
  	/**
--- 19,38 ----
  
  class Layout extends Error {
  
+ 	var $imgroot = '/images/';
  	var $COLOR_CONTENT_BACK= '#FFFFFF';
  	var $COLOR_LTBACK1= '#EAECEF';
  	var $COLOR_LTBACK2= '#FAFAFA';
  	var $COLOR_HTMLBOX_TITLE = '#D1D5D7';
  	var $COLOR_HTMLBOX_BACK = '#EAECEF';
  	var $FONT_CONTENT = 'Helvetica';
  	var $FONT_HTMLBOX_TITLE = 'Helvetica';
  	var $FONTCOLOR_HTMLBOX_TITLE = '#333333';
  	var $FONTCOLOR_CONTENT = '#333333';
  	var $FONTSIZE = 'small';
  	var $FONTSIZE_SMALLER='x-small';
  	var $FONTSIZE_SMALLEST='xx-small';
  	var $FONTSIZE_HTMLBOX_TITLE = 'small';
  	var $bgpri = array();
  
  	/**
***************
*** 207,399 ****
  	}
  
  	/**
- 	 * box1_top() - Box Top, equivalent to html_box1_top()
- 	 *
- 	 * @param	string	The box top title
- 	 * @param	bool	Whether to echo or return the output
- 	 * @param	string	The box top background color
- 	 * @param	bool	Whether to start the first row or not
- 	 */
- 	function box1_top($title,$echoout=1,$bgcolor='',$start_first_row=1){
- 		if (!$bgcolor) {
- 			$bgcolor=$this->COLOR_HTMLBOX_BACK;
- 		}
- 		$return = '<TABLE cellspacing="1" cellpadding="5" width="100%" border="0" bgcolor="'.$this->COLOR_HTMLBOX_BACK.'">
- 			<TR BGCOLOR="'.$this->COLOR_HTMLBOX_TITLE.'" BACKGROUND="'.$GLOBALS['sys_images_url'].$this->imgroot.'steel3.jpg" align="center">
- 				<TD colspan=2><SPAN class=titlebar>'.$title.'</SPAN></TD>
- 			</TR>';
- 
- 		//backwards compatibility hack
- 		//many places assumed the row would be started
- 		if ($start_first_row) {
- 			$return .= '<TR align=left bgcolor="'.$bgcolor.'">
- 				<TD colspan=2>';
- 		}
- 		if ($echoout) {
- 			print $return;
- 		} else {
- 			return $return;
- 		}
- 	}
- 
- 	/**
- 	 * box1_middle() - Box Middle, equivalent to html_box1_middle()
- 	 *
- 	 * @param	string	The box title
- 	 * @param	string	The box background color
- 	 * @param	string  The title background color
- 	 * @param	bool	Whether to start the first row or not
- 	 * @returns	Middle box HTML content
- 	 */
- 	function box1_middle($title,$bgcolor='',$title_bgcolor='',$start_first_row=1) {
- 		if (!$bgcolor) {
- 			$bgcolor=$this->COLOR_HTMLBOX_BACK;
- 		}
- 		if (!$title_bgcolor) {
- 			$title_bgcolor=$this->COLOR_HTMLBOX_BACK;
- 			$title_bgimg=$GLOBALS['sys_images_url'] . $this->imgroot . 'steel3.jpg';
- 		}
- 		$return = '
- 				</TD>
- 			</TR>
- 			<TR BGCOLOR="' . $title_bgcolor . '" align="center" background="' . $title_bgimg . '">
- 				<TD colspan=2><SPAN class=titlebar>'.$title.'</SPAN></TD>
- 			</TR>';
- 
- 		//backwards compatibility hack
- 		//many places assumed the row would be finished up
- 		if ($start_first_row) {
- 			$return .= '<TR align=left bgcolor="'.$bgcolor.'">
- 				<TD colspan=2>';
- 		}
- 		return $return;
- 	}
- 
- 	/**
- 	 * box1_bottom() - Box Bottom, equivalent to html_box1_bottom()
- 	 *
- 	 * @param	bool	Whether to echo or return the output
- 	 */
- 	function box1_bottom($echoout=1) {
- 		$return = '
- 		</TD>
- 			</TR>
- 	</TABLE>
- ';
- 		if ($echoout) {
- 			print $return;
- 		} else {
- 			return $return;
- 		}
- 	}
- 
- 	/**
- 	 * generic_header_start() - Start a generic HTML header
  	 *
  	 * @param	array	Header parameters array
  	 */
- 	function generic_header_start($params) {
  
- 		global $G_SESSION, $Language, $sys_name;
  
  		if (!$params['title']) {
- 			$params['title'] = "SourceForge";
  		} else {
- 			$params['title'] = "SourceForge: " . $params['title'];
  		}
  		?>
- <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
- 	"http://www.w3.org/TR/REC-html40/loose.dtd">
  
- <!-- Server: <?php echo $sys_name; ?> -->
  <html lang="<?php echo $Language->getLanguageCode(); ?>">
    <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=<?php echo $Language->getEncoding(); ?>">
-     <TITLE><?php echo $params['title']; ?></TITLE>
  	<SCRIPT language="JavaScript">
  	<!--
  	function help_window(helpurl) {
- 		HelpWin = window.open( '<?php echo ((session_issecure()) ? 'https://'.$GLOBALS['sys_default_domain'] : 'http://'.$GLOBALS['sys_default_domain'] ); ?>' + helpurl,'HelpWindow','scrollbars=yes,resizable=yes,toolbar=no,height=400,width=400');
  	}
  	// -->
  	</SCRIPT>
  <?php
- 	}
- 
- 	/**
- 	 * generic_header_end() - End a generic HTML header
- 	 *
- 	 * @param	array	Header parameters array
- 	 */
- 	function generic_header_end($params) {
- 	?>
-    </HEAD>
- <?php
- 	}
- 
- 	/**
- 	 * generic_footer() - Display a generic HTML footer
- 	 *
- 	 * @param	array	Footer parameters array
- 	 */
- 	function generic_footer($params) {
- 		global $PHP_SELF, $sys_name;
- 		echo '<P><A HREF="/source.php?page_url='.$PHP_SELF.'"><B><FONT COLOR="WHITE">Show Source</FONT></B></A><P>';
- 
- 		global $IS_DEBUG,$QUERY_COUNT;
- 		if ($IS_DEBUG && user_isloggedin() && user_ismember(1,'A')) {
- 			echo "<CENTER><B><FONT COLOR=RED>Server: $sys_name</FONT ></B></CENTER>";
- 			echo "<CENTER><B><FONT COLOR=RED>Query Count: $QUERY_COUNT</FONT ></B></CENTER>";
- 			echo "<P>$GLOBALS[G_DEBUGQUERY]";
- 		}
- 
- 		?>
- <P class="footer">
- <font face="arial, helvetica" size="1" color="#cccccc">
- VA Linux Systems and SourceForge are trademarks of VA Linux Systems, Inc.
- Linux is a registered trademark of Linus Torvalds.  All other trademarks and
- copyrights on this page are property of their respective owners.
- For information about other site Content ownership and sitewide
- terms of service, please see the
- <a href="/tos/tos.php" class="legallink">SourceForge Terms of Service</a>.
- For privacy
- policy information, please see the <a href="/tos/privacy.php" class="legallink"
- >SourceForge Privacy Policy</a>.
- Content owned by VA Linux Systems is copyright 
- 1999-2001 VA Linux Systems, Inc.  All rights reserved.
- </font>
- <BR>&nbsp;
- 
- <?php
- 
- //
- //  Actual layer call must be outside of table for some reason
- //
- 
- if (!session_issecure() && !$GLOBALS['IS_DEBUG']) {
- 
- echo '
- <LAYER SRC="http://sfads.osdn.com/1.html" width=468 height=60 visibility=\'hide\' '.
- 'onLoad="moveToAbsolute(adlayer.pageX,adlayer.pageY); clip.height=60; clip.width=468; visibility=\'show\';"></LAYER>';
- 
- }
- 
- ?>
- 
- </body>
- </html>
- 	<?php
- 	}
- 
- 	/**
- 	 *	header() - "steel theme" top of page
- 	 *
- 	 * @param	array	Header parameters array
- 	 */
- 	function header($params) {
- 		global $Language;
- 
- 		$this->generic_header_start($params); 
  /*
  
  
--- 91,126 ----
  	}
  
  	/**
+ 	 *	header() - "steel theme" top of page
  	 *
  	 * @param	array	Header parameters array
  	 */
+ 	function header($params) {
+ 		global $Language;
  
+ 		$imgroot=$this->imgroot;
  
  		if (!$params['title']) {
+ 			$params['title'] = "GForge";
  		} else {
+ 			$params['title'] = "GForge: " . $params['title'];
  		}
  		?>
+ <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
  
  <html lang="<?php echo $Language->getLanguageCode(); ?>">
    <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=<?php echo $Language->getEncoding(); ?>">
+ 	<TITLE><?php echo $params['title']; ?></TITLE>
  	<SCRIPT language="JavaScript">
  	<!--
  	function help_window(helpurl) {
+ 		HelpWin = window.open( '<?php echo ((session_issecure()) ? 'https://'.
+ 			$GLOBALS['sys_default_domain'] : 'http://'.$GLOBALS['sys_default_domain']); ?>' + helpurl,'HelpWindow','scrollbars=yes,resizable=yes,toolbar=no,height=400,width=400');
  	}
  	// -->
  	</SCRIPT>
  <?php
  /*
  
  
***************
*** 410,418 ****
  
  	?>
  
- 		<link rel="SHORTCUT ICON" href="/images/favicon.ico">
- 		<style type="text/css">
- 			<!--
  	OL,UL,P,BODY,TD,TR,TH,FORM { font-family: <?php echo $site_fonts; ?>; font-size:<?php echo $this->FONTSIZE; ?>; color: <?php echo $this->FONTCOLOR_CONTENT ?>; }
  
  	H1 { font-size: x-large; font-family: <?php echo $site_fonts; ?>; }
--- 137,144 ----
  
  	?>
  
+ <style type="text/css">
+ 	<!--
  	OL,UL,P,BODY,TD,TR,TH,FORM { font-family: <?php echo $site_fonts; ?>; font-size:<?php echo $this->FONTSIZE; ?>; color: <?php echo $this->FONTCOLOR_CONTENT ?>; }
  
  	H1 { font-size: x-large; font-family: <?php echo $site_fonts; ?>; }
***************
*** 424,535 ****
  
  	PRE,TT { font-family: courier,sans-serif }
  
- 	SPAN.center { text-align: center }
- 	SPAN.boxspace { font-size: 2pt; }
- 	SPAN.osdn {font-size: <?php echo $this->FONTSIZE_SMALLER; ?>; font-family: <?php echo $site_fonts ?>;}
- 	SPAN.search {font-size: <?php echo $this->FONTSIZE_SMALLER; ?>; font-family:  <?php echo $site_fonts ?>;}
- 	SPAN.slogan {font-size: large; font-weight: bold; font-family: <?php echo $site_fonts; ?>;}
- 	SPAN.footer {font-size: <?php echo $this->FONTSIZE_SMALLER; ?>; font-family: <?php echo $site_fonts; ?>;}
- 
- 	A.maintitlebar { color: #FFFFFF }
- 	A.maintitlebar:visited { color: #FFFFFF }
- 
- 	A.sortbutton { color: #FFFFFF; text-decoration: underline; }
- 	A.sortbutton:visited { color: #FFFFFF; text-decoration: underline; }
- 
- 	.menus { color: #6666aa; text-decoration: none; }
- 	.menus:visited { color: #6666aa; text-decoration: none; }
- 
  	A:link { text-decoration:none }
  	A:visited { text-decoration:none }
  	A:active { text-decoration:none }
  	A:hover { text-decoration:underline; color:#FF0000 }
  
- 	.tabs { color: #000000; }
- 	.tabs:visited { color: #000000; }
- 	.tabs:hover { color:#FF0000; }
- 	.tabselect { color: #000000; font-weight: bold; }
- 	.tabselect:visited { font-weight: bold;}
- 	.tabselect:hover { color:#FF0000; font-weight: bold; }
- 
- 	.titlebar { text-decoration:none; color:#000000; font-family: <?php echo $this->FONT_HTMLBOX_TITLE . ',' . $site_fonts; ?>; font-size: <?php echo $this->FONTSIZE_HTMLBOX_TITLE; ?>; font-weight: bold; }
- 	.develtitle { color:#000000; font-weight: bold; }
- 	.legallink { color:#000000; font-weight: bold; }
- 			-->
- 		</style>
  
-  	<?php
- 	$this->generic_header_end($params); 
- ?>
- <body text="#333333" link="#6666aa" alink="#aa6666" vlink="#6666aa" bgcolor="#6C7198" leftmargin="0" rightmargin="0" topmargin="0" bottommargin="0" marginwidth="0" marginheight="0">
  
  <?php
  
- /*
  
- 	OSDN NAV BAR
  
- */
  
- osdn_print_navbar();
  
- echo html_blankimage(5,100);
- ?>
- <br>
- <!-- start page body -->
- <div align="center">
- <table cellpadding="0" cellspacing="0" border="0" width="99%">
- 	<tr>
- 		<td background="<?php echo $GLOBALS['sys_images_url'] . $this->imgroot; ?>tbar1.png" width="1%" height="17"><?php echo html_image($this->imgroot . "tleft1.png","17","17",array()); ?></td>
- 		<td background="<?php echo $GLOBALS['sys_images_url'] . $this->imgroot; ?>tbar1.png" align="center" colspan="3" width="99%"><?php echo html_image($this->imgroot . "tbar1.png","1","17",array()); ?></td>
- 		<td><?php echo html_image($this->imgroot . "tright1.png","17","17",array()); ?></td>
- 	</tr>
- 	<tr>
- 		<td width="17" background="<?php echo $GLOBALS['sys_images_url'] . $this->imgroot; ?>leftbar1.png" align="left" valign="bottom"><?php echo html_image($this->imgroot . "leftbar1.png","17","25",array()); ?></td>
- 		<td colspan="3" bgcolor="#ffffff">
- <!-- start main body cell -->
- 
- 	<table cellpadding="0" cellspacing="0" border="0" width="100%">
- 		<tr>
- 			<td width="141" background="<?php echo $GLOBALS['sys_images_url'] . $this->imgroot; ?>steel3.jpg" bgcolor="#cfd1d4" align="left" valign="top">
  
- 	<!-- VA Linux Stats Counter -->
- 	<?php
- 	if (!session_issecure()) {
- 		print '<IMG src="http://www2.valinux.com/clear.gif?id=105" width=140 height=1 alt="Counter"><BR>';
- 	} else {
- 		print '<IMG src="https://www2.valinux.com/clear.gif?id=105" width=140 height=1 alt="Counter"><BR>';
- 	}
- 	?>
  
- 	<CENTER>
- 	<a href="/"><?php echo html_image($this->imgroot . "sflogo-hammer1.jpg","136","79",array()); ?></A>
- 	</CENTER>
- 	<P>
- 	<!-- menus -->
- 	<?php
- 	//html_blankimage(1,140);
- 	menu_print_sidebar($params);
- 	?>
- 	<P>
- 	</TD>
  
- 	<td width="20" background="<?php echo $GLOBALS['sys_images_url'] . $this->imgroot; ?>fade1.png" nowrap>&nbsp;</td>
- 	<td valign="top" bgcolor="<?php echo $this->COLOR_CONTENT_BACK; ?>" width="99%">
- 	<BR>
  
  	<?php
  
  	if ($params['titlevals']) {
- 		$title =        $Language->getText($params['pagename'],'title',$params['titlevals']);
  	} else {
- 		$title =        $Language->getText($params['pagename'],'title');
  	}
  
  	if ($params['sectionvals']) {
- 		$section =      $Language->getText($params['pagename'],'section',$params['sectionvals']);
  	} else {
- 		$section =      $Language->getText($params['pagename'],'section');
  	}
  
  	if ($section) {
--- 150,287 ----
  
  	PRE,TT { font-family: courier,sans-serif }
  
  	A:link { text-decoration:none }
  	A:visited { text-decoration:none }
  	A:active { text-decoration:none }
  	A:hover { text-decoration:underline; color:#FF0000 }
  
+ 	.titlebar { color: #000000; text-decoration: none; font-weight: bold; }
+ 	A.tablink { color: #000000; text-decoration: none; font-weight: bold; font-size: <?php echo $font_smaller; ?>; }
+ 	A.tablink:visited { color: #000000; text-decoration: none; font-weight: bold; font-size: <?php
+ 		echo $font_smaller; ?>; }
+ 	A.tablink:hover { text-decoration: none; color: #000000; font-weight: bold; font-size: <?php
+ 		echo $font_smaller; ?>; }
+ 	A.tabsellink { color: #000000; text-decoration: none; font-weight: bold; font-size: <?php
+ 		echo $font_smaller; ?>; }
+ 	A.tabsellink:visited { color: #000000; text-decoration: none; font-weight: bold; font-size: <?php
+ 		echo $font_smaller; ?>; }
+ 	A.tabsellink:hover { text-decoration: none; color: #000000; font-weight: bold; font-size: <?php
+ 		echo $font_smaller; ?>; }
+ 	-->
+ </style>
+ 
+ </head>
+ 
+ <BODY TOPMARGIN="3" MARGINHEIGHT="3" MARGINWIDTH="3" LEFTMARGIN="3" RIGHTMARGIN="3" BGCOLOR="#01004e">
+ 
+ <TABLE BORDER=0 WIDTH="100%" CELLSPACING="0" CELLPADDING=0>
+ 
+ 	<TR>
+ 		<TD><A HREF="/"><?php echo html_image($imgroot.'logo.gif',190,49,array('border'=>'0')); ?></A></TD>
+ 		<TD><?php echo $this->searchBox(); ?></TD>
+ 		<TD ALIGN="RIGHT"><?php
+ 			if (session_loggedin()) {
+ 				?>
+ 				<A HREF="/account/logout.php"><?php echo html_image($imgroot.'logout.gif',
+ 					74,14,array('BORDER'=>'0')); ?></A><BR>
+ 				<A HREF="/account/"><?php echo html_image($imgroot.'myaccount.gif'
+ 					,74,14,array('BORDER'=>'0')); ?></A>
+ 				<?php
+ 			} else {
+ 				?>
+ 				<A HREF="/account/"><?php echo html_image($imgroot.'login.gif'
+ 					,74,14,array('BORDER'=>'0')); ?></A><BR>
+ 				<A HREF="/account/register.php"><?php echo html_image($imgroot.'newaccount.gif'
+ 					,74,14,array('BORDER'=>'0')); ?></A>
+ 				<?php
+ 			}
+ 
+ 		?></TD>
+ 		<TD>&nbsp;&nbsp;</TD>
+ 	</TR>
  
+ </TABLE>
+ 
+ <TABLE BORDER=0 WIDTH="100%" CELLSPACING="0" CELLPADDING=0>
+ 
+ 	<TR>
+ 		<TD>&nbsp;</TD>
+ 		<TD>&nbsp;</TD>
+ 
+ 		<TD>
+ 
+ <?php echo $this->outerTabs($params); ?>
+ 
+ 		</TD>
+ 
+ 		<TD>&nbsp;</TD>
+ 		<TD>&nbsp;</TD>
+ 	</TR>
+ 
+ 	<TR>
+ 		<TD ALIGN=LEFT BGCOLOR="#E0E0E0" WIDTH=10><IMG SRC="<?php echo $imgroot; ?>topleft.gif" HEIGHT=9 WIDTH=9></TD>
+ 		<TD BGCOLOR="#E0E0E0" WIDTH=30><IMG SRC="<?php echo $imgroot; ?>clear.gif" WIDTH=30 HEIGHT=1></TD>
+ 		<TD BGCOLOR="#E0E0E0"><IMG SRC="<?php echo $imgroot; ?>clear.gif" WIDTH=1 HEIGHT=1></TD>
+ 		<TD BGCOLOR="#E0E0E0" WIDTH=30><IMG SRC="<?php echo $imgroot; ?>clear.gif" WIDTH=30 HEIGHT=1></TD>
+ 		<TD ALIGN=RIGHT BGCOLOR="#E0E0E0" WIDTH=10><IMG SRC="<?php echo $imgroot; ?>topright.gif" HEIGHT=9 WIDTH=9></TD>
+ 	</TR>
+ 
+ 	<TR>
+ 
+ 		<!-- Outer body row -->
+ 
+ 		<TD BGCOLOR="#E0E0E0"><IMG SRC="<?php echo $imgroot; ?>clear.gif" WIDTH=10 HEIGHT=1></TD>
+ 		<TD VALIGN=TOP WIDTH="99%" BGCOLOR="#E0E0E0" COLSPAN=3>
  
+ 			<!-- Inner Tabs / Shell -->
+ 
+ 			<TABLE BORDER=0 WIDTH="100%" CELLSPACING="0" CELLPADDING=0>
  <?php
  
  
+ if ($params['toptab'] && $params['group']) {
  
+ 			?>
+ 			<TR>
+ 				<TD>&nbsp;</TD>
+ 				<TD>
+ 				<?php
  
+ 				echo $this->projectTabs($params['toptab'],$params['group']);
  
+ 				?>
+ 				</TD>
+ 				<TD>&nbsp;</TD>
+ 			</TR>
+ 			<?php
  
+ }
  
+ ?>
+ 			<TR>
+ 				<TD ALIGN=LEFT BGCOLOR="#FFFFFF" WIDTH=10><IMG SRC="<?php echo $imgroot; ?>topleft-inner.gif" HEIGHT=9 WIDTH=9></TD>
+ 				<TD BGCOLOR=WHITE><IMG SRC="<?php echo $imgroot; ?>clear.gif" WIDTH=1 HEIGHT=1></TD>
+ 				<TD ALIGN=RIGHT BGCOLOR="#FFFFFF" WIDTH=10><IMG SRC="<?php echo $imgroot; ?>topright-inner.gif" HEIGHT=9 WIDTH=9></TD>
+ 			</TR>
  
+ 			<TR>
+ 				<TD BGCOLOR=WHITE><IMG SRC="<?php echo $imgroot; ?>clear.gif" WIDTH=10 HEIGHT=1></TD>
+ 				<TD VALIGN=TOP WIDTH="99%" BGCOLOR="WHITE">
  
  	<?php
  
+ /*
+ 
  	if ($params['titlevals']) {
+ 		$title =		$Language->getText($params['pagename'],'title',$params['titlevals']);
  	} else {
+ 		$title =		$Language->getText($params['pagename'],'title');
  	}
  
  	if ($params['sectionvals']) {
+ 		$section =	  $Language->getText($params['pagename'],'section',$params['sectionvals']);
  	} else {
+ 		$section =	  $Language->getText($params['pagename'],'section');
  	}
  
  	if ($section) {
***************
*** 537,646 ****
  	}
  
  	if ($title) {
- 	       print "<h2>$title</h2>\n";
  	}
- 
  	}
  
  	function footer($params) {
  	?>
- 	<!-- end content -->
- 	<p>&nbsp;</p>
- 	</td>
- 	<td width="9" bgcolor="<?php echo $this->COLOR_CONTENT_BACK; ?>">&nbsp;
- 	</td>
- 
- 	</tr>
- 	</table>
- 		</td>
- 		<td width="17" background="<?php echo $GLOBALS['sys_images_url'] . $this->imgroot; ?>rightbar1.png" align="right" valign="bottom"><?php echo html_image($this->imgroot . "rightbar1.png","17","17",array()); ?>
- </td>
- 	</tr>
- 	<tr>
- 		<td background="<?php echo $GLOBALS['sys_images_url'] . $this->imgroot; ?>bbar1.png" height="17"><?php echo html_image($this->imgroot . "bleft1.png","17","17",array()); ?></td>
- 		<td background="<?php echo $GLOBALS['sys_images_url'] . $this->imgroot; ?>bbar1.png" align="center" colspan="3"><?php echo html_image($this->imgroot . "bbar1.png","1","17",array()); ?></td>
- 		<td background="<?php echo $GLOBALS['sys_images_url'] . $this->imgroot; ?>bbar1.png" bgcolor="#7c8188"><?php echo html_image($this->imgroot . "bright1.png","17","17",array()); ?></td>
- 	</tr>
- </table>
- </div>
- 
- <!-- themed page footer -->
- <?php 
- 	$this->generic_footer($params);
- 	}
  
  
  
- 	/**
- 	 * menuhtml_top() - HTML top menu
- 	 *
- 	 * Use only for the top most menu
- 	 *
- 	 * @param	string	Menu title
- 	 */
- 	function menuhtml_top($title) {
- ?>
- <table cellpadding="0" cellspacing="0" border="0" width="140">
- 	<tr>
- 		<td align="left" valign="middle"><b><?php echo $title; ?></b><br></td>
- 	</tr>
- 	<tr>
- 		<td align="right" valign="middle">
- <?php
- 	}
  
  
- 	/**
- 	 * menuhtml_bottom() - HTML bottom menu
- 	 *
- 	 * End the table
- 	 */
- 	function menuhtml_bottom() {
- 		print '
- 			<BR>
- 			</td>
- 		</tr>
- 	</table>
- ';
- 	}
  
- 	function menu_entry($link, $title) {
- 		print "\t".'<A class="menus" href="'.$link.'">'.$title.'</A> &nbsp;' . html_image($this->imgroot . "point1.png","7","7",array()) . '<br>';
  	}
  
  	/**
- 	 *	tab_entry() - Prints out the a themed tab, used by project_tabs
  	 *
- 	 *	@param	string	Is the URL to link to
- 	 *	@param	string	Us the image to use (if the theme uses it)
- 	 *	@param	string	Is the title to use in the link tags
- 	 *	@param	bool	Is a boolean to test if the tab is 'selected'
- 	 */
- 	function tab_entry($url='http://localhost/', $icon='', $title='Home', $selected=0) {
- 		print '
- 		<A ';
- 		if ($selected){
- 			print 'class=tabselect ';
  		} else {
- 			print 'class=tabs ';
  		}
- 		print 'href="'. $url .'">' . $title . '</A>&nbsp;|&nbsp;';
  	}
  
  	/**
- 	 *	project_tabs() - Prints out the project tabs, contained here in case
  	 *		we want to allow it to be overriden
  	 *
  	 *	@param	string	Is the tab currently selected
  	 *	@param	string	Is the group we should look up get title info
- 	 *  @param	string	Any extra text to print out
  	 */
- 	function project_tabs($toptab,$group,$extra_text='') {
  
  		global $Language;
  
  		// get group info using the common result set
- 		$project=group_get_object($group);
  		if ($project->isError()) {
  			//wasn't found or some other problem
  			return;
--- 289,438 ----
  	}
  
  	if ($title) {
+ 		   print "<h2>$title</h2>\n";
  	}
+ */
  	}
  
  	function footer($params) {
+ 
+ 		$imgroot=$this->imgroot;
+ 
  	?>
  
+ 			<!-- end main body row -->
  
  
+ 				</TD>
+ 				<TD WIDTH=10 BGCOLOR="WHITE"><IMG SRC="<?php echo $imgroot; ?>clear.gif" width=2 height=1></TD>
+ 			</TR>
+ 			<TR>
+ 				<TD ALIGN=LEFT BGCOLOR="#E0E0E0" WIDTH=10"><IMG SRC="<?php echo $imgroot; ?>bottomleft-inner.gif" HEIGHT=11 WIDTH=11></TD>
+ 				<TD BGCOLOR=WHITE><IMG SRC="<?php echo $imgroot; ?>clear.gif" WIdTH="1" HEIGHT=1></TD>
+ 				<TD ALIGN=RIGHT BGCOLOR="#E0E0E0" WIDTH=10><IMG SRC="<?php echo $imgroot; ?>bottomright-inner.gif" HEIGHT=11 WIDTH=11></TD>
+ 			</TR>
+ 			</TABLE>
  
+ 		<!-- end inner body row -->
  
+ 		</TD>
+ 		<TD WIDTH=10 BGCOLOR="#E0E0E0"><IMG SRC="<?php echo $imgroot; ?>clear.gif" width=2 height=1></TD>
+ 	</TR>
+ 	<TR>
+ 		<TD ALIGN=LEFT BGCOLOR="#E0E0E0" WIDTH=10><IMG SRC="<?php echo $imgroot; ?>bottomleft.gif" HEIGHT=9 WIDTH=9></TD>
+ 		<TD BGCOLOR="#E0E0E0" COLSPAN=3><IMG SRC="<?php echo $imgroot; ?>clear.gif" WIDTH="1" HEIGHT=1></TD>
+ 		<TD ALIGN=RIGHT BGCOLOR="#E0E0E0" WIDTH=10><IMG SRC="<?php echo $imgroot; ?>bottomright.gif" HEIGHT=9 WIDTH=9></TD>
+ 	</TR>
+ </TABLE>
+ </body>
+ </html>
+ <?php
  
  	}
  
+ 
  	/**
+ 	 * boxTop() - Top HTML box
  	 *
+ 	 * @param   string  Box title
+ 	 * @param   bool	Whether to echo or return the results
+ 	 * @param   string  The box background color
+ 	 */
+ 	function boxTop($title) {
+ 		return '
+ 		<TABLE cellspacing="0" cellpadding="1" width="100%" border="0" bgcolor="' .$this->COLOR_HTMLBOX_TITLE.'">
+ 		<TR><TD>
+ 			<TABLE cellspacing="1" cellpadding="2" width="100%" border="0" bgcolor="'. $this->COLOR_HTMLBOX_BACK.'">
+ 				<TR BGCOLOR="'.$this->COLOR_HTMLBOX_TITLE.'" align="center">
+ 					<TD colspan=2><SPAN class=titlebar>'.$title.'</SPAN></TD>
+ 				</TR>
+ 				<TR align=left>
+ 					<TD colspan=2>';
+ 	}
+ 
+ 	/**
+ 	 * boxMiddle() - Middle HTML box
+ 	 *
+ 	 * @param   string  Box title
+ 	 * @param   string  The box background color
+ 	 */
+ 	function boxMiddle($title) {
+ 		return '
+ 					</TD>
+ 				</TR>
+ 				<TR BGCOLOR="'.$this->COLOR_HTMLBOX_TITLE.'" align="center">
+ 					<TD colspan=2><SPAN class=titlebar>'.$title.'</SPAN></TD>
+ 				</TR>
+ 				<TR align=left bgcolor="'. $this->COLOR_HTMLBOX_BACK .'">
+ 					<TD colspan=2>';
+ 	}
+ 
+ 	/**
+ 	 * boxBottom() - Bottom HTML box
+ 	 *
+ 	 * @param   bool	Whether to echo or return the results
+ 	 */
+ 	function boxBottom() {
+ 		return '
+ 					</TD>
+ 				</TR>
+ 			</TABLE>
+ 		</TD></TR>
+ 		</TABLE><P>';
+ 	}
+ 
+ 	function outerTabs($params) {
+ 		$TABS_DIRS[]='/';
+ 		$TABS_DIRS[]='/softwaremap/';
+ 		$TABS_DIRS[]='/my/';
+ 		$TABS_DIRS[]='/snippet/';
+ 		$TABS_DIRS[]='/admin/';
+ 		$TABS_TITLES[]='Home';
+ 		$TABS_TITLES[]='Project&nbsp;Tree';
+ 		$TABS_TITLES[]='My&nbsp;Page';
+ 		$TABS_TITLES[]='Code&nbsp;Snippets';
+ 		$TABS_TITLES[]='Admin';
+ 
+ 		if ($params['group']) {
+ 			// get group info using the common result set
+ 			$project =& group_get_object($params['group']);
+ 			if ($project->isError()) {
+ 		
+ 			} elseif (!$project->isProject()) {
+ 			
+ 			} else {
+ 				$TABS_DIRS[]='/projects/'.$project->getUnixName().'/';
+ 				$TABS_TITLES[]=$project->getPublicName();
+ 				$selected=count($TABS_DIRS)-1;
+ 			}
+ 		} elseif (strstr($GLOBALS['REQUEST_URI'],'softwaremap')) {
+ 			$selected=1;
+ 		} elseif (strstr($GLOBALS['REQUEST_URI'],'/my/') || strstr($GLOBALS['REQUEST_URI'],'/account/')) {
+ 			$selected=2;
+ 		} elseif (strstr($GLOBALS['REQUEST_URI'],'/snippet/')) {
+ 			$selected=3;
+ 		} elseif (strstr($GLOBALS['REQUEST_URI'],'/admin/')) {
+ 			$selected=4;
  		} else {
+ 			$selected=0;
  		}
+ 		echo $this->tabGenerator($TABS_DIRS,$TABS_TITLES,false,$selected,'#E0E0E0','80%');
+ 
  	}
  
  	/**
+ 	 *	projectTabs() - Prints out the project tabs, contained here in case
  	 *		we want to allow it to be overriden
  	 *
  	 *	@param	string	Is the tab currently selected
  	 *	@param	string	Is the group we should look up get title info
  	 */
+ 	function projectTabs($toptab,$group) {
  
  		global $Language;
  
  		// get group info using the common result set
+ 		$project =& group_get_object($group);
  		if ($project->isError()) {
  			//wasn't found or some other problem
  			return;
***************
*** 649,782 ****
  			return;
  		}
  
- /*		print '<H2>'. $project->getPublicName() .' - ';
- 		// specific to where we're at
- 		switch ($toptab) {
- 			case 'home': print $Language->getText('group','short_summary'); break;
- 			case 'admin': print $Language->getText('group','short_admin'); break;
- 			case 'forums': print $Language->getText('group','short_forum'); break;
- 			case 'tracker': print $Language->getText('group','short_tracker'); break;
- 			case 'mail': print $Language->getText('group','short_mail'); break;
- 			case 'pm': print $Language->getText('group','short_pm'); break;
- 			case 'docman': print $Language->getText('group','short_docman'); break;
- 			case 'surveys': print $Language->getText('group','short_survey'); break;
- 			case 'cvs': print $Language->getText('group','short_cvs'); break;
- 			case 'downloads': print $Language->getText('group','short_files'); break;
- 			case 'news': print $Language->getText('group','short_news'); break;
- 			case 'memberlist': print $Language->getText('group','short_memberlist'); break;
- 			default: print $Language->getText('group','short_summary'); break;
- 		}
- 
- 		if ($extra_text) {
- 			print ' - '.$extra_text;
- 		}
- 
- */
- 
- 		print '</H2>
- 		<P>
- 		<HR SIZE="1" NoShade>';
- 
  		// Summary
- 		$this->tab_entry('/projects/'. $project->getUnixName() .'/', $this->icons['Summary'],
- 			$Language->getText('group','short_summary'), $toptab == 'home');
  
  		// Project Admin 
- 		$this->tab_entry('/project/admin/?group_id='. $group, $this->icons['Admin'],
- 			$Language->getText('group','short_admin'), $toptab == 'admin');
- 
- 		// Homepage
- 		$this->tab_entry('http://'. $project->getHomePage(), $this->icons['Homepage'],
- 			$Language->getText('group','short_homepage'));
  
  		// Forums
  		if ($project->usesForum()) {
- 			$this->tab_entry('/forum/?group_id='.$group, $this->icons['Forums'],
- 				$Language->getText('group','short_forum'), $toptab == 'forums');
  		}
  
  		// Artifact Tracking
- 		$this->tab_entry('/tracker/?group_id='.$group, $this->icons['Tracker'],
- 			$Language->getText('group','short_tracker'), $toptab == 'tracker');
- 
- /*
- 	Messy hack but they insisted on it -
- 
- 	We need to get the bug, support, and patch tracker info
- 	and display it here if they are public
- */
- 		$res=db_query("SELECT * 
- 			FROM artifact_group_list 
- 			WHERE group_id='$group'
- 			AND is_public='1' 
- 			AND datatype > 0
- 			ORDER BY datatype ASC");
- 		$rows=db_numrows($res);
- //
- //	Iterate through the public pre-defined trackers and add them to nav bar
- //
- 		for ($i=0; $i<$rows; $i++) {
- 			if (db_result($res,$i,'datatype') == 1) {
- 				//bug Tracker
- 				$this->tab_entry('/tracker/?group_id='.$group.'&atid='.db_result($res,$i,'group_artifact_id'), 
- 				$this->icons['Bugs'],
- 				$Language->getText('group','short_bugs'), $toptab == 'bugs');
- 			} elseif (db_result($res,$i,'datatype') == 2) {
- 				//support Tracker
- 				$this->tab_entry('/tracker/?group_id='.$group.'&atid='.db_result($res,$i,'group_artifact_id'), 
- 				$this->icons['Support'],
- 				$Language->getText('group','short_support'), $toptab == 'support');
- 			} elseif (db_result($res,$i,'datatype') == 3) {
- 				//patch Tracker
- 				$this->tab_entry('/tracker/?group_id='.$group.'&atid='.db_result($res,$i,'group_artifact_id'), 
- 				$this->icons['Patches'],
- 				$Language->getText('group','short_patch'), $toptab == 'patch');
- 			}
- 		}
  
  		// Mailing Lists
  		if ($project->usesMail()) {
- 			$this->tab_entry('/mail/?group_id='.$group, $this->icons['Lists'], 
- 				$Language->getText('group','short_mail'), $toptab == 'mail');
  		}
  
  		// Project Manager
  		if ($project->usesPm()) {
- 			$this->tab_entry('/pm/?group_id='.$group, $this->icons['Tasks'], 
- 				$Language->getText('group','short_pm'), $toptab == 'pm');
  		}
  
  		// Doc Manager
  		if ($project->usesDocman()) {
- 			$this->tab_entry('/docman/?group_id='.$group, $this->icons['Docs'], 
- 				$Language->getText('group','short_docman'), $toptab == 'docman');
  		}
  
  		// Surveys
  		if ($project->usesSurvey()) {
- 			$this->tab_entry('/survey/?group_id='.$group, $this->icons['Surveys'], 
- 				$Language->getText('group','short_survey'), $toptab == 'surveys');
  		}
  
  		//newsbytes
  		if ($project->usesNews()) {
- 			$this->tab_entry('/news/?group_id='.$group, $this->icons['News'], 
- 				$Language->getText('group','short_news'), $toptab == 'news');
  		}
  
  		// CVS
  		if ($project->usesCVS()) {
- 			$this->tab_entry('/cvs/?group_id='.$group, $this->icons['CVS'], 
- 				$Language->getText('group','short_cvs'), $toptab == 'cvs');
  		}
  
  		// Downloads
- 		$this->tab_entry('/project/showfiles.php?group_id='.$group, $this->icons['Files'], 
- 			$Language->getText('group','short_files'), $toptab == 'downloads');
  
- 		print '<HR SIZE="1" NoShade><BR>';
  	}
  
  
  }
  ?>
--- 441,647 ----
  			return;
  		}
  
  		// Summary
+ 		$TABS_DIRS[]='/projects/'. $project->getUnixName() .'/';
+ 		$TABS_TITLES[]=$Language->getText('group','short_summary');
+ 		(($toptab == 'home') ? $selected=(count($TABS_TITLES)-1) : '' );
  
  		// Project Admin 
+ 		$TABS_DIRS[]='/project/admin/?group_id='. $group;
+ 		$TABS_TITLES[]=$Language->getText('group','short_admin');
+ 		(($toptab == 'admin') ? $selected=(count($TABS_TITLES)-1) : '' );
+ 
+ 		/* Homepage
+ 		$TABS_DIRS[]='http://'. $project->getHomePage();
+ 		$TABS_TITLES[]=$Language->getText('group','short_homepage');
+ 		*/
  
  		// Forums
  		if ($project->usesForum()) {
+ 			$TABS_DIRS[]='/forum/?group_id='.$group;
+ 			$TABS_TITLES[]=$Language->getText('group','short_forum');
+ 			(($toptab == 'forums') ? $selected=(count($TABS_TITLES)-1) : '' );
  		}
  
  		// Artifact Tracking
+ 		$TABS_DIRS[]='/tracker/?group_id='.$group;
+ 		$TABS_TITLES[]=$Language->getText('group','short_tracker');
+ 		(($toptab == 'tracker' || $toptab == 'bugs' || $toptab == 'support' || $toptab == 'patch') 
+ 				? $selected=(count($TABS_TITLES)-1) : '' );
  
  		// Mailing Lists
  		if ($project->usesMail()) {
+ 			$TABS_DIRS[]='/mail/?group_id='.$group;
+ 			$TABS_TITLES[]=$Language->getText('group','short_mail');
+ 			(($toptab == 'mail') ? $selected=(count($TABS_TITLES)-1) : '' );
  		}
  
  		// Project Manager
  		if ($project->usesPm()) {
+ 			$TABS_DIRS[]='/pm/?group_id='.$group;
+ 			$TABS_TITLES[]=$Language->getText('group','short_pm');
+ 			(($toptab == 'pm') ? $selected=(count($TABS_TITLES)-1) : '' );
  		}
  
  		// Doc Manager
  		if ($project->usesDocman()) {
+ 			$TABS_DIRS[]='/docman/?group_id='.$group;
+ 			$TABS_TITLES[]=$Language->getText('group','short_docman');
+ 			(($toptab == 'docman') ? $selected=(count($TABS_TITLES)-1) : '' );
  		}
  
  		// Surveys
  		if ($project->usesSurvey()) {
+ 			$TABS_DIRS[]='/survey/?group_id='.$group;
+ 			$TABS_TITLES[]=$Language->getText('group','short_survey');
+ 			(($toptab == 'surveys') ? $selected=(count($TABS_TITLES)-1) : '' );
  		}
  
  		//newsbytes
  		if ($project->usesNews()) {
+ 			$TABS_DIRS[]='/news/?group_id='.$group;
+ 			$TABS_TITLES[]=$Language->getText('group','short_news');
+ 			(($toptab == 'news') ? $selected=(count($TABS_TITLES)-1) : '' );
  		}
  
  		// CVS
  		if ($project->usesCVS()) {
+ 			$TABS_DIRS[]='/cvs/?group_id='.$group;
+ 			$TABS_TITLES[]=$Language->getText('group','short_cvs');
+ 			(($toptab == 'cvs') ? $selected=(count($TABS_TITLES)-1) : '' );
  		}
  
  		// Downloads
+ 		$TABS_DIRS[]='/project/showfiles.php?group_id='.$group;
+ 		$TABS_TITLES[]=$Language->getText('group','short_files');
+ 		(($toptab == 'downloads') ? $selected=(count($TABS_TITLES)-1) : '' );
+ 
+ 		echo $this->tabGenerator($TABS_DIRS,$TABS_TITLES,true,$selected,'#FFFFFF','100%');
  
  	}
  
+ 	function tabGenerator($TABS_DIRS,$TABS_TITLES,$nested=false,$selected=false,$sel_tab_bgcolor='WHITE',$total_width='100%') {
  
+ 		$imgroot=$this->imgroot;
+ 		$dark='BGCOLOR="#BBBBBB"';
+ 		$light='BGCOLOR="'. $sel_tab_bgcolor .'"';
+ 
+ 		$count=count($TABS_DIRS);
+ 		$width=intval((100/$count));
+ 		$return .= '
+ 
+ 		<!-- start tabs -->
+ 
+ 		<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 WIDTH="'.$total_width.'">
+ 		<TR>';
+ 		if ($nested) {
+ 			$inner='-inner';
+ 		} else {
+ 			$inner='';
+ 		}
+ 		for ($i=0; $i<$count; $i++) {
+ 			$bgcolor=(($selected==$i)?$light:$dark);
+ 			$imgcolor=(($selected==$i)?'':'-dark');
+ 			$return .= '
+ 				<TD '.$bgcolor.' width=9 ALIGN=TOP VALIGN=TOP>'.
+ 					'<DIV ALIGN="LEFT">'. html_image($imgroot . 'topleft'.$inner.$imgcolor.'.gif',9,9,array()).'</DIV></TD>
+ 				<TD '.$bgcolor.' width="'.$width.'%" ROWSPAN=2 ALIGN="MIDDLE">'.
+ 				'<A class="'. (($selected==$i)?'tabsellink':'tablink') .'" HREF="'. $TABS_DIRS[$i] .
+ 					'">'. $TABS_TITLES[$i] .'</A></TD>
+ 				<TD '.$bgcolor.' width=9 ALIGN="TOP" VALIGN="TOP">'.
+ 				'<DIV ALIGN="RIGHT">'. html_image($imgroot . 'topright'.$inner.$imgcolor.'.gif',9,9,array()).'</DIV></TD>';
+ 			if ($i < $count-1) {
+ 				$return .= '<TD WIDTH=1 ROWSPAN=2><IMG SRC="'.$imgroot . 'clear.gif" HEIGHT=2 WIDTH=1></TD>';
+ 			}
+ 		}
+ 
+ 		$return .= '
+ 		</TR>
+ 		<TR>';
+ 		for ($i=0; $i<$count; $i++) {
+ 			$bgcolor=(($selected==$i)?$light:$dark);
+ 			$return .= '<TD '.$bgcolor.'>&nbsp;</TD>';
+ 			$return .= '<TD '.$bgcolor.'>&nbsp;</TD>';
+ 		}
+ 		$return .= '
+ 		</TR>
+ 		<TR>';
+ 		for ($i=0; $i<$count; $i++) {
+ 			$bgcolor=(($selected==$i)?$light:'BGCOLOR="#999999"');
+ 			$return .= '<TD '.$bgcolor.' COLSPAN=4><IMG SRC="'.$imgroot . 'clear.gif" HEIGHT=2 WIDTH=1></TD>';
+ 		}
+ 
+ 		return $return.'
+ 		</TR>
+ 		</TABLE>';
+ 	}
+ 
+ 	function searchBox() {
+ 		global $words,$forum_id,$group_id,$atid,$exact,$type_of_search;
+ 
+ 		// if there is no search currently, set the default
+ 		if ( ! isset($type_of_search) ) {
+ 			$exact = 1;
+ 		}
+ 
+ 		print '
+ 		<FORM action="/search/" method="POST"'.$new_window.'>
+ 		<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0>
+ 		<TR><TD>
+ 		<CENTER>
+ 		<FONT SIZE="1">
+ 
+ 		<SELECT name="type_of_search">';
+ 
+ 		if ($atid && $group_id) {
+ 			$group =& group_get_object($group_id);
+ 			if ($group && is_object($group)) {
+ 				$ath = new ArtifactTypeHtml($group,$atid);
+ 				if ($ath && is_object($ath)) {
+ 				print '
+ 				<OPTION value="artifact"'.( $type_of_search == 'artifact' ? ' SELECTED' : '' ).'>'. $ath->getName() .'</OPTION>';
+ 				}
+ 			}
+ 		} else if ($group_id && $forum_id) {
+ 			print '
+ 			<OPTION value="forums"'.( $type_of_search == 'forums' ? ' SELECTED' : '' ).'>This Forum</OPTION>';
+ 		}
+ 		print '
+ 			<OPTION value="soft"'.( $type_of_search == 'soft' ? ' SELECTED' : '' ).'>Software/Group</OPTION>';
+ 		print '
+ 			<OPTION value="people"'.( $type_of_search == 'people' ? ' SELECTED' : '' ).'>People</OPTION>';
+ 		print '
+ 			</SELECT>';
+ 
+ //		print '<BR>';
+ //		print '
+ //		<INPUT TYPE="CHECKBOX" NAME="exact" VALUE="1"'.( $exact ? ' CHECKED' : ' UNCHECKED' ).'> Require All Words';
+ 
+ 		print '</TD><TD>&nbsp;</TD>';
+ 		if ( isset($forum_id) ) {
+ 			print '
+ 			<INPUT TYPE="HIDDEN" VALUE="'.$forum_id.'" NAME="forum_id">';
+ 		}
+ 		if ( isset($group_id) ) {
+ 			print '
+ 			<INPUT TYPE="HIDDEN" VALUE="'.$group_id.'" NAME="group_id">';
+ 		}
+ 		if ( isset($atid) ) {
+ 			print '
+ 			<INPUT TYPE="HIDDEN" VALUE="'.$atid.'" NAME="atid">';
+ 		}
+ 		print '<TD>';
+ 		print '
+ 		<INPUT TYPE="text" SIZE="12" NAME="words" VALUE="'.$words.'">';
+ 
+ 		print '</TD><TD>&nbsp;</TD><TD>';
+ 		print '<INPUT TYPE="submit" NAME="Search" VALUE="Search">';
+ 
+ 		print '
+ 		</TD></TR></TABLE>';
+ 		print '</FORM></FONT>';
+ 
+ 	}
  }
+ 
  ?>
