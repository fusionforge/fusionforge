***************
*** 10,121 ****
  
  function show_features_boxes() {
  	GLOBAL $HTML,$Language;
- 	$return .= $HTML->box1_top($Language->getText('home','sourceforge_statistics'),0);
  	$return .= show_sitestats();
- 	$return .= $HTML->box1_middle($Language->getText('home','sfos'));
- 	$return .= show_sfos();
- 	$return .= $HTML->box1_middle($Language->getText('home','top_project_downloads'));
  	$return .= show_top_downloads();
- 	$return .= $HTML->box1_middle($Language->getText('home','highest_ranked_users'));
  	$return .= show_highest_ranked_users();
- 	$return .= $HTML->box1_middle($Language->getText('home','most_active_this_week'));
  	$return .= show_highest_ranked_projects();
- 	$return .= $HTML->box1_bottom(0);
  	return $return;
  }
  
- /**
-  *	depends on $foundry being set globally with the current foundry object
-  */
- function foundry_features_boxes() {
- 	GLOBAL $HTML;
- //	$comma_sep_groups=$GLOBALS['foundry']->getProjectsCommaSep();
- 
- 	$group_id=$GLOBALS['foundry']->getID();
- 
- 	$return .= $HTML->box1_top('Most Active',0);
- 	$return .= foundry_active_projects($group_id);
- 	$return .= $HTML->box1_middle('Top Downloads');
- 	$return .= foundry_top_downloads($GLOBALS['foundry']->getID());
- 	$return .= $HTML->box1_middle('Featured Projects');
- 	$return .= foundry_featured_projects($GLOBALS['foundry']->getID());
- 	$return .= $HTML->box1_bottom(0);
- 	return $return;
- }
- 
- function foundry_active_projects($foundry_id) {
- 
- 	$sql="SELECT * FROM foundry_project_rankings_agg
- 			WHERE foundry_id='$foundry_id'
- 			ORDER BY foundry_id ASC, ranking ASC";
- 
- 	$result=db_query($sql, 20, 0, SYS_DB_STATS);
- 	if (!$result || db_numrows($result) < 1) {
- 		return '';//db_error(SYS_DB_STATS);
- 	} else {
- 		while ($row=db_fetch_array($result)) {
- 			$return .= '<B>( '.$row['percentile'].'% )</B>'
- 				.' <A HREF="/projects/'.$row['unix_group_name'].
- 			'/">'.$row['group_name'].'</A><BR>';
- 		}
- 		$return .= '<CENTER><A href="/top/mostactive.php?type=week">[ More ]</A></CENTER>';
- 	}
- 	return $return;
- }
- 
- function foundry_featured_projects($group_id) {
- 	$sql="SELECT groups.group_name,groups.unix_group_name,".
- 		"groups.group_id,foundry_preferred_projects.rank ".
- 		"FROM groups,foundry_preferred_projects ".
- 		"WHERE foundry_preferred_projects.group_id=groups.group_id ".
- 		"AND foundry_preferred_projects.foundry_id='$group_id' ".
- 		"ORDER BY rank ASC";
- 
- 	$res_grp=db_query($sql);
- 	$rows=db_numrows($res_grp);
- 
- 	if (!$res_grp || $rows < 1) {
- 		$return .= 'No Projects';
- 		$return .= db_error();
- 	} else {
- 		for ($i=0; $i<$rows; $i++) {
- 			$return .= '<A href="/projects/'. 
- 			strtolower(db_result($res_grp,$i,'unix_group_name')) .'/">'. 
- 			db_result($res_grp,$i,'group_name') .'</A><BR>';
- 		}
- 	}
- 	return $return;
- }
- 
- function foundry_top_downloads($foundry_id) {
- 
- 	// TODO yesterday is now defined as two days ago.  Quick fix
- 	//      to allow download list to be cached before nightly
- 	//      aggregation is done.  TODO jbyers 2001.03.19
- 	//
- 	$yesterday = date("Ymd",time()-(2*3600*24));
- 	
- 	$res_topdown = db_query("SELECT * 
- 		FROM foundry_project_downloads_agg
- 		WHERE
- 		foundry_id='$foundry_id'
- 		ORDER BY foundry_id DESC, downloads DESC
- 	", 10, 0, SYS_DB_STATS);
- 
- 	if (!$res_topdown || db_numrows($res_topdown) < 1) {
- 		return db_error(SYS_DB_STATS);
- 	} else {
- 		// print each one
- 		while ($row_topdown = db_fetch_array($res_topdown)) {
- 			if ($row_topdown['downloads'] > 0) 
- 				$return .= "<BR><A href=\"/projects/$row_topdown[unix_group_name]/\">"
- 				. "$row_topdown[group_name]</A> ($row_topdown[downloads])\n";
- 		}
- 	}
- 	
- 	return $return; 
- }
- 
  function show_top_downloads() {
  
  	// TODO yesterday is now defined as two days ago.  Quick fix
--- 10,29 ----
  
  function show_features_boxes() {
  	GLOBAL $HTML,$Language;
+ 	$return .= $HTML->boxTop($Language->getText('home','sourceforge_statistics'),0);
  	$return .= show_sitestats();
+ 	$return .= $HTML->boxMiddle('Newest Projects');
+ 	$return .= show_newest_projects();
+ 	$return .= $HTML->boxMiddle($Language->getText('home','top_project_downloads'));
  	$return .= show_top_downloads();
+ 	$return .= $HTML->boxMiddle($Language->getText('home','highest_ranked_users'));
  	$return .= show_highest_ranked_users();
+ 	$return .= $HTML->boxMiddle($Language->getText('home','most_active_this_week'));
  	$return .= show_highest_ranked_projects();
+ 	$return .= $HTML->boxBottom(0);
  	return $return;
  }
  
  function show_top_downloads() {
  
  	// TODO yesterday is now defined as two days ago.  Quick fix
