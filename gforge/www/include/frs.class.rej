***************
*** 100,175 ****
  	}
  
  	/**
- 	 * frsAddFile() - Add a new file
- 	 *
- 	 * @param	int		Time of the release
- 	 * @param	string	The name of the file to add
- 	 * @param	int		The ID of the release this file to which this file is associated
- 	 * @param	int		The file size
- 	 * @param	int		The post date
- 	 * @param	int		The ide of the release
- 	 * @param	int		The ID of the package
- 	 */
- 	function frsAddFile($release_time, $filename, $file_size, $post_date, $release_id, $package_id) {
- 		if( !$this->frsVerifyRelease($release_id, $package_id) ) {
- 			$this->setError(' FRS Add File Failed: ' . $this->getErrorMessage());
- 			return false;
- 		}
- //
- //
- //	filename validation? Use a regex.
- //
- //
- 		//move the file to a its project page using a setuid program
- 		exec ("/usr/local/bin/fileforge $filename ".$group_unix_name, $exec_res);
- 		if ($exec_res[0]) {
- 			$this->setError("FRS Add File Failed: $exec_res[0], $exec_res[1]");
- 			return false;
- 		}
- 
- 		$res=db_query("INSERT INTO 
- 								frs_file (release_time,filename,release_id,file_size,post_date,processor_id,type_id) 
- 				       VALUES (
- 								'$release_time',
- 								'$filename',
- 								'$release_id',
- 								'$file_size',
- 								'$post_date',
- 								'100',
- 								'100') ");
- 		if (!$res) {
- 			$this->setError(' FRS Add File Failed: ' . db_error());
- 			return false;
- 		}
- 
- 		return true;
- 	}
- 
- 	/**
- 	 * frsAddRelease() - Add a new release
- 	 *
- 	 * @param	string	The name of the new release
- 	 * @param	int		The ID of the package with which this release is to be associated
- 	 * @return Database result ID
- 	 */
- 	function frsAddRelease($release_name, $package_id, $notes="", $changes="") {
- 		if( !$this->frsVerifyPackage($package_id) ) {
- 			$this->setError(' FRS Add Release Failed: ' . $this->getErrorMessage());
- 			return false;
- 		}
- 
- 		$res=db_query("INSERT INTO frs_release (package_id,name,notes,changes,status_id,release_date,released_by) ".
- 					  "VALUES ('$package_id','$release_name','$notes','$changes','1','". time() ."','". user_getid() ."')");
- 		
- 		if (!$res) {
- 			$this->setError(' FRS Add Release Failed  ');
- 			return false;
- 		} else {
- 			return db_insertid($res,'frs_release','release_id');
- 		}
- 	}
- 
- 	/**
  	 * frsAddNotes() - Add a new release note
  	 *
  	 * @param	string	The text of the release notes
--- 100,105 ----
  	}
  
  	/**
  	 * frsAddNotes() - Add a new release note
  	 *
  	 * @param	string	The text of the release notes
***************
*** 329,335 ****
  			return false;
  		} else {
  			$date_expl = explode("-",$release_date);
- 		    $release_date = mktime(0,0,0,$date_expl[1],$date_expl[2],$date_expl[0]);
  //
  //
  //	date validation
--- 230,236 ----
  			return false;
  		} else {
  			$date_expl = explode("-",$release_date);
+ 			$release_date = mktime(0,0,0,$date_expl[1],$date_expl[2],$date_expl[0]);
  //
  //
  //	date validation
***************
*** 815,831 ****
  			$unix_group = db_result($result,0,'unix_group_name');
  			$date = date('Y-m-d H:i',time());
  			
- 			$subject = '[SourceForge Release] '
- 			           .$unix_group.' : '.$package;
  		
  
  			$text = "Project: $full_group  ($unix_group)\n"
  				."Package: $package\n"
  				."Date   : $date"
  				."\n\nProject \"$full_group\" ('$unix_group') has "
- 			        ."released the new version of package '"
  				.$package."'. "
- 				."You can download it from SourceForge "
  				."by following this link:\n"
  				."<http://".$GLOBALS['HTTP_HOST']."/project/showfiles.php?group_id=$group_id&release_id=$release_id>\n"
  				."or browse Release Notes and ChangeLog by visiting this link:\n"
--- 663,679 ----
  			$unix_group = db_result($result,0,'unix_group_name');
  			$date = date('Y-m-d H:i',time());
  			
+ 			$subject = '[GForge Release] '
+ 					   .$unix_group.' : '.$package;
  		
  
  			$text = "Project: $full_group  ($unix_group)\n"
  				."Package: $package\n"
  				."Date   : $date"
  				."\n\nProject \"$full_group\" ('$unix_group') has "
+ 					."released the new version of package '"
  				.$package."'. "
+ 				."You can download it from GForge "
  				."by following this link:\n"
  				."<http://".$GLOBALS['HTTP_HOST']."/project/showfiles.php?group_id=$group_id&release_id=$release_id>\n"
  				."or browse Release Notes and ChangeLog by visiting this link:\n"
***************
*** 833,889 ****
  				."\n\nYou receive this email because you "
  				."requested to be notified when new versions of this package "
  				."were released. If you don't wish to be notified in the "
- 				."future, please login to SourceForge and click this link: "
  				."<http://$GLOBALS[HTTP_HOST]/project/filemodule_monitor.php?filemodule_id=$package_id> "
- 				."\nIf you lost your SourceForge login name or password, refer to "
- 				."this document: "
- 				."<http://$GLOBALS[HTTP_HOST]/docman/display_doc.php?docid=760&group_id=1> "
  				."\n\nNote that you may receive this message indirectly via one of "
  				."your mailing list subscriptions. Please review message headers "
- 				."before reporting unsolicited mailings."
- 				;
  
  			$text = util_line_wrap($text);
  			
- 			util_send_mail("noreply@$GLOBALS[sys_default_domain]",$subject,$text,"noreply@$GLOBALS[sys_default_domain]",$list);			
  
  			return $result;
  		} else {
- 			$this->setError(' FRS Send Notice Failed ');
- 			return false;
- 		}
- 	}
- 
- 	/**
- 	 * frsMoveFile() - Move a file from the FTP upload dir to a projects dir
- 	 *
- 	 * @param	string	The name of the file
- 	 * @param	string	The name of the group
- 	 * @param	int		The date/time of the move
- 	 * @param	string	The FTP upload dir.  This is probably not needed.
- 	 * @param	int		The ID of the release
- 	 */
- 	function frsMoveFile($file, $group_unix_name, $now, $FTPINCOMING_DIR, $release_id) {
- //
- //
- //	filename validation?
- //	permission checks??
- //
- //
- 		clearstatcache();
- 		if (is_file("$FTPINCOMING_DIR/$file") && file_exists("$FTPINCOMING_DIR/$file")) {
- 			//move the file to a its project page using a setuid program
- 			exec ("/usr/local/bin/fileforge $file $group_unix_name", $exec_res);
- 			if ($exec_res[0]) {
- 				$this->setError("FRS Move File Failed: $exec_res[0],$exec_res[1]");
  				return false;
  			}
- 		} else {
- 			$this->setError("| FRS Move File Failed: File Name Invalid Or Does Not Exist: $FTPINCOMING_DIR/$file ");
- 			return false;
  		}
- 
- 		return true;
  	}
  
  	/**
--- 681,703 ----
  				."\n\nYou receive this email because you "
  				."requested to be notified when new versions of this package "
  				."were released. If you don't wish to be notified in the "
+ 				."future, please login to GForge and click this link: "
  				."<http://$GLOBALS[HTTP_HOST]/project/filemodule_monitor.php?filemodule_id=$package_id> "
  				."\n\nNote that you may receive this message indirectly via one of "
  				."your mailing list subscriptions. Please review message headers "
+ 				."before reporting unsolicited mailings.";
  
  			$text = util_line_wrap($text);
  			
+ 			util_send_message("noreply@$GLOBALS[sys_default_domain]",$subject,$text,"noreply@$GLOBALS[sys_default_domain]",$list);			
  
  			return $result;
  		} else {
+ 			if (db_error()) {
+ 				$this->setError(' FRS Send Notice Failed ');
  				return false;
  			}
  		}
  	}
  
  	/**
