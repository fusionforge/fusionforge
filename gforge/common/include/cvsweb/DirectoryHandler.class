<?php
class DirectoryHandler extends ErrorHandler
{
    var $__DIR_HANDLER = null;
    var $__DIR_NAME = "";
    var $__TO_HIDE = null;
    
    function openDirectory()
    {
	if($this->__DIR_NAME == "")
	{
	    $this->setError("You must provide a directory name");
	    return false;
	}
	if(!is_dir($this->__DIR_NAME))
	{
	    $this->setError($this->__DIR_NAME." is not a directory");
	    return false;
	}
	$this->__DIR_HANDLER = @opendir($this->__DIR_NAME);
	$this->__DIR_NAME = $DIRNAME;
	if(!$this->__DIR_HANDLER)
	{
	    $this->setError("Could not open directory '".$this->__DIR_NAME."'");
	    return false;
	}
	return true;
    }
    
    function closeDirectory()
    {
	closedir($this->__DIR_HANDLER);
	$this->__DIR_HANDLER = null;
	$this->__DIR_NAME = "";
    }
    
    function readDirectory($DIRNAME)
    {
	$this->__DIR_NAME = $DIRNAME;
	if(!$this->openDirectory())
	    return false;
	
	$directories = array();
	$files = array();
	while(false !== ($file = readdir($this->__DIR_HANDLER)))
	{	
	    $allow = 1;
	    if(is_array($this->__TO_HIDE))
	    {
		foreach($this->__TO_HIDE AS $k=>$v)
		{
		    if($v == ".")
			$v = "\.";
		    $pregString = "/^$v/";
		    if(preg_match($pregString,$file))
			$allow = 0;
		}
	    }

	    if($allow)
	    {
	        if(is_dir($DIRNAME."/".$file))
		    array_push($directories,$file);
		if(is_file($DIRNAME."/".$file))
		    array_push($files,$file);
	    }
	}
	
	$this->closeDirectory();
	
	sort($files);
	sort($directories);
	
	return array_merge($directories,$files);
    }
    
    function hideFiles($FILES=".|CVS")
    {	$this->__TO_HIDE = explode("|",$FILES);}
}
?>