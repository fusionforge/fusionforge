<?php

/**
 * GForge Search Engine
 *
 * Portions Copyright 1999-2001 (c) VA Linux Systems
 * The rest Copyright 2004 (c) Guillaume Smet / Open Wide
 *
 * http://gforge.org
 *
 * @version $Id$
 */

require_once('common/search/SearchQuery.class');

class ForumSearchQuery extends SearchQuery {
	
	/**
	 * group id
	 *
	 * @var int $groupId
	 */
	var $groupId;
	
	/**
	 * forum id
	 *
	 * @var int $groupId
	 */
	var $forumId;
	
	/**
	 * Constructor
	 *
	 * @param string $words words we are searching for
	 * @param int $offset offset
	 * @param boolean $isExact if we want to search for all the words or if only one matching the query is sufficient
	 * @param int $groupId group id
	 * @param int $forumId forum id
	 */
	function ForumSearchQuery($words, $offset, $isExact, $groupId, $forumId) {
		$this->groupId = $groupId;
		$this->forumId = $forumId;
		
		$this->SearchQuery($words, $offset, $isExact);
	}

	/**
	 * getQuery - get the sql query built to get the search results
	 *
	 * @return string sql query to execute
	 */
	function getQuery() {
		$sql = 'SELECT forum.msg_id, forum.subject, forum.post_date, users.realname '
			. 'FROM forum,users '
			. 'WHERE users.user_id=forum.posted_by '
			. 'AND (('.$this->getIlikeCondition('forum.body', $this->words).') '
			. 'OR ('.$this->getIlikeCondition('forum.subject', $this->words).')) '
			. 'AND forum.group_forum_id=\''.$this->forumId.'\' '
			. 'GROUP BY msg_id, subject, post_date, realname';

		return $sql;
	}
	
	/**
	 * getSearchByIdQuery - get the sql query built to get the search results when we are looking for an int
	 *
	 * @return string sql query to execute
	 */	
	function getSearchByIdQuery() {
		$sql = 'SELECT msg_id '
			. 'FROM forum '
			. 'WHERE msg_id=\''.$this->searchId.'\' '
			. 'AND group_forum_id=\''.$this->forumId.'\'';

		return $sql;
	}
}

?>