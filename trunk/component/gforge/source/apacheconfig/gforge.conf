#
# Apache configuration for %FRIENDLY_NAME%
#

<IfModule !mod_dav.c>
#LoadModule dav_module         modules/mod_dav.so
</IfModule>

<IfModule !mod_dav_fs.c>
#LoadModule dav_fs_module      modules/mod_dav_fs.so
</IfModule>

<IfModule !mod_dav_svn.c>
#LoadModule dav_svn_module     modules/mod_dav_svn.so
</IfModule>

<IfModule !mod_auth_gforge.c>
#LoadModule auth_gforge_module modules/mod_auth_gforge.so
</IfModule>

#
# HTTP virtual host
#
NameVirtualHost *:80
<VirtualHost *:80>
    #
    # Server name
    #
    ServerName @fqdn_hostname@
    #
    # Document root
    #
    DocumentRoot "%DATADIR%/%NAME%/www"
    <Directory "%DATADIR%/%NAME%/www">
        Options Indexes FollowSymLinks
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>
    #
    # Page not found page
    #
    ErrorDocument 404 /404.php
    #
    # Enable path information
    #
    AcceptPathInfo On
    #
    # Unlimited request body size
    #
    LimitRequestBody 0
    #
    # Forge /projects and /users to be treated as PHP scripts
    #
    <Location /projects>
        ForceType application/x-httpd-php
    </Location>
    <Location /users>
        ForceType application/x-httpd-php
    </Location>
    #
    # Directory index page
    #
    DirectoryIndex index.php index.html index.htm
    #
    # Group directories
    #
    AliasMatch ^/home/([^/]+)/(.*) %LOCALSTATEDIR%/lib/%NAME%/home/groups/$1/htdocs/$2
    AliasMatch ^/home/([^/]+) %LOCALSTATEDIR%/lib/%NAME%/home/groups/$1/htdocs
    <Directory "%LOCALSTATEDIR%/lib/%NAME%/home/groups">
        Options Indexes FollowSymLinks
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>
    #
    # PHP configuration
    #
    php_value include_path "%DATADIR%/%NAME%/override/:%DATADIR%/%NAME%/override/www/include/:.:%DATADIR%/%NAME%/:%DATADIR%/%NAME%/www/include/:%SYSCONFDIR%/%NAME%/"
    php_flag register_globals on
    php_flag magic_quotes_gpc on
    php_value default_charset "UTF-8"
    php_admin_value error_reporting 2047
    php_admin_flag display_errors off
    php_admin_flag log_errors on
    php_value max_execution_time 120
    php_value memory_limit @upload_max_size_x_2@M
    php_admin_flag file_uploads on
    php_value upload_max_filesize @upload_max_size@M
    php_value post_max_size @upload_max_size@M
    php_admin_value upload_tmp_dir %LOCALSTATEDIR%/lib/%NAME%/upload_tmp_dir
</VirtualHost>

#
# HTTPS virtual host
#
NameVirtualHost *:443
<VirtualHost *:443>
    #
    # Server name
    #
    ServerName @fqdn_hostname@
    #
    # Document root
    #
    DocumentRoot "%DATADIR%/%NAME%/www"
    <Directory "%DATADIR%/%NAME%/www">
        Options Indexes FollowSymLinks
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>
    #
    # Page not found page
    #
    ErrorDocument 404 /404.php
    #
    # Enable path information
    #
    AcceptPathInfo On
    #
    # Unlimited request body size
    #
    LimitRequestBody 0
    #
    # Forge /projects and /users to be treated as PHP scripts
    #
    <Location /projects>
        ForceType application/x-httpd-php
    </Location>
    <Location /users>
        ForceType application/x-httpd-php
    </Location>
    #
    # Directory index page
    #
    DirectoryIndex index.php index.html index.htm
    #
    # Group directories
    #
    AliasMatch ^/home/([^/]+)/(.*) %LOCALSTATEDIR%/lib/%NAME%/home/groups/$1/htdocs/$2
    AliasMatch ^/home/([^/]+) %LOCALSTATEDIR%/lib/%NAME%/home/groups/$1/htdocs
    <Directory "%LOCALSTATEDIR%/lib/%NAME%/home/groups">
        Options Indexes FollowSymLinks
        AllowOverride None
        Order allow,deny
        Allow from all
    </Directory>
    #
    # PHP configuration
    #
    php_value include_path "%DATADIR%/%NAME%/override/:%DATADIR%/%NAME%/override/www/include/:.:%DATADIR%/%NAME%/:%DATADIR%/%NAME%/www/include/:%SYSCONFDIR%/%NAME%/"
    php_flag register_globals on
    php_flag magic_quotes_gpc on
    php_value default_charset "UTF-8"
    php_admin_value error_reporting 2047
    php_admin_flag display_errors off
    php_admin_flag log_errors on
    php_value max_execution_time 120
    php_value memory_limit @upload_max_size_x_2@M
    php_admin_flag file_uploads on
    php_value upload_max_filesize @upload_max_size@M
    php_value post_max_size @upload_max_size@M
    php_admin_value upload_tmp_dir %LOCALSTATEDIR%/lib/%NAME%/upload_tmp_dir
    #
    # SSL configuration
    #
    SSLEngine on
    SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP
    SSLCertificateFile %SYSCONFDIR%/%NAME%/ssl/server.crt
    SSLCertificateKeyFile %SYSCONFDIR%/%NAME%/ssl/server.key
    SSLCertificateChainFile %SYSCONFDIR%/%NAME%/ssl/ca.crt
    SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown downgrade-1.0 force-response-1.0
</VirtualHost>
