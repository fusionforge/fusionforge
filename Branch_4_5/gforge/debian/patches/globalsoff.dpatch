#! /bin/sh /usr/share/dpatch/dpatch-run
## 99-unnamed.dpatch by Christian Bayle <bayle@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad gforge/common/frs/FRSRelease.class /tmp/dpep.cr36JK/gforge/common/frs/FRSRelease.class
--- gforge/common/frs/FRSRelease.class	2005-01-19 22:18:42.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/common/frs/FRSRelease.class	2005-01-21 00:09:56.000000000 +0100
@@ -246,9 +246,9 @@
 		$this->FRSPackage->Group->getPublicName(),
 		$this->FRSPackage->Group->getUnixName(),
 		$this->FRSPackage->getName(),
-		"<http://".$GLOBALS['HTTP_HOST']."/project/showfiles.php?group_id=". $this->FRSPackage->Group->getID() ."&release_id=". $this->getID(),
+		"<http://".getStringFromServer('HTTP_HOST')."/project/showfiles.php?group_id=". $this->FRSPackage->Group->getID() ."&release_id=". $this->getID(),
 		$GLOBALS['sys_name'],
-		"<http://$GLOBALS[HTTP_HOST]/project/filemodule_monitor.php?filemodule_id=".$this->FRSPackage->getID()."&group_id=".$this->FRSPackage->Group->getID()."&stop=1>")));
+		"<http://".getStringFromServer('HTTP_HOST')."/project/filemodule_monitor.php?filemodule_id=".$this->FRSPackage->getID()."&group_id=".$this->FRSPackage->Group->getID()."&stop=1>")));
 			
 
 		$text = util_line_wrap($text);
diff -urNad gforge/common/include/Jabber.class /tmp/dpep.cr36JK/gforge/common/include/Jabber.class
--- gforge/common/include/Jabber.class	2005-01-19 22:18:43.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/common/include/Jabber.class	2005-01-21 00:09:56.000000000 +0100
@@ -163,7 +163,7 @@
 
 		$this->iq_version_name		= "Class.Jabber.PHP by Carlo 'Gossip' Zottmann, gossip@jabber.g-blog.net";
 		$this->iq_version_version	= "0.1.3";
-		$this->iq_version_os		= $_SERVER["SERVER_SOFTWARE"];
+		$this->iq_version_os		= getStringFromServer('SERVER_SOFTWARE');
 
 		$this->connection_class		= "CJP_StandardConnector";
 
diff -urNad gforge/common/include/session.php /tmp/dpep.cr36JK/gforge/common/include/session.php
--- gforge/common/include/session.php	2005-01-19 22:18:43.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/common/include/session.php	2005-01-21 00:09:56.000000000 +0100
@@ -33,13 +33,18 @@
 $G_SESSION = false;
 
 /**
+ * Get session id
+ */
+$session_ser = getStringFromCookie('session_ser');
+
+/**
  *	session_build_session_cookie() - Construct session cookie for the user
  *
  *	@param		int		User_id of the logged in user
  *	@return cookie value
  */
 function session_build_session_cookie($user_id) {
-	$session_serial = $user_id.'-*-'.time().'-*-'.$GLOBALS['REMOTE_ADDR'].'-*-'.$GLOBALS['HTTP_USER_AGENT'];
+	$session_serial = $user_id.'-*-'.time().'-*-'.getStringFromServer('REMOTE_ADDR').'-*-'.getStringFromServer('HTTP_USER_AGENT');
 	$session_serial_hash = md5($session_serial.$GLOBALS['sys_session_key']);
 	$session_serial_cookie = base64_encode($session_serial).'-*-'.$session_serial_hash;
 	return $session_serial_cookie;
@@ -76,10 +81,10 @@
 
 	list($user_id, $time, $ip, $user_agent) = explode('-*-', $session_serial, 4);
 
-	if (!session_check_ip($ip, $GLOBALS['REMOTE_ADDR'])) {
+	if (!session_check_ip($ip, getStringFromServer('REMOTE_ADDR'))) {
 		return false;
 	}
-	if (trim($user_agent) != $GLOBALS['HTTP_USER_AGENT']) {
+	if (trim($user_agent) != getStringFromServer('HTTP_USER_AGENT')) {
 		return false;
 	}
 	if ($time - time() >= $GLOBALS['sys_session_expire']) {
@@ -266,8 +271,7 @@
  *	@access public
  */
 function session_issecure() {
-	global $HTTP_SERVER_VARS;
-	return ($HTTP_SERVER_VARS['SERVER_PORT'] == '443');
+	return (getStringFromServer('SERVER_PORT') == '443');
 }
 
 /**
@@ -297,8 +301,7 @@
  *	@return never returns
  */
 function session_redirect($loc) {
-	global $HTTP_SERVER_VARS;	
-	header('Location: http' . (session_issecure()?'s':'') . '://' . $HTTP_SERVER_VARS['HTTP_HOST'] . $loc);
+	header('Location: http' . (session_issecure()?'s':'') . '://' . getStringFromServer('HTTP_HOST') . $loc);
 	print("\n\n");
 	exit;
 }
@@ -369,7 +372,7 @@
 		INSERT INTO user_session (session_hash, ip_addr, time, user_id) 
 		VALUES (
 			'".session_get_session_cookie_hash($cookie)."', 
-			'".$GLOBALS['REMOTE_ADDR']."',
+			'".getStringFromServer('REMOTE_ADDR')."',
 			'".time()."',
 			$user_id
 		)
diff -urNad gforge/common/include/utils.php /tmp/dpep.cr36JK/gforge/common/include/utils.php
--- gforge/common/include/utils.php	2005-01-19 22:18:43.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/common/include/utils.php	2005-01-21 00:09:56.000000000 +0100
@@ -41,12 +41,16 @@
  *
  * @param	   string  The name of the file being uploaded
  */
-function util_check_fileupload($filename) {
+function util_check_fileupload($file) {
 
 	/* Empty file is a valid file.
 	This is because this function should be called
 	unconditionally at the top of submit action processing
 	and many forms have optional file upload. */
+	if (!$file) {
+		return true;
+	}
+	$filename = $file['tmp_name'];
 	if ($filename == 'none' || $filename == '') {
 		return true;
 	}
@@ -697,7 +701,7 @@
 			for ($i = 0; $i < $cols; $i++) {
 				if(in_array($i, $colsToKeep)) {
 					if ($linkify && $i == 0) {
-						$link = '<a href="'.$PHP_SELF.'?';
+						$link = '<a href="'.getStringFromServer('PHP_SELF').'?';
 						$linkend = '</a>';
 						if ($linkify == "bug_cat") {
 							$link .= 'group_id='.$group_id.'&amp;bug_cat_mod=y&amp;bug_cat_id='.db_result($result, $j, 'bug_category_id').'">';
diff -urNad gforge/cronjobs/cvs-cron/default_page.php /tmp/dpep.cr36JK/gforge/cronjobs/cvs-cron/default_page.php
--- gforge/cronjobs/cvs-cron/default_page.php	2005-01-19 22:18:43.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/cronjobs/cvs-cron/default_page.php	2005-01-21 00:09:56.000000000 +0100
@@ -1,7 +1,7 @@
 <?php
 
-$domain=ereg_replace('[^\.]*\.(.*)$','\1',$GLOBALS['HTTP_HOST']);
-$group_name=ereg_replace('([^\.]*)\..*$','\1',$GLOBALS['HTTP_HOST']);
+$domain=ereg_replace('[^\.]*\.(.*)$','\1',$_SERVER['HTTP_HOST']);
+$group_name=ereg_replace('([^\.]*)\..*$','\1',$_SERVER['HTTP_HOST']);
 
 echo '<?xml version="1.0" encoding="UTF-8"?>';
 ?>
diff -urNad gforge/www/account/change_email-complete.php /tmp/dpep.cr36JK/gforge/www/account/change_email-complete.php
--- gforge/www/account/change_email-complete.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/change_email-complete.php	2005-01-21 00:09:56.000000000 +0100
@@ -28,7 +28,10 @@
 require_once('pre.php');    
 require_once('common/include/account.php');
 
+$confirm_hash = getStringFromRequest('confirm_hash');
+
 if (!$confirm_hash) {
+	// XXX ogi: What's $ch?
 	$confirm_hash = $ch;
 }
 if (!$confirm_hash) {
diff -urNad gforge/www/account/change_email.php /tmp/dpep.cr36JK/gforge/www/account/change_email.php
--- gforge/www/account/change_email.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/change_email.php	2005-01-21 00:09:56.000000000 +0100
@@ -28,7 +28,8 @@
 session_require(array('isloggedin'=>1));
 
 
-if ($newemail) {
+if (getStringFromRequest('submit')) {
+	$newemail = getStringFromRequest('newemail');
 
 	if (!validate_email($newemail)) {
 		exit_error($Language->getText('general','error'),$Language->getText('account_change_email','invalid_email'));
@@ -50,7 +51,7 @@
 		);
 	}
 
-	$message = stripcslashes($Language->getText('account_change_email', 'message', array($GLOBALS[HTTP_HOST], $confirm_hash, $GLOBALS['sys_name'])));
+	$message = stripcslashes($Language->getText('account_change_email', 'message', array(getStringFromServer('HTTP_HOST'), $confirm_hash, $GLOBALS['sys_name'])));
 
 	util_send_message($newemail,$Language->getText('account_change_email', 'subject', $GLOBALS['sys_name']),$message);
 
@@ -68,7 +69,7 @@
 echo $Language->getText('account_change_email', 'desc');
 ?>
 
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <?php echo $Language->getText('account_change_email','new_address') ?>
 <input type="text" name="newemail" maxlength="255" />
 <input type="submit" name="submit" value="<?php echo $Language->getText('account_change_email','send_confirmation') ?>" />
diff -urNad gforge/www/account/change_pw.php /tmp/dpep.cr36JK/gforge/www/account/change_pw.php
--- gforge/www/account/change_pw.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/change_pw.php	2005-01-21 00:09:56.000000000 +0100
@@ -35,7 +35,10 @@
 	exit_error('Error',$u->getErrorMessage());
 }
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
+	$old_passwd = getStringFromRequest('old_passwd');
+	$passwd = getStringFromRequest('passwd');
+	$passwd2 = getStringFromRequest('passwd2');
 
 	if ($u->getMD5Passwd() != md5($old_passwd)) {
 		exit_error(
@@ -80,7 +83,7 @@
 	site_user_header(array('title'=>$Language->getText('account_change_pw','title')));
 	?>
 
-	<form action="<?php echo $PHP_SELF; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 	<p><?php echo $Language->getText('account_change_pw','old_password') ?>:
 	<br /><input type="password" name="old_passwd" /></p>
 	<p><?php echo $Language->getText('account_change_pw','new_password') ?>:
diff -urNad gforge/www/account/editsshkeys.php /tmp/dpep.cr36JK/gforge/www/account/editsshkeys.php
--- gforge/www/account/editsshkeys.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/editsshkeys.php	2005-01-21 00:09:56.000000000 +0100
@@ -34,7 +34,9 @@
 	exit_error('Error',$u->getErrorMessage());
 }
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
+	$authorized_keys = getStringFromRequest('authorized_keys');
+
 	if (!$u->setAuthorizedKeys($authorized_keys)) {
 		exit_error(
 			'Error',
@@ -50,7 +52,7 @@
 	echo $Language->getText('account_editsshkeys', 'intro');
 	?>
 
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <p><?php echo $Language->getText('account_editsshkeys', 'authorized_keys'); ?>
 <br />
 <textarea rows="10" name="authorized_keys" style="width:90%;">
diff -urNad gforge/www/account/index.php /tmp/dpep.cr36JK/gforge/www/account/index.php
--- gforge/www/account/index.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -36,7 +36,24 @@
     exit_error('Error',$u->getErrorMessage());
 }
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
+	$firstname = getStringFromRequest('firstname');
+	$lastname = getStringFromRequest('lastname');
+	$language = getIntFromRequest('language');
+	$timezone = getStringFromRequest('timezone');
+	$theme_id = getIntFromRequest('theme_id');
+	$ccode = getStringFromRequest('ccode');
+	$address = getStringFromRequest('address');
+	$address2 = getStringFromRequest('address2');
+	$phone = getStringFromRequest('phone');
+	$fax = getStringFromRequest('fax');
+	$title = getStringFromRequest('title');
+	$jabber_address = getStringFromRequest('jabber');
+	$jabber_only = getStringFromRequest('jabber');
+	$mail_site = getStringFromRequest('mail_site');
+	$mail_va = getStringFromRequest('mail_va');
+	$remember_user = getStringFromRequest('remember_user');
+	$use_ratings = getStringFromRequest('use_ratings');
 
 /*
 //needs security audit
@@ -48,7 +65,7 @@
 		setcookie("sf_user_hash",'',0,'/');
 	}
 */
-	// Refresh page if language changed
+	// Refresh page if language or theme changed
 	if ($language != $u->getLanguage() || $theme_id != $u->getThemeID()) {
 		$refresh = 1;
 	}
@@ -68,7 +85,7 @@
 
 site_user_header(array('title'=>$Language->getText('account_options', 'title')));
 
-echo '<form action="'.$PHP_SELF.'" method="post">';
+echo '<form action="'.getStringFromServer('PHP_SELF').'" method="post">';
 
 echo $HTML->boxTop($Language->getText('account_options', 'title'));
 
diff -urNad gforge/www/account/login.php /tmp/dpep.cr36JK/gforge/www/account/login.php
--- gforge/www/account/login.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/login.php	2005-01-21 00:09:56.000000000 +0100
@@ -33,6 +33,11 @@
 
 require_once('pre.php');
 
+$return_to = getStringFromRequest('return_to');
+$login = getStringFromRequest('login');
+$form_loginname = getStringFromRequest('form_loginname');
+$form_pw = getStringFromRequest('form_pw');
+
 //
 //	Validate return_to
 //
@@ -45,7 +50,7 @@
 
 if ($sys_use_ssl && !session_issecure()) {
 	//force use of SSL for login
-	header('Location: https://'.$HTTP_HOST.$REQUEST_URI);
+	header('Location: https://'.getStringFromServer('HTTP_HOST').getStringFromServer('REQUEST_URI'));
 }
 
 // Decide login button based on session.
@@ -102,7 +107,7 @@
 <p>
 <span style="color:red"><strong><?php echo $Language->getText('account_login', 'cookiewarn'); ?></strong></span>
 </p>
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <input type="hidden" name="return_to" value="<?php echo $return_to; ?>" />
 <p>
 <?php echo $Language->getText('account_login', 'loginname'); ?>
diff -urNad gforge/www/account/lostlogin.php /tmp/dpep.cr36JK/gforge/www/account/lostlogin.php
--- gforge/www/account/lostlogin.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/lostlogin.php	2005-01-21 00:09:56.000000000 +0100
@@ -28,7 +28,12 @@
 require_once('pre.php');
 require_once('common/include/account.php');
 
+$passwd = getStringFromRequest('passwd');
+$passwd2 = getStringFromRequest('passwd2');
+$confirm_hash = getStringFromRequest('confirm_hash');
+
 if (!$confirm_hash) {
+	// XXX ogi: What's $ch?
 	$confirm_hash = $ch;
 }
 if (!$confirm_hash) {
@@ -91,7 +96,7 @@
 echo $Language->getText('account_lostlogin','welcome',$u->getUnixName());
 ?>
 
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <p><?php echo $Language->getText('account_lostlogin','newpasswd'); ?>:
 <br /><input type="password" name="passwd" /></p>
 <p><?php echo $Language->getText('account_lostlogin','newpasswd2'); ?>:
diff -urNad gforge/www/account/lostpw.php /tmp/dpep.cr36JK/gforge/www/account/lostpw.php
--- gforge/www/account/lostpw.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/lostpw.php	2005-01-21 00:09:56.000000000 +0100
@@ -31,7 +31,8 @@
 
 require_once('pre.php');
 
-if ($loginname) {
+if (getStringFromRequest('submit')) {
+	$loginname = getStringFromRequest('loginname');
 
 	$u = user_get_object_by_name($loginname);
 
@@ -48,7 +49,7 @@
 		exit_error('Error',$u->getErrorMessage());
 	} else {
 
-		$message = stripcslashes($Language->getText('account_lostpw', 'message', array($GLOBALS['HTTP_HOST'], $confirm_hash, $GLOBALS['sys_name'])));
+		$message = stripcslashes($Language->getText('account_lostpw', 'message', array(getStringFromServer('HTTP_HOST'), $confirm_hash, $GLOBALS['sys_name'])));
 
 		util_send_message($u->getEmail(),$Language->getText('account_lostpw', 'subject', $GLOBALS['sys_name']),$message);
 
@@ -67,7 +68,7 @@
 echo $Language->getText('account_lostpw','warn');
 ?>
 
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <p>
 <?php echo $Language->getText('account_login', 'loginname'); ?>
 <br />
diff -urNad gforge/www/account/pending-resend.php /tmp/dpep.cr36JK/gforge/www/account/pending-resend.php
--- gforge/www/account/pending-resend.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/pending-resend.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,7 +25,9 @@
 
 require_once('pre.php');
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
+	$loginname = getStringFromRequest('loginname');
+
 	$u = user_get_object_by_name($loginname);
 	if (!$u || !is_object($u)) {
 		exit_error('Error','Could Not Get User');
@@ -58,7 +60,7 @@
 echo $Language->getText('account_login', 'resend_pending_directions');
 ?>
 
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <p><?php echo $Language->getText('account_verify', 'loginname'); ?>
 <br /><input type="text" name="loginname" /></p>
 <p><input type="submit" name="submit" value="<?php echo "Submit"; ?>" /></p>
diff -urNad gforge/www/account/register.php /tmp/dpep.cr36JK/gforge/www/account/register.php
--- gforge/www/account/register.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/register.php	2005-01-21 00:09:56.000000000 +0100
@@ -31,11 +31,32 @@
 	session_require(array('group'=>'1','admin_flags'=>'A'));
 }
 
+$unix_name = getStringFromRequest('unix_name');
+$firstname = getStringFromRequest('firstname');
+$lastname = getStringFromRequest('lastname');
+$password1 = getStringFromRequest('password1');
+$password2 = getStringFromRequest('password2');
+$email = getStringFromRequest('email');
+$mail_site = getStringFromRequest('mail_site');
+$mail_va = getStringFromRequest('mail_va');
+$language_id = getIntFromRequest('language_id');
+$timezone = getStringFromRequest('timezone');
+$jabber_address = getStringFromRequest('jabber_address');
+$jabber_only = getStringFromRequest('jabber_only');
+$theme_id = getIntFromRequest('theme_id');
+$address = getStringFromRequest('address');
+$address2 = getStringFromRequest('address2');
+$phone = getStringFromRequest('phone');
+$fax = getStringFromRequest('fax');
+$title = getStringFromRequest('title');
+$ccode = getStringFromRequest('ccode');
+
 if (!$theme_id) {
 	$theme_id=$HTML->getThemeIdFromName($sys_theme);
 }
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
+
 	/*
 
 		Adding call to library rather than
@@ -71,7 +92,7 @@
 }
 ?>
 
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <p>
 <?php echo $Language->getText('account_register','loginname'); echo utils_requiredField(); ?><br />
 <input type="text" name="unix_name" value="<?php print($unix_name); ?>">
diff -urNad gforge/www/account/unsubscribe.php /tmp/dpep.cr36JK/gforge/www/account/unsubscribe.php
--- gforge/www/account/unsubscribe.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/unsubscribe.php	2005-01-21 00:09:56.000000000 +0100
@@ -28,7 +28,10 @@
 require_once('pre.php');
 require_once('common/include/account.php');
 
+$confirm_hash = getStringFromRequest('confirm_hash');
+
 if (!$confirm_hash) {
+	// XXX ogi: What's $ch?
 	$confirm_hash = $ch;
 }
 if (!$confirm_hash) {
diff -urNad gforge/www/account/verify.php /tmp/dpep.cr36JK/gforge/www/account/verify.php
--- gforge/www/account/verify.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/account/verify.php	2005-01-21 00:09:56.000000000 +0100
@@ -28,7 +28,10 @@
 
 require_once('pre.php');
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
+	$confirm_hash = getStringFromRequest('confirm_hash');
+	$loginname = getStringFromRequest('loginname');
+	$passwd = getStringFromRequest('passwd');
 
 	if (!$loginname) {
 		exit_error(
@@ -86,7 +89,7 @@
 }
 ?>
 
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 
 <p><?php echo $Language->getText('account_verify', 'loginname'); ?>
 <br /><input type="text" name="loginname" /></p>
diff -urNad gforge/www/admin/admin_table.php /tmp/dpep.cr36JK/gforge/www/admin/admin_table.php
--- gforge/www/admin/admin_table.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/admin_table.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,7 +32,7 @@
  *	@param $primary_key - the primary key of the table
  */
 function admin_table_add($table, $unit, $primary_key) {
-	global $PHP_SELF, $Language;
+	global $Language;
 
 	// This query may return no rows, but the field names are needed.
 	$result = db_query('SELECT * FROM '.$table.' WHERE '.$primary_key.'=0');
@@ -41,7 +41,7 @@
 		$cols = db_numfields($result);
 
 		echo $Language->getText('admin_admin_table', 'create_new_below', array(getUnitLabel($unit))).'
-			<form name="add" action="'.$PHP_SELF.'?function=postadd" method="post">
+			<form name="add" action="'.getStringFromServer('PHP_SELF').'?function=postadd" method="post">
 			<table>';
 
 		for ($i = 0; $i < $cols; $i++) {
@@ -51,7 +51,7 @@
 			echo '<td><input type="text" name="'.$fieldname.'" value="" /></td></tr>';
 		}
 		echo '</table><input type="submit" value="'.$Language->getText('general', 'add').'" /></form>
-			<form name="cancel" action="'.$PHP_SELF.'" method="post">
+			<form name="cancel" action="'.getStringFromServer('PHP_SELF').'" method="post">
 			<input type="submit" value="'.$Language->getText('general', 'cancel').'" />
 			</form>';
 	} else {
@@ -91,7 +91,7 @@
  *	@param $id - the id of the record to act on
  */
 function admin_table_confirmdelete($table, $unit, $primary_key, $id) {
-	global $PHP_SELF, $Language;
+	global $Language;
 	
 	if ($unit == "processor") {
 		$result = db_numrows(db_query("SELECT processor_id FROM frs_file WHERE processor_id = $id"));
@@ -125,10 +125,10 @@
 			echo '<li><strong>'.db_fieldname($result,$i).'</strong> '.db_result($result,0,$i).'</li>';
 		}
 		echo '</ul>
-			<form name="delete" action="'.$PHP_SELF.'?function=delete&amp;id='.$id.'" method="post">
+			<form name="delete" action="'.getStringFromServer('PHP_SELF').'?function=delete&amp;id='.$id.'" method="post">
 			<input type="submit" value="'.$Language->getText('general', 'delete').'" />
 			</form>
-			<form name="cancel" action="'.$PHP_SELF.'" method="post">
+			<form name="cancel" action="'.getStringFromServer('PHP_SELF').'" method="post">
 			<input type="submit" value="'.$Language->getText('general', 'cancel').'" />
 			</form>';
 	} else {
@@ -164,7 +164,7 @@
  *	@param $id - the id of the record to act on
  */
 function admin_table_edit($table, $unit, $primary_key, $id) {
-	global $PHP_SELF, $Language;
+	global $Language;
 
 	$result = db_query("SELECT * FROM $table WHERE $primary_key=$id");
 
@@ -172,7 +172,7 @@
 		$cols = db_numfields($result);
 
 		echo $Language->getText('admin_admin_table', 'modify_below', array(getUnitLabel($unit))).'
-			<form name="edit" action="'.$PHP_SELF.'?function=postedit&amp;id='.$id.'" method="post">
+			<form name="edit" action="'.getStringFromServer('PHP_SELF').'?function=postedit&amp;id='.$id.'" method="post">
 			<table>';
 
 		for ($i = 0; $i < $cols; $i++) {
@@ -188,7 +188,7 @@
 			}
 		}
 		echo '</table><input type="submit" value="'.$Language->getText('general', 'submit').'" /></form>
-			<form name="cancel" action="'.$PHP_SELF.'" method="post">
+			<form name="cancel" action="'.getStringFromServer('PHP_SELF').'" method="post">
 			<input type="submit" value="'.$Language->getText('general', 'cancel').'" />
 			</form>';
 	} else {
@@ -231,7 +231,7 @@
  *	@param $primary_key - the primary key of the table
  */
 function admin_table_show($table, $unit, $primary_key) {
-        global $HTML, $PHP_SELF, $Language;
+        global $HTML, $Language;
 
         $result = db_query("SELECT * FROM $table ORDER BY $primary_key");
 
@@ -240,7 +240,7 @@
 		$cols = db_numfields($result);
 
 		$cell_data=array();
-		$cell_data[]=array(ucwords(getUnitLabel($unit)).' <a href="'.$PHP_SELF.'?function=add">['.$Language->getText('admin_admin_table', 'add_new').']</a>',
+		$cell_data[]=array(ucwords(getUnitLabel($unit)).' <a href="'.getStringFromServer('PHP_SELF').'?function=add">['.$Language->getText('admin_admin_table', 'add_new').']</a>',
 			'colspan="'.($cols+1).'"');
 
                 echo '<table border="0" width="100%">';
@@ -257,8 +257,8 @@
 			echo '<tr '. $HTML->boxGetAltRowStyle($j) . '>';
 
                         $id = db_result($result,$j,0);
-                        echo '<td><a href="'.$PHP_SELF.'?function=edit&amp;id='.$id.'">['.$Language->getText('general', 'edit').']</a>';
-                        echo '<a href="'.$PHP_SELF.'?function=confirmdelete&amp;id='.$id.'">['.$Language->getText('general', 'delete').']</a> </td>';
+                        echo '<td><a href="'.getStringFromServer('PHP_SELF').'?function=edit&amp;id='.$id.'">['.$Language->getText('general', 'edit').']</a>';
+                        echo '<a href="'.getStringFromServer('PHP_SELF').'?function=confirmdelete&amp;id='.$id.'">['.$Language->getText('general', 'delete').']</a> </td>';
 			for ($i = 0; $i < $cols; $i++) {
 				echo '<td>'. db_result($result, $j, $i) .'</td>';
 			}
@@ -292,7 +292,12 @@
 <p><a href="/admin/">'.$Language->getText('admin_admin_table', 'site_admin_home').'</a></p>
 <p>&nbsp;</p>';
 
-switch ($function) {
+$table = getStringFromRequest('table');
+$unit = getStringFromRequest('unit');
+$primary_key = getStringFromRequest('primary_key');
+$id = getStringFromRequest('id');
+
+switch (getStringFromRequest('function')) {
 	case 'add' : {
 		admin_table_add($table, $unit, $primary_key);
 		break;
diff -urNad gforge/www/admin/approve-pending.php /tmp/dpep.cr36JK/gforge/www/admin/approve-pending.php
--- gforge/www/admin/approve-pending.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/approve-pending.php	2005-01-21 00:09:56.000000000 +0100
@@ -67,12 +67,19 @@
 	return true;
 }
 
+$action = getStringFromRequest('action');
 if ($action=='activate') {
+	$list_of_groups = getStringFromRequest('list_of_groups');
 
 	$groups=explode(',', $list_of_groups);
 	array_walk($groups, 'activate_group');
 
 } else if ($action=='delete') {
+	$group_id = getIntFromRequest('group_id');
+	$response_id = getIntFromRequest('response_id');
+	$add_to_can = getStringFromRequest('add_to_can');
+	$response_text = getStringFromRequest('response_text');
+	$response_title = getStringFromRequest('response_title');
 
 	$group =& group_get_object($group_id);
 	if (!$group || !is_object($group)) {
@@ -143,14 +150,14 @@
 
 	<p />
 	<table><tr><td>
-	<form action="<?php echo $PHP_SELF; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 	<input type="hidden" name="action" value="activate" />
 	<input type="hidden" name="list_of_groups" value="<?php print $row_grp['group_id']; ?>" />
 	<input type="submit" name="submit" value="<?php echo $Language->getText('admin_approve_pending','approve'); ?>" />
 	</form>
 	</td></tr>
 	<tr><td>
-	<form action="<?php echo $PHP_SELF; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 	<input type="hidden" name="action" value="delete" />
 	<input type="hidden" name="group_id" value="<?php print $row_grp['group_id']; ?>" />
 	<?php echo $Language->getText('admin_approve_pending','canned_responses'); ?><br />
@@ -201,7 +208,7 @@
 
 echo '
 	<div align="center">
-	<form action="'.$PHP_SELF.'" method="post">
+	<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 	<input type="hidden" name="action" value="activate" />
 	<input type="hidden" name="list_of_groups" value="'.$group_list.'" />
 	<input type="submit" name="submit" value="'.$Language->getText('admin_approve_pending','approve_all_on_this_page').'" />
diff -urNad gforge/www/admin/cronman.php /tmp/dpep.cr36JK/gforge/www/admin/cronman.php
--- gforge/www/admin/cronman.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/cronman.php	2005-01-21 00:09:56.000000000 +0100
@@ -31,7 +31,7 @@
 
 site_admin_header(array('title'=>$Language->getText('admin_index','title')));
 
-$which = getIntFromGet('which');
+$which = getIntFromRequest('which');
 if (!$which || $which==100) {
 	$which=100;
 } else {
@@ -39,7 +39,7 @@
 }
 
 ?>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <?php echo html_build_select_box_from_arrays(array_keys($cron_arr), $cron_arr, 'which', $which,true,'Any'); ?>
 <input type="submit" name="submit" value="<?php echo $Language->getText('general', 'submit');?>">
 </form>
@@ -57,7 +57,7 @@
 $res = db_query($sql);
 $totalCount = db_result($res, 0, 'count');
 
-$offset = getIntFromGet('offset');
+$offset = getIntFromRequest('offset');
 if($offset > $totalCount) {
 	$offset = 0;
 }
diff -urNad gforge/www/admin/database.php /tmp/dpep.cr36JK/gforge/www/admin/database.php
--- gforge/www/admin/database.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/database.php	2005-01-21 00:09:56.000000000 +0100
@@ -40,7 +40,10 @@
 
 session_require(array('group'=>'1','admin_flags'=>'A'));
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
+	$group_id = getIntFromRequest('group_id');
+	$groupname = getStringFromRequest('groupname');
+	$dbname = getStringFromRequest('dbname');
 
 	if ($group_id) {
 
@@ -99,7 +102,7 @@
 
 	while ($row_db = db_fetch_array($res_db)) {
 
-		print '<tr><td align="center"><a href="'.$PHP_SELF.'?displaydb=1&dbstate='.$row_db['stateid'].'">'.$row_db['statename'].'</a></td><td align="center">'.$row_db['count'].'</td></tr>';
+		print '<tr><td align="center"><a href="'.getStringFromServer('PHP_SELF').'?displaydb=1&dbstate='.$row_db['stateid'].'">'.$row_db['statename'].'</a></td><td align="center">'.$row_db['count'].'</td></tr>';
 
 	}
 
@@ -146,7 +149,7 @@
 
 <h3><?php echo $Language->getText('admin_database','add_an_already_active_database'); ?></h3>
 
-<form name="madd" method="post" action="<?php  echo $PHP_SELF; ?>">
+<form name="madd" method="post" action="<?php  echo getStringFromServer('PHP_SELF'); ?>">
 
 <table>
 
diff -urNad gforge/www/admin/groupedit.php /tmp/dpep.cr36JK/gforge/www/admin/groupedit.php
--- gforge/www/admin/groupedit.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/groupedit.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,7 @@
 
 session_require(array('group'=>'1','admin_flags'=>'A'));
 
+$group_id = getIntFromRequest('group_id');
 $group =& group_get_object($group_id);
 if (!$group || !is_object($group)) {
 	exit_error('Error','Could Not Get Group');
@@ -70,12 +71,18 @@
 }
 
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
+	$form_public = getStringFromRequest('form_public');
+	$form_status = getStringFromRequest('form_status');
+	$form_license = getStringFromRequest('form_license');
+	$form_box = getStringFromRequest('form_box');
+	$form_domain = getStringFromRequest('form_domain');
+	$form_scm_box = getStringFromRequest('form_scm_box');
 
 	do_update($group, $form_public, $form_status, $form_license,
 		  1, $form_box, $form_domain, $form_scm_box);
 
-} else if ($resend) {
+} else if (getStringFromRequest('resend')) {
 
 	$group->sendApprovalEmail();
 	$feedback .= $Language->getText('admin_groupedit','instruction_email_sent').'<br /> ';
@@ -90,7 +97,7 @@
 <?php print "<a href=\"/project/admin/?group_id=$group_id\"><h3>".$Language->getText('admin_groupedit','project_admin'). "</h3></a>"; ?></p>
 
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 
 
 <table>
diff -urNad gforge/www/admin/grouplist.php /tmp/dpep.cr36JK/gforge/www/admin/grouplist.php
--- gforge/www/admin/grouplist.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/grouplist.php	2005-01-21 00:09:56.000000000 +0100
@@ -28,12 +28,17 @@
 
 site_admin_header(array('title'=>$Language->getText('admin_grouplist','group_list')));
 
+$form_catroot = getStringFromRequest('form_catroot');
+$form_pending = getStringFromRequest('form_pending');
+$sortorder = getStringFromRequest('sortorder');
+$group_name_search = getStringFromRequest('group_name_search');
+$status = getStringFromRequest('status');
+
 // start from root if root not passed in
 if (!$form_catroot) {
 	$form_catroot = 1;
 }
 
-$sortorder = $_GET['sortorder'];
 if (!isset($sortorder) || empty($sortorder)) {
 	$sortorder = "group_name";
 }
@@ -65,7 +70,7 @@
 		. "COUNT(user_group.group_id) AS members "
 		. "FROM groups LEFT JOIN user_group ON user_group.group_id=groups.group_id,group_category,licenses "
 		. "WHERE groups.group_id=group_category.group_id AND "
-		. "group_category.category_id=".$GLOBALS['form_catroot']." AND "
+		. "group_category.category_id=".$form_catroot." AND "
 		. "licenses.license_id=groups.license "
 		. "GROUP BY group_name,register_time,unix_group_name,groups.group_id,is_public,status,license_name "
 		. "ORDER BY $sortorder");
diff -urNad gforge/www/admin/languages/admintabfiles.php /tmp/dpep.cr36JK/gforge/www/admin/languages/admintabfiles.php
--- gforge/www/admin/languages/admintabfiles.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/admintabfiles.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,7 +32,6 @@
  *	@param $primary_key - the primary key of the table
  */
 function admin_table_add($table, $unit, $primary_key, $lang) {
-	global $PHP_SELF;
 
 	// This query may return no rows, but the field names are needed.
 	$result = db_query('SELECT * FROM '.$table.' WHERE '.$primary_key.'=0');
@@ -41,7 +40,7 @@
 		$cols = db_numfields($result);
 
 		echo 'Create a new '.$unit.' below:
-			<form name="add" action="'.$PHP_SELF.'?function=postadd&lang='.$lang.'" method="post">
+			<form name="add" action="'.getStringFromServer('PHP_SELF').'?function=postadd&lang='.$lang.'" method="post">
 			<table>';
 
 		for ($i = 0; $i < $cols; $i++) {
@@ -51,7 +50,7 @@
 			echo '<td><input type="text" name="'.$fieldname.'" value="" /></td></tr>';
 		}
 		echo '</table><input type="submit" value="Submit New '.ucwords($unit).'" /></form>
-			<form name="cancel" action="'.$PHP_SELF.'" method="post">
+			<form name="cancel" action="'.getStringFromServer('PHP_SELF').'" method="post">
 			<input type="submit" value="Cancel" />
 			</form>';
 	} else {
@@ -91,7 +90,6 @@
  *	@param $id - the id of the record to act on
  */
 function admin_table_confirmdelete($table, $unit, $primary_key, $id, $lang) {
-	global $PHP_SELF;
 
 	$result = db_query("SELECT * FROM $table WHERE $primary_key=$id AND language_id='".$lang."'");
 
@@ -104,10 +102,10 @@
 			echo '<li><strong>'.db_fieldname($result,$i).'</strong> '.db_result($result,0,$i).'</li>';
 		}
 		echo '</ul>
-			<form name="delete" action="'.$PHP_SELF.'?function=delete&lang='.$lang.'&amp;id='.$id.'" method="post">
+			<form name="delete" action="'.getStringFromServer('PHP_SELF').'?function=delete&lang='.$lang.'&amp;id='.$id.'" method="post">
 			<input type="submit" value="Delete" />
 			</form>
-			<form name="cancel" action="'.$PHP_SELF.'" method="post">
+			<form name="cancel" action="'.getStringFromServer('PHP_SELF').'" method="post">
 			<input type="submit" value="Cancel" />
 			</form>';
 	} else {
@@ -142,7 +140,6 @@
  *	@param $id - the id of the record to act on
  */
 function admin_table_edit($table, $unit, $primary_key, $id, $lang) {
-	global $PHP_SELF;
 
 	$query="SELECT * FROM $table WHERE $primary_key=$id AND language_id='".$lang."'";
 	//$result = db_query("SELECT * FROM $table WHERE $primary_key=$id AND language_id='".$lang."'");
@@ -153,7 +150,7 @@
 		$cols = db_numfields($result);
 
 		echo 'Modify the '.$unit.' below:
-			<form name="edit" action="'.$PHP_SELF.'?function=postedit&lang='.$lang.'&amp;id='.$id.'" method="post">
+			<form name="edit" action="'.getStringFromServer('PHP_SELF').'?function=postedit&lang='.$lang.'&amp;id='.$id.'" method="post">
 			<table>';
 
 		for ($i = 0; $i < $cols; $i++) {
@@ -172,7 +169,7 @@
 			}
 		}
 		echo '</table><input type="submit" value="Submit Changes" /></form>
-			<form name="cancel" action="'.$PHP_SELF.'?function=show&lang='.$lang.'" method="post">
+			<form name="cancel" action="'.getStringFromServer('PHP_SELF').'?function=show&lang='.$lang.'" method="post">
 			<input type="submit" value="Cancel" />
 			</form>';
 	} else {
@@ -207,7 +204,7 @@
 		echo db_error();
 	}
 	//echo '
-	//		<form name="cancel" action="'.$PHP_SELF.'?function=show&lang='.$lang.'" method="post">
+	//		<form name="cancel" action="'.getStringFromServer('PHP_SELF').'?function=show&lang='.$lang.'" method="post">
 	//		<input type="submit" value="Edit More" />
 	//		</form>';
 	echo admin_table_show($table, $unit, $primary_key, $whereclause, $columns, $edit, $lang);
@@ -221,7 +218,7 @@
  *	@param $primary_key - the primary key of the table
  */
 function admin_table_show($table, $unit, $primary_key, $whereclause, $columns, $edit, $lang) {
-        global $HTML, $PHP_SELF;
+        global $HTML;
 
 	//CB// echo "<h1>SELECT * FROM $table $whereclause</h1>";
         $result = db_query("SELECT $columns FROM $table $whereclause;");
@@ -234,7 +231,7 @@
                 echo '<table border="0" width="100%">
 		<tr bgcolor="'.$HTML->COLOR_HTMLBOX_TITLE.'">
 		<td colspan="'.($cols+1).'"><strong><span style="color:'. $HTML->FONTCOLOR_HTMLBOX_TITLE .'">'. ucwords($unit) .'s</span></strong>';
-		if ($edit) echo '<a href="'.$PHP_SELF.'?function=add&lang='.$lang.'">[add new]</a>';
+		if ($edit) echo '<a href="'.getStringFromServer('PHP_SELF').'?function=add&lang='.$lang.'">[add new]</a>';
 		echo "</td></tr>\n";
 
 		if ($edit) echo '
@@ -251,8 +248,8 @@
 			echo '<tr '. $HTML->boxGetAltRowStyle($j) . '>';
 
                         $id = db_result($result,$j,0);
-                        if ($edit) echo '<td><a href="'.$PHP_SELF.'?function=edit&lang='.$lang.'&amp;id='.$id.'">[edit]</a>';
-                        if ($edit) echo '<a href="'.$PHP_SELF.'?function=confirmdelete&lang='.$lang.'&amp;id='.$id.'">[delete]</a> </td>';
+                        if ($edit) echo '<td><a href="'.getStringFromServer('PHP_SELF').'?function=edit&lang='.$lang.'&amp;id='.$id.'">[edit]</a>';
+                        if ($edit) echo '<a href="'.getStringFromServer('PHP_SELF').'?function=confirmdelete&lang='.$lang.'&amp;id='.$id.'">[delete]</a> </td>';
 			for ($i = 0; $i < $cols; $i++) {
 				//echo '<td>'. stripslashes(htmlspecialchars(db_result($result, $j, $i))) .'</td>';
 				echo '<td>'. stripslashes(db_result($result, $j, $i)) .'</td>';
@@ -275,7 +272,16 @@
 <p><a href="/admin/">Site Admin Home</a></p>
 <p>&nbsp;</p>';
 
-switch ($function) {
+$table = getStringFromRequest('table');
+$unit = getStringFromRequest('unit');
+$primary_key = getStringFromRequest('primary_key');
+$whereclause = getStringFromRequest('whereclause');
+$columns = getStringFromRequest('columns');
+$edit = getStringFromRequest('edit');
+$id = getStringFromRequest('id');
+$lang = getStringFromRequest('lang');
+
+switch (getStringFromRequest('function')) {
 	case 'add' : {
 		admin_table_add($table, $unit, $primary_key, $lang);
 		break;
diff -urNad gforge/www/admin/languages/editdouble.php /tmp/dpep.cr36JK/gforge/www/admin/languages/editdouble.php
--- gforge/www/admin/languages/editdouble.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/editdouble.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,8 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
+$lang = getStringFromRequest('lang');
+
 $unit        = 'item';
 $table       = 'tmp_lang';
 $primary_key = 'seq';
diff -urNad gforge/www/admin/languages/editnotinbasetabfiles.php /tmp/dpep.cr36JK/gforge/www/admin/languages/editnotinbasetabfiles.php
--- gforge/www/admin/languages/editnotinbasetabfiles.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/editnotinbasetabfiles.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,8 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
+$lang = getStringFromRequest('lang');
+
 $unit        = 'item';
 $table       = 'tmp_lang';
 $primary_key = 'seq';
diff -urNad gforge/www/admin/languages/editnotranstabfiles.php /tmp/dpep.cr36JK/gforge/www/admin/languages/editnotranstabfiles.php
--- gforge/www/admin/languages/editnotranstabfiles.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/editnotranstabfiles.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,8 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
+$lang = getStringFromRequest('lang');
+
 $unit        = 'item';
 $table       = 'tmp_lang';
 $primary_key = 'seq';
diff -urNad gforge/www/admin/languages/edittabfiles.php /tmp/dpep.cr36JK/gforge/www/admin/languages/edittabfiles.php
--- gforge/www/admin/languages/edittabfiles.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/edittabfiles.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,8 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
+$lang = getStringFromRequest('lang');
+
 $unit        = 'item';
 $table       = 'tmp_lang';
 $primary_key = 'seq';
diff -urNad gforge/www/admin/languages/edittranstabfiles.php /tmp/dpep.cr36JK/gforge/www/admin/languages/edittranstabfiles.php
--- gforge/www/admin/languages/edittranstabfiles.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/edittranstabfiles.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,8 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
+$lang = getStringFromRequest('lang');
+
 $unit        = 'item';
 $table       = 'tmp_lang';
 $primary_key = 'seq';
diff -urNad gforge/www/admin/languages/gettabfiles.php /tmp/dpep.cr36JK/gforge/www/admin/languages/gettabfiles.php
--- gforge/www/admin/languages/gettabfiles.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/gettabfiles.php	2005-01-21 00:09:56.000000000 +0100
@@ -13,6 +13,8 @@
 
 session_require(array('group'=>'1','admin_flags'=>'A'));
 
+$lang = getStringFromRequest('lang');
+
 header('Content-Type: application/octet-stream');
 header("Content-Disposition: attachment; filename=$lang.tab");
 
diff -urNad gforge/www/admin/languages/loadtabfiles.php /tmp/dpep.cr36JK/gforge/www/admin/languages/loadtabfiles.php
--- gforge/www/admin/languages/loadtabfiles.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/loadtabfiles.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,11 +29,11 @@
 
 session_require(array('group'=>'1','admin_flags'=>'A'));
 
-if ($purgeall) {
+if (getStringFromRequest('purgeall')) {
 	db_query("DROP TABLE tmp_lang;");
 }
 
-if ($loadall) {
+if (getStringFromRequest('loadall')) {
 	db_query("DROP TABLE tmp_lang;");
 	db_query("CREATE TABLE tmp_lang (tmpid integer, language_id text, seq integer , pagename text, category text, tstring  text);");
 	//db_commit();
@@ -83,7 +83,7 @@
 site_admin_header(array('title'=>"Site Admin"));
 ?>
 
-<form name="mload" method="post" action="<?php echo $PHP_SELF; ?>">
+<form name="mload" method="post" action="<?php echo getStringFromServer('PHP_SELF'); ?>">
 
 <input type="submit" name="loadall" value="<?php echo "(Re)Load all language files"; ?>" />
 <input type="submit" name="purgeall" value="<?php echo "Purge loaded data"; ?>" />
diff -urNad gforge/www/admin/languages/seenotinbasetabfiles.php /tmp/dpep.cr36JK/gforge/www/admin/languages/seenotinbasetabfiles.php
--- gforge/www/admin/languages/seenotinbasetabfiles.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/seenotinbasetabfiles.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,8 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
+$lang = getStringFromRequest('lang');
+
 $unit        = 'item';
 $table       = 'tmp_lang';
 $primary_key = 'seq';
diff -urNad gforge/www/admin/languages/seenotranstabfiles.php /tmp/dpep.cr36JK/gforge/www/admin/languages/seenotranstabfiles.php
--- gforge/www/admin/languages/seenotranstabfiles.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/seenotranstabfiles.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,8 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
+$lang = getStringFromRequest('lang');
+
 $unit        = 'item';
 $table       = 'tmp_lang';
 $primary_key = 'seq';
diff -urNad gforge/www/admin/languages/seetabfiles.php /tmp/dpep.cr36JK/gforge/www/admin/languages/seetabfiles.php
--- gforge/www/admin/languages/seetabfiles.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/seetabfiles.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,8 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
+$lang = getStringFromRequest('lang');
+
 $unit        = 'item';
 $table       = 'tmp_lang';
 $primary_key = 'seq';
diff -urNad gforge/www/admin/languages/seetranstabfiles.php /tmp/dpep.cr36JK/gforge/www/admin/languages/seetranstabfiles.php
--- gforge/www/admin/languages/seetranstabfiles.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/languages/seetranstabfiles.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,8 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
+$lang = getStringFromRequest('lang');
+
 $unit        = 'item';
 $table       = 'tmp_lang';
 $primary_key = 'seq';
diff -urNad gforge/www/admin/massmail.php /tmp/dpep.cr36JK/gforge/www/admin/massmail.php
--- gforge/www/admin/massmail.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/massmail.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,7 +32,10 @@
 
 session_require(array('group'=>'1','admin_flags'=>'A'));
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
+	$mail_type = getStringFromRequest('mail_type');
+	$mail_message = getStringFromRequest('mail_message');
+	$mail_subject = getStringFromRequest('mail_subject');
 
 	if (!$mail_type) {
 		exit_error(
@@ -87,7 +90,7 @@
 ';
 
 print '
-<form action="'.$PHP_SELF.'" method="post">'
+<form action="'.getStringFromServer('PHP_SELF').'" method="post">'
 .'<strong>Target Audience:</strong>'.utils_requiredField().'<br />'.html_build_select_box_from_arrays(
 	array(0,'SITE','COMMUNTY','DVLPR','ADMIN','ALL','SFDVLPR'),
 	array(
diff -urNad gforge/www/admin/responses_admin.php /tmp/dpep.cr36JK/gforge/www/admin/responses_admin.php
--- gforge/www/admin/responses_admin.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/responses_admin.php	2005-01-21 00:09:56.000000000 +0100
@@ -42,7 +42,7 @@
 }
 ?>
 
-<form method="post" action="<?php echo $PHP_SELF; ?>">
+<form method="post" action="<?php echo getStringFromServer('PHP_SELF'); ?>">
 <?php echo $Language->getText('admin_responses','existing_responses'); ?><?php echo get_canned_responses(); ?>
 <!-- Reinhard Spisser: commenting localization, since otherwise it will not work -->
 <!--
@@ -59,7 +59,14 @@
 
 <?php
 
+$action = getStringFromRequest('action');
+
 if( $action == "Edit" ) {
+	$response_id = getStringFromRequest('response_id');
+	$action2 = getStringFromRequest('action2');
+	$response_title = getStringFromRequest('response_title');
+	$response_text = getStringFromRequest('response_text');
+
 	// Edit Response
 	check_select_value($response_id, $action);
 	if( $action2 ) {
@@ -73,7 +80,7 @@
 ?>
 
 <?php echo $Language->getText('admin_responses','edit_response_other'); ?><br />
-<form method="post" action="<?php echo $PHP_SELF; ?>">
+<form method="post" action="<?php echo getStringFromServer('PHP_SELF'); ?>">
 <?php echo $Language->getText('admin_responses','response_title'); ?><input type="text" name="response_title" size="30" maxlength="25" value="<?php echo $response_title; ?>" /><br />
 <?php echo $Language->getText('admin_responses','response_text'); ?><br />
 <textarea name="response_text" cols="50" rows="10"><?php echo $response_text; ?></textarea>
@@ -85,7 +92,11 @@
 
 <?php
 	}
+
 } else if ( $action == "Delete" ) {
+	$response_id = getStringFromRequest('response_id');
+	$sure = getStringFromRequest('sure');
+
 	// Delete Response
 	check_select_value($response_id, $action);
 	if( $sure == "yes" ) {
@@ -95,15 +106,20 @@
 		print( $Language->getText('admin_responses','not_sure_dont_click')."<br />");
 		print("<em>" .$Language->getText('admin_responses','by_the_way')."</em><br />\n");
 	}
+
 } else if ( $action == "Create" ) {
+	$response_title = getStringFromRequest('response_title');
+	$response_text = getStringFromRequest('response_text');
+
 	// New Response
 	add_canned_response($response_title, $response_text);
 	print(" <strong>" .$Language->getText('admin_responses','add_response')."</strong> ");
+
 } else {
 ?>
 
 <?php echo $Language->getText('admin_responses','create_new_response'); ?><br />
-<form method="post" action="<?php echo $PHP_SELF; ?>">
+<form method="post" action="<?php echo getStringFromServer('PHP_SELF'); ?>">
 <?php echo $Language->getText('admin_responses','response_title'); ?><input type="text" name="response_title" size="30" maxlength="25" /><br />
 <?php echo $Language->getText('admin_responses','response_text'); ?><br />
 <textarea name="response_text" cols="50" rows="10"></textarea>
diff -urNad gforge/www/admin/search.php /tmp/dpep.cr36JK/gforge/www/admin/search.php
--- gforge/www/admin/search.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/search.php	2005-01-21 00:09:56.000000000 +0100
@@ -33,7 +33,11 @@
 require_once('pre.php');
 require_once('www/admin/admin_utils.php');
 
-if(!isset($search) || empty($search)) {
+$search = getStringFromRequest('search');
+$substr = getStringFromRequest('substr');
+$usersearch = getStringFromRequest('usersearch');
+
+if (!$search) {
 	exit_error($Language->getText('general','error'), $Language->getText('admin_search','refusing_to_display_whole_db'));
 }
 
@@ -113,13 +117,16 @@
 } // end if ($usersearch)
 
 
-if ($groupsearch) {
+if (getStringFromRequest('groupsearch')) {
+	$status = getStringFromRequest('status');
+	$is_public = getStringFromRequest('is_public');
+	$crit_desc = getStringFromRequest('crit_desc');
 
 	if ($status) {
 		$crit_sql  .= " AND status='$status'";
 		$crit_desc .= " status=$status";
 	}
-	if (isset($is_public)) {
+	if ($is_public) {
 		$crit_sql  .= " AND is_public='$is_public'";
 		$crit_desc .= " is_public=$is_public";
 	}
diff -urNad gforge/www/admin/trove/trove_cat_add.php /tmp/dpep.cr36JK/gforge/www/admin/trove/trove_cat_add.php
--- gforge/www/admin/trove/trove_cat_add.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/trove/trove_cat_add.php	2005-01-21 00:09:56.000000000 +0100
@@ -31,10 +31,15 @@
 
 // ########################################################
 
-if ($GLOBALS['submit']) {
-	$newroot = trove_getrootcat($GLOBALS['form_parent']);
+if (getStringFromRequest('submit')) {
+	$form_parent = getStringFromRequest('form_parent');
+	$form_shortname = getStringFromRequest('form_shortname');
+	$form_fullname = getStringFromRequest('form_fullname');
+	$form_description = getStringFromRequest('form_description');
 
-	if ($GLOBALS['form_shortname']) {
+	$newroot = trove_getrootcat($form_parent);
+
+	if ($form_shortname) {
 		$res = db_query("
 			INSERT INTO trove_cat 
 				(shortname,fullname,description,parent,version,root_parent)
diff -urNad gforge/www/admin/trove/trove_cat_edit.php /tmp/dpep.cr36JK/gforge/www/admin/trove/trove_cat_edit.php
--- gforge/www/admin/trove/trove_cat_edit.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/trove/trove_cat_edit.php	2005-01-21 00:09:56.000000000 +0100
@@ -35,15 +35,20 @@
 
 // ########################################################
 
-if ($GLOBALS["submit"]) {
-
-	$newroot = trove_getrootcat($GLOBALS['form_parent']);
+if (getStringFromRequest('submit')) {
+	$form_parent = getStringFromRequest('form_parent');
+	$form_shortname = getStringFromRequest('form_shortname');
+	$form_trove_cat_id = getIntFromRequest('form_trove_cat_id');
+	$form_shortname = getStringFromRequest('form_shortname');
+	$form_fullname = getStringFromRequest('form_fullname');
+	$form_description = getStringFromRequest('form_description');
+	$newroot = trove_getrootcat($form_parent);
 
-	if ($GLOBALS['form_shortname']) {
+	if ($form_shortname) {
 		if ($form_trove_cat_id == $form_parent) {
 			exit_error($Language->getText(
-								'admin_trove_cat_edit','error_tove_equal_parent'),
-								db_error()
+					   'admin_trove_cat_edit','error_tove_equal_parent'),
+				   db_error()
 			);
 		} else {
 			$res = db_query("
diff -urNad gforge/www/admin/unsubscribe.php /tmp/dpep.cr36JK/gforge/www/admin/unsubscribe.php
--- gforge/www/admin/unsubscribe.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/unsubscribe.php	2005-01-21 00:09:56.000000000 +0100
@@ -31,7 +31,9 @@
 require_once('www/admin/admin_utils.php');
 session_require(array('group'=>'1','admin_flags'=>'A'));
 
-if ($submit && $user_name) {
+$user_name = getStringFromRequest('user_name');
+if (getStringFromRequest('submit') && $user_name) {
+	$type = getStringFromRequest('type');
 
 	if (!$type) {
 
@@ -46,7 +48,7 @@
 		<p>
 		<?php echo $Language->getText('admin_unsubscribe','you_can_unsubscribe'); ?>
 		</p>
-		<form action="<?php echo $PHP_SELF; ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 		<input type="hidden" name="user_name" value="<?php echo $user_name?>" />
 		Unsubscription type: <?php echo html_build_select_box_from_arrays(
 			array($Language->getText('admin_unsubscribe','mail'),$Language->getText('admin_unsubscribe','all')),
@@ -94,13 +96,14 @@
 <?php echo $Language->getText('admin_unsubscribe','use_fields_bellow',array($GLOBALS['sys_name'])); ?>
 </p>
 
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 Pattern: <input type="text" name="pattern" value="<?php echo $pattern; ?>" />
 <input type="submit" name="submit" value="<?php echo $Language->getText('admin_unsubscribe','show_user_matching'); ?>" />
 </form>
 
 <?php
 
+$pattern = getStringFromRequest('pattern');
 if ($pattern) {
 	$res = db_query("
 		SELECT *
diff -urNad gforge/www/admin/useredit.php /tmp/dpep.cr36JK/gforge/www/admin/useredit.php
--- gforge/www/admin/useredit.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/useredit.php	2005-01-21 00:09:56.000000000 +0100
@@ -35,6 +35,7 @@
 	'D'=>$Language->getText('admin_useredit','deleted')
 );
 
+$user_id = getIntFromRequest('user_id');
 $u =& user_get_object($user_id);
 if (!$u || !is_object($u)) {
 	exit_error('Error','Could Not Get User');
@@ -42,7 +43,7 @@
 	exit_error('Error',$u->getErrorMessage());
 }
 
-if ($delete_user != '' && $confirm_delete == '1') {
+if (getStringFromRequest('delete_user') != '' && getStringFromRequest('confirm_delete') == '1') {
 	// delete user
 	if (!$u->delete(true)) {
 		exit_error(
@@ -53,7 +54,10 @@
 		$feedback .= $Language->getText('admin_useredit','deleted').'<br />';
 	}
 
-} elseif ($action == "update_user" && $delete_user == '') {
+} elseif (getStringFromRequest('action') == "update_user" && getStringFromRequest('delete_user') == '') {
+	$email = getStringFromRequest('email');
+	$shell = getStringFromRequest('shell');
+	$status = getStringFromRequest('status');
 
 	if (!$u->setEmail($email)
 		|| !$u->setShell($shell)
@@ -85,7 +89,7 @@
 ?>
 <h3><?php echo $Language->getText('admin_useredit','account_info'); ?><sup>1</sup></h3>
 
-<form method="post" action="<?php echo $PHP_SELF; ?>">
+<form method="post" action="<?php echo getStringFromServer('PHP_SELF'); ?>">
 <input type="hidden" name="action" value="update_user" />
 <input type="hidden" name="user_id" value="<?php print $user_id; ?>" />
 
diff -urNad gforge/www/admin/userlist.php /tmp/dpep.cr36JK/gforge/www/admin/userlist.php
--- gforge/www/admin/userlist.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/userlist.php	2005-01-21 00:09:56.000000000 +0100
@@ -94,6 +94,10 @@
 
 // Administrative functions
 
+$group_id = getIntFromRequest('group_id');
+$action = getStringFromRequest('action');
+$user_id = getStringFromRequest('user_id');
+
 if ($action=='delete') {
 	performAction('D', "DELETED", $user_id);
 } else if ($action=='activate') {
@@ -103,13 +107,15 @@
 }
 
 // Add a user to this group
-if ($action=='add_to_group') {
+if (getStringFromRequest('action') == 'add_to_group') {
 	echo "ACTION NOT SUPPORTED";
 }
 
 //	Show list of users
 print "<p>" .$Language->getText('admin_userlist','user_list_for_group');
 if (!$group_id) {
+	$user_name_search = getStringFromRequest('user_name_search');
+
 	print "<strong>" .$Language->getText('admin_userlist','all_groups'). "</strong>";
 	print "\n</p>";
 
@@ -142,7 +148,7 @@
 	?>
 	<hr />
 	<p>
-	<form action="<?php echo $PHP_SELF; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 	<input type="hidden" name="action" value="add_to_group" />
 	<input name="user_id" type="TEXT" value="" />
 	<br />
diff -urNad gforge/www/admin/vhost.php /tmp/dpep.cr36JK/gforge/www/admin/vhost.php
--- gforge/www/admin/vhost.php	2005-01-19 22:18:46.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/admin/vhost.php	2005-01-21 00:09:56.000000000 +0100
@@ -39,7 +39,11 @@
 
 session_require(array('group'=>'1','admin_flags'=>'A'));
 
-if ($add) {
+$group_id = getIntFromRequest('group_id');
+
+if (getStringFromRequest('add')) {
+	$groupname = getStringFromRequest('groupname');
+	$vhost_name = getStringFromRequest('vhost_name');
 
 	if ($group_id) {
 
@@ -76,7 +80,10 @@
 	}			
 }
 
-if ($tweakcommit) {
+if (getStringFromRequest('tweakcommit')) {
+	$vhostid = getIntFromRequest('vhostid');
+	$docdir = getStringFromRequest('docdir');
+	$cgidir = getStringFromRequest('cgidir');
 
 	$res = db_query("
 		UPDATE prweb_vhost 
@@ -99,7 +106,7 @@
 
 <h3><?php echo $Language->getText('admin_vhost','virtual_host_administration'); ?></h3>
 
-<form name="madd" method="post" action="<?php echo $PHP_SELF; ?>">
+<form name="madd" method="post" action="<?php echo getStringFromServer('PHP_SELF'); ?>">
 
 <strong><?php echo $Language->getText('admin_vhost','add_virtual_host'); ?></strong>
 
@@ -125,7 +132,7 @@
 <strong><?php echo $Language->getText('admin_vhost','tweak_directories'); ?></strong>
 <br />
 
-<form name="tweak" method="post" action="<?php echo $PHP_SELF; ?>">
+<form name="tweak" method="post" action="<?php echo getStringFromServer('PHP_SELF'); ?>">
 <table border="0">
 <tr>
    <td><?php echo $Language->getText('admin_vhost','virtual_host'); ?></td><td><input type="text" name="vhost_name" /></td>
@@ -138,8 +145,8 @@
 </form>
 
 <?php
-if ($tweak) {
-
+if (getStringFromRequest('tweak')) {
+	$vhost_name = getStringFromRequest('vhost_name');
 
 	$res_vh = db_query("
 		SELECT vhostid,vhost_name,docdir,cgidir,unix_group_name
@@ -163,7 +170,7 @@
 		$title[]=$Language->getText('admin_vhost','operations');
 
 		print '
-			<form name="update" method="post" action="'.$PHP_SELF.'">
+			<form name="update" method="post" action="'.getStringFromServer('PHP_SELF').'">
 
 			'.$GLOBALS['HTML']->listTableTop($title).'
 			<tr><td>'.$row_vh['vhostid'].'</td>
diff -urNad gforge/www/dbimage.php /tmp/dpep.cr36JK/gforge/www/dbimage.php
--- gforge/www/dbimage.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/dbimage.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,8 @@
 
 require_once('squal_pre.php');
 
+$id = getStringFromRequest('id');
+
 $res=db_query("SELECT * FROM db_images WHERE id='$id'");
 
 $filename=db_result($res,0,'filename');
diff -urNad gforge/www/developer/diary.php /tmp/dpep.cr36JK/gforge/www/developer/diary.php
--- gforge/www/developer/diary.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/developer/diary.php	2005-01-21 00:09:56.000000000 +0100
@@ -26,7 +26,10 @@
 require_once('pre.php');
 require_once('vote_function.php');
 
+$diary_user = getStringFromRequest('diary_user');
 if ($diary_user) {
+	$diary_id = getStringFromRequest('diary_id');
+  
 	$user_obj=user_get_object($diary_user);
 	if (!$user_obj || $user_obj->isError()) {
 		exit_error('ERROR','User could not be found: '.$user_obj->getErrorMessage());
@@ -77,7 +80,7 @@
 			</tr>';
 		for ($i=0; $i<$rows; $i++) {
 			echo '
-			<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'><td><a href="'. $PHP_SELF .'?diary_id='.
+			<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'><td><a href="'. getStringFromServer('PHP_SELF') .'?diary_id='.
 				db_result($result,$i,'id').'&amp;diary_user='. $diary_user .'">'.db_result($result,$i,'summary').'</a></td>'.
 				'<td>'. date($sys_datefmt, db_result($result,$i,'date_posted')).'</td></tr>';
 		}
diff -urNad gforge/www/developer/index.php /tmp/dpep.cr36JK/gforge/www/developer/index.php
--- gforge/www/developer/index.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/developer/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,6 +29,9 @@
 	Written by dtype Oct 1999
 */
 
+$user_id = getStringFromRequest('user_id');
+$form_dev = getStringFromRequest('form_dev');
+
 if (!$user_id) {
 	$user_id=$form_dev;
 }
diff -urNad gforge/www/developer/monitor.php /tmp/dpep.cr36JK/gforge/www/developer/monitor.php
--- gforge/www/developer/monitor.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/developer/monitor.php	2005-01-21 00:09:56.000000000 +0100
@@ -31,10 +31,12 @@
 	exit_not_logged_in();
 
 } else {
+
 	/*
 		User obviously has to be logged in to monitor
 	*/
 
+	$diary_user = getStringFromRequest('diary_user');
 	if ($diary_user) {
 		/*
 			First check to see if they are already monitoring
diff -urNad gforge/www/docman/admin/index.php /tmp/dpep.cr36JK/gforge/www/docman/admin/index.php
--- gforge/www/docman/admin/index.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/docman/admin/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -22,6 +22,7 @@
 require_once('common/docman/DocumentFactory.class');
 require_once('common/docman/DocumentGroup.class');
 
+$group_id = getIntFromRequest('group_id');
 if (!$group_id) {
 	exit_no_group();
 }
@@ -36,15 +37,26 @@
 	exit_permission_denied();
 }
 
+$editdoc = getStringFromRequest('editdoc');
+$docid = getIntFromRequest('docid');
+
 //
 //
 //	Submit the changes to the database
 //
 //
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
 
 	if ($editdoc) {
+		$doc_group = getStringFromRequest('doc_group');
+		$title = getStringFromRequest('title');
+		$description = getStringFromRequest('description');
+		$language_id = getIntFromRequest('language_id');
+		$data = getStringFromRequest('data');
+		$file_url = getStringFromRequest('file_url');
+		$uploaded_data = getUploadedFile('uploaded_data');
+		$stateid = getIntFromRequest('stateid');
 
 		$d= new Document($g,$docid);
 		if ($d->isError()) {
@@ -55,8 +67,8 @@
 				exit_error($Language->getText('general','error'),$Language->getText('docman','error_invalid_file_attack', $uploaded_data));
 			}
 			$data = addslashes(fread(fopen($uploaded_data, 'r'), filesize($uploaded_data)));
-			$filename=$uploaded_data_name;
-			$filetype=$uploaded_data_type;
+			$filename=$uploaded_data['name'];
+			$filetype=$uploaded_data['type'];
 		} elseif ($file_url) {
 			$data = '';
 			$filename=$file_url;
@@ -70,7 +82,9 @@
 		}
 		$feedback = $Language->getText('general','update_successful');
 
-	} elseif ($editgroup) {
+	} elseif (getStringFromRequest('editgroup')) {
+		$doc_group = getStringFromRequest('doc_group');
+		$groupname = $groupname;
 
 		$dg = new DocumentGroup($g,$doc_group);
 		if ($dg->isError()) {
@@ -82,7 +96,8 @@
 		$feedback = $Language->getText('general','update_successful');
 
 
-	} elseif ($addgroup) {
+	} elseif (getStringFromRequest('addgroup')) {
+		$groupname = getStringFromRequest('groupname');
 
 		$dg = new DocumentGroup($g);
 		if ($dg->isError()) {
@@ -269,7 +284,8 @@
 //	Edit a specific doc group
 //
 //
-} elseif ($editgroup && $doc_group) {
+} elseif (getStringFromRequest('editgroup') && getStringFromRequest('doc_group')) {
+	$doc_group = getStringFromRequest('doc_group');
 
 	$dg = new DocumentGroup($g,$doc_group);
 	if ($dg->isError()) {
diff -urNad gforge/www/docman/display_doc.php /tmp/dpep.cr36JK/gforge/www/docman/display_doc.php
--- gforge/www/docman/display_doc.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/docman/display_doc.php	2005-01-21 00:09:56.000000000 +0100
@@ -11,7 +11,10 @@
 require_once('include/doc_utils.php');
 require_once('common/docman/Document.class');
 
+$docid = getIntFromRequest('docid');
 if ($docid) {
+	$group_id = getIntFromRequest('group_id');
+
 	$g =& group_get_object($group_id);
 	if (!$g || !is_object($g)) {
 		exit_no_group();
@@ -28,7 +31,7 @@
 
 	docman_header($d->getName(),$d->getName(),'docman','',$g->getPublicName());
 	echo $Language->getText('docman_display_doc','docmoved',array($group_id,$docid));
-  docman_footer(array());
+	docman_footer(array());
 } else {
 	exit_error($Language->getText('docman_display_doc','no_document_data_title'),$Language->getText('docman_display_doc','no_document_data_text'));
 }
diff -urNad gforge/www/docman/index.php /tmp/dpep.cr36JK/gforge/www/docman/index.php
--- gforge/www/docman/index.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/docman/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -21,6 +21,9 @@
 require_once('include/doc_utils.php');
 require_once('common/docman/DocumentFactory.class');
 
+$group_id = getIntFromRequest('group_id');
+$language_id = getStringFromRequest('language_id');
+
 if (!$group_id) {
     exit_no_group();
 }
@@ -43,7 +46,7 @@
 }
 
 if ($language_id == "*") {
-  $language_id = 0 ;
+	$language_id = 0;
 }
 
 $df->setLanguageID($language_id);
diff -urNad gforge/www/docman/new.php /tmp/dpep.cr36JK/gforge/www/docman/new.php
--- gforge/www/docman/new.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/docman/new.php	2005-01-21 00:09:56.000000000 +0100
@@ -22,6 +22,7 @@
 require_once('common/docman/Document.class');
 require_once('include/doc_utils.php');
 
+$group_id = getIntFromRequest('group_id');
 if (!$group_id) {
 	exit_no_group();
 }
@@ -32,9 +33,15 @@
 	exit_error('Error',$g->getErrorMessage());
 }
 
-if ($submit){
+if (getStringFromRequest('submit')) {
+	$doc_group = getIntFromRequest('doc_group');
+	$title = getStringFromRequest('title');
+	$description = getStringFromRequest('description');
+	$file_url = getStringFromRequest('file_url');
+	$uploaded_data = getUploadedFile('uploaded_data');
+	$language_id = getIntFromRequest('language_id');
 
-	if (!$doc_group || $doc_group ==100) {
+	if (!$doc_group || $doc_group == 100) {
 		//cannot add a doc unless an appropriate group is provided
 		exit_error($Language->getText('general','error'),$Language->getText('docman_new','no_valid_group'));
 	}
@@ -56,6 +63,8 @@
 		}
 		$data = addslashes(fread(fopen($uploaded_data, 'r'), filesize($uploaded_data)));
 		$file_url='';
+		$uploaded_data_name=$uploaded_data['name'];
+		$uploaded_data_type=$uploaded_data['type'];
 	} elseif ($file_url) {
 		$data = '';
 		$uploaded_data_name=$file_url;
@@ -75,7 +84,7 @@
 	<?php echo $Language->getText('docman_new','intro') ?>
 	</p>
 
-	<form name="adddata" action="<?php echo "$PHP_SELF?group_id=$group_id"; ?>" method="post" enctype="multipart/form-data">
+	<form name="adddata" action="<?php echo getStringFromServer('PHP_SELF')."?group_id=$group_id"; ?>" method="post" enctype="multipart/form-data">
 
 	<table border="0" width="75%">
 
diff -urNad gforge/www/docman/view.php /tmp/dpep.cr36JK/gforge/www/docman/view.php
--- gforge/www/docman/view.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/docman/view.php	2005-01-21 00:09:56.000000000 +0100
@@ -23,7 +23,7 @@
 require_once('include/doc_utils.php');
 require_once('common/docman/Document.class');
 
-$arr=explode('/',$REQUEST_URI);
+$arr=explode('/',getStringFromServer('REQUEST_URI'));
 $group_id=$arr[3];
 $docid=$arr[4];
 
diff -urNad gforge/www/download.php /tmp/dpep.cr36JK/gforge/www/download.php
--- gforge/www/download.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/download.php	2005-01-21 00:09:56.000000000 +0100
@@ -3,6 +3,7 @@
 	Temporary redirect so we don't break existing installs/links
 */
 
-Header("Location: /frs$REQUEST_URI");
+require_once('pre.php');
+Header("Location: /frs" . getStringFromServer('REQUEST_URI'));
 
 ?>
diff -urNad gforge/www/export/forum.php /tmp/dpep.cr36JK/gforge/www/export/forum.php
--- gforge/www/export/forum.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/export/forum.php	2005-01-21 00:09:56.000000000 +0100
@@ -18,6 +18,8 @@
 
 header("Content-Type: text/plain");
 
+$group_id = getIntFromRequest('group_id');
+
 // ## group_id must be specified
 $res_grp = db_query("
 	SELECT group_id,group_name
diff -urNad gforge/www/export/projhtml.php /tmp/dpep.cr36JK/gforge/www/export/projhtml.php
--- gforge/www/export/projhtml.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/export/projhtml.php	2005-01-21 00:09:56.000000000 +0100
@@ -28,8 +28,10 @@
 require_once('pre.php');
 require_once('project_summary.php');
 
-$group_name=$_GET['group_name'];
-$group_id=$_GET['group_id'];
+$group_name = getStringFromRequest('group_name');
+$group_id = getIntFromRequest('group_id');
+$mode = getStringFromRequest('mode');
+$no_table = getStringFromRequest('no_table');
 
 //
 //	Get group object
diff -urNad gforge/www/export/projnews.php /tmp/dpep.cr36JK/gforge/www/export/projnews.php
--- gforge/www/export/projnews.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/export/projnews.php	2005-01-21 00:09:56.000000000 +0100
@@ -35,8 +35,11 @@
 require_once('pre.php');
 require_once('www/news/news_utils.php');
 
-$group_name=$_GET['group_name'];
-$group_id=$_GET['group_id'];
+$group_name = getStringFromRequest('group_name');
+$group_id = getIntFromRequest('group_id');
+$limit = getIntFromRequest('limit');
+$show_summaries = getStringFromRequest('show_summaries');
+$flat = getStringFromRequest('flat');
 
 //
 //  Get group object
diff -urNad gforge/www/export/projtitl.php /tmp/dpep.cr36JK/gforge/www/export/projtitl.php
--- gforge/www/export/projtitl.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/export/projtitl.php	2005-01-21 00:09:56.000000000 +0100
@@ -35,8 +35,8 @@
 require_once('pre.php');
 require_once('www/news/news_utils.php');
 
-$group_name=$_GET['group_name'];
-$group_id=$_GET['group_id'];
+$group_name = getStringFromRequest('group_name');
+$group_id = getIntFromRequest('group_id');
 
 //
 //  Get group object
diff -urNad gforge/www/export/rss_sfnewreleases.php /tmp/dpep.cr36JK/gforge/www/export/rss_sfnewreleases.php
--- gforge/www/export/rss_sfnewreleases.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/export/rss_sfnewreleases.php	2005-01-21 00:09:56.000000000 +0100
@@ -15,6 +15,8 @@
 require_once('pre.php');
 require_once('rss_utils.inc');
 
+$limit = getIntFromRequest('limit');
+
 header("Content-Type: text/plain");
 print '<?xml version="1.0"?>
 <!DOCTYPE rss SYSTEM "http://my.netscape.com/publish/formats/rss-0.91.dtd">
diff -urNad gforge/www/export/rss_sfnews.php /tmp/dpep.cr36JK/gforge/www/export/rss_sfnews.php
--- gforge/www/export/rss_sfnews.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/export/rss_sfnews.php	2005-01-21 00:09:56.000000000 +0100
@@ -15,6 +15,9 @@
 require_once('pre.php');
 require_once('rss_utils.inc');
 
+$limit = getIntFromRequest('limit');
+$group_id = getIntFromRequest('group_id');
+
 header("Content-Type: text/plain");
 print '<?xml version="1.0" encoding="UTF-8"?>
 
diff -urNad gforge/www/export/rss_sfprojects.php /tmp/dpep.cr36JK/gforge/www/export/rss_sfprojects.php
--- gforge/www/export/rss_sfprojects.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/export/rss_sfprojects.php	2005-01-21 00:09:56.000000000 +0100
@@ -15,6 +15,8 @@
 require_once('pre.php');
 require_once('rss_utils.inc');
 
+$limit = getIntFromRequest('limit');
+
 header("Content-Type: text/plain");
 print '<?xml version="1.0"?>
 <!DOCTYPE rss SYSTEM "http://my.netscape.com/publish/formats/rss-0.91.dtd">
diff -urNad gforge/www/export/tracker.php /tmp/dpep.cr36JK/gforge/www/export/tracker.php
--- gforge/www/export/tracker.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/export/tracker.php	2005-01-21 00:09:56.000000000 +0100
@@ -48,8 +48,9 @@
 ?>
 <?php
 
-$group_id = $_GET['group_id'];
-$atid = $_GET['atid'];
+$group_id = getIntFromRequest('group_id');
+$atid = getIntFromRequest('atid');
+$offset = getIntFromRequest('offset');
 
 if ($group_id && $atid) {
 	//
diff -urNad gforge/www/forum/admin/index.php /tmp/dpep.cr36JK/gforge/www/forum/admin/index.php
--- gforge/www/forum/admin/index.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/forum/admin/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -27,6 +27,10 @@
 require_once('common/forum/ForumMessageFactory.class');
 require_once('common/forum/ForumMessage.class');
 
+$group_id = getIntFromRequest('group_id');
+$group_forum_id = getIntFromRequest('group_forum_id');
+$deleteforum = getStringFromRequest('deleteforum');
+
 if ($group_id) {
 	//
 	//  Set up local objects
@@ -41,7 +45,7 @@
 		exit_permission_denied();
 	}
 
-	if ($post_changes) {
+	if (getStringFromRequest('post_changes')) {
 		/*
 			Update the DB to reflect the changes
 		*/
@@ -59,14 +63,15 @@
 			if (!$f->userIsAdmin()) {
 				exit_permission_denied();
 			}
-			if (!$f->delete($sure,$really_sure)) {
+			if (!$f->delete(getStringFromRequest('sure'),getStringFromRequest('really_sure'))) {
 				exit_error($Language->getText('general','error'),$f->getErrorMessage());
 			} else {
 				$feedback .= $Language->getText('forum_admin','deleted');
 				$group_forum_id=0;
 				$deleteforum=0;
 			}
-		} elseif ($delete) {
+		} elseif (getStringFromRequest('delete')) {
+			$msg_id = getStringFromRequest('msg_id');
 			/*
 				Deleting messages or threads
 			*/
@@ -93,7 +98,12 @@
 				$feedback .= $Language->getText('forum_admin_delete_messages','messages_deleted',$count);
 			}
 
-		} else if ($add_forum) {
+		} else if (getStringFromRequest('add_forum')) {
+			$forum_name = getStringFromRequest('forum_name');
+			$description = getStringFromRequest('description');
+			$is_public = getStringFromRequest('is_public');
+			$send_all_posts_to = getStringFromRequest('send_all_posts_to');
+			$allow_anonymous = getStringFromRequest('allow_anonymous');
 			/*
 				Adding forums to this group
 			*/
@@ -112,7 +122,10 @@
 				$feedback .= $Language->getText('forum_admin_addforum','forum_created');
 			}
 
-		} else if ($change_status) {
+		} else if (getStringFromRequest('change_status')) {
+			$forum_name = getStringFromRequest('forum_name');
+			$description = getStringFromRequest('description');
+			$send_all_posts_to = getStringFromRequest('send_all_posts_to');
 			/*
 				Change a forum
 			*/
@@ -134,7 +147,7 @@
 
 	}
 
-	if ($add_forum) {
+	if (getStringFromRequest('add_forum')) {
 		/*
 			Show the form for adding forums
 		*/
@@ -142,7 +155,7 @@
 
 		echo '
 			<br>
-			<form method="post" action="'.$PHP_SELF.'">
+			<form method="post" action="'.getStringFromServer('PHP_SELF').'">
 			<input type="hidden" name="post_changes" value="y" />
 			<input type="hidden" name="add_forum" value="y" />
 			<input type="hidden" name="group_id" value="'.$group_id.'" />
@@ -167,7 +180,7 @@
 
 		forum_footer(array());
 
-	} else if ($change_status) {
+	} else if (getStringFromRequest('change_status')) {
 		/*
 			Change a forum
 		*/
@@ -185,7 +198,7 @@
 		echo '<p>'.$Language->getText('forum_admin_changestatus','intro').'</p>';
 
 		echo '
-			<form action="'.$PHP_SELF.'" method="post">
+			<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 				<input type="hidden" name="post_changes" value="y" />
 				<input type="hidden" name="change_status" value="y" />
 				<input type="hidden" name="group_forum_id" value="'. $f->getID() .'" />
@@ -214,8 +227,8 @@
 				<p>
 				<input type="submit" name="submit" value="'.$Language->getText('general','update').'" /></span>
 			</form><p>';
-			echo '<a href="'.$PHP_SELF.'?group_id='.$group_id.'&amp;group_forum_id='.$group_forum_id.'&amp;delete=1">'.$Language->getText('forum_admin','delete_message').'</a><br />';
-			echo '<a href="'.$PHP_SELF.'?group_id='.$group_id.'&amp;group_forum_id='.$group_forum_id.'&amp;deleteforum=1">'.$Language->getText('forum_admin','delete_forum').'</a><br />';
+			echo '<a href="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;group_forum_id='.$group_forum_id.'&amp;delete=1">'.$Language->getText('forum_admin','delete_message').'</a><br />';
+			echo '<a href="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;group_forum_id='.$group_forum_id.'&amp;deleteforum=1">'.$Language->getText('forum_admin','delete_forum').'</a><br />';
 		forum_footer(array());
 
 	} elseif ($deleteforum && $group_forum_id) {
@@ -231,7 +244,7 @@
 		forum_header(array('title'=>$Language->getText('forum_admin','delete')));
 		echo '<p>
 			<strong>'.$Language->getText('forum_admin','delete_warning').'</strong><br />
-			<form method="post" action="'.$PHP_SELF.'">
+			<form method="post" action="'.getStringFromServer('PHP_SELF').'">
 			<input type="hidden" name="post_changes" value="y" />
 			<input type="hidden" name="deleteforum" value="y" />
 			<input type="hidden" name="group_id" value="'.$group_id.'" />
@@ -242,7 +255,7 @@
 			</form>';
 		forum_footer(array());
 
-	} elseif ($delete && $group_forum_id) {
+	} elseif (getStringFromRequest('delete') && $group_forum_id) {
 
 		$f = new Forum ($g,$group_forum_id);
 		if (!$f || !is_object($f)) {
@@ -255,7 +268,7 @@
 		forum_header(array('title'=>$Language->getText('forum_admin_changestatus','change_status')));
 		echo '<p>
 			<strong>'.$Language->getText('general','delete').'</strong><br />
-			<form method="post" action="'.$PHP_SELF.'">
+			<form method="post" action="'.getStringFromServer('PHP_SELF').'">
 			<input type="hidden" name="post_changes" value="y" />
 			<input type="hidden" name="delete" value="y" />
 			<input type="hidden" name="group_id" value="'.$group_id.'" />
@@ -279,7 +292,7 @@
 		if ($p->isForumAdmin()) {
 			echo '
 			<p>
-			<a href="'.$PHP_SELF.'?group_id='.$group_id.'&amp;add_forum=1">'.$Language->getText('forum_admin','add_forum').'</a><br /></p>';
+			<a href="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;add_forum=1">'.$Language->getText('forum_admin','add_forum').'</a><br /></p>';
 		}
 		//
 		//	Get existing forums
@@ -306,7 +319,7 @@
 			if ($farr[$j]->isError()) {
 				echo $farr->getErrorMessage();
 			} else {
-				echo '<a href="'.$PHP_SELF.'?group_id='.$group_id.'&amp;change_status=1&amp;group_forum_id='. $farr[$j]->getID() .'">'.
+				echo '<a href="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;change_status=1&amp;group_forum_id='. $farr[$j]->getID() .'">'.
 					$farr[$j]->getName() .'</a><br />'.$farr[$j]->getDescription().'<p>';
 			}
 		}
diff -urNad gforge/www/forum/forum.php /tmp/dpep.cr36JK/gforge/www/forum/forum.php
--- gforge/www/forum/forum.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/forum/forum.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,10 @@
 require_once('common/forum/ForumMessageFactory.class');
 require_once('common/forum/ForumMessage.class');
 
+$forum_id = getIntFromRequest('forum_id');
+$style = getStringFromRequest('style');
+$thread_id = getIntFromRequest('thread_id');
+
 if ($forum_id) {
 
 	/*
@@ -56,7 +60,11 @@
 	/*
 		if necessary, insert a new message into the forum
 	*/
-	if ($post_message) {
+	if (getStringFromRequest('post_message')) {
+		$subject = getStringFromRequest('subject');
+		$body = getStringFromRequest('body');
+		$is_followup_to = getStringFromRequest('is_followup_to');
+
 		$fm=new ForumMessage($f);
 		if (!$fm || !is_object($fm)) {
 			exit_error($Language->getText('general','error'), "Error getting new ForumMessage");
@@ -70,7 +78,7 @@
 			$feedback=$Language->getText('forum_forum','postsuccess');
 			$style='';
 			$thread_id='';
-			if ($monitor) {
+			if (getStringFromRequest('monitor')) {
 				$f->setMonitor();
 			}
 		}
@@ -137,7 +145,7 @@
 
 	//now show the popup boxes in a form
 	$ret_val = '
-	<form action="'. $PHP_SELF .'" method="get">
+	<form action="'. getStringFromServer('PHP_SELF') .'" method="get">
 	<input type="hidden" name="set" value="custom" />
 	<input type="hidden" name="forum_id" value="'.$forum_id.'" />
 	<table border="0" width="33%">
diff -urNad gforge/www/forum/include/ForumHTML.class /tmp/dpep.cr36JK/gforge/www/forum/include/ForumHTML.class
--- gforge/www/forum/include/ForumHTML.class	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/forum/include/ForumHTML.class	2005-01-21 00:09:56.000000000 +0100
@@ -23,7 +23,7 @@
 require_once('www/news/news_utils.php');
 
 function forum_header($params) {
-	global $DOCUMENT_ROOT,$HTML,$group_id,$forum_name,$forum_id,$sys_datefmt,$sys_news_group,$Language,$f,$sys_use_forum,$group_forum_id;
+	global $HTML,$group_id,$forum_name,$forum_id,$sys_datefmt,$sys_news_group,$Language,$f,$sys_use_forum,$group_forum_id;
 
 	if ($group_forum_id) {
 		$forum_id=$group_forum_id;
@@ -298,7 +298,7 @@
 	}
 
 	function showPostForm($thread_id=0, $is_followup_to=0, $subject="") {
-		global $REQUEST_URI,$Language;
+		global $Language;
 
 		if ($this->Forum->userCanPost()) {
 			if ($subject) {
@@ -328,7 +328,7 @@
 				<p>
 			<?php
 			if (!session_loggedin()) {
-				echo '<strong><font color="red">'.$Language->getText('forum_utils','postanon').' <a href="/account/login.php?return_to='. urlencode($REQUEST_URI) .'">['.$Language->getText('forum_utils','loggedin').']</a></font></strong>';
+				echo '<strong><font color="red">'.$Language->getText('forum_utils','postanon').' <a href="/account/login.php?return_to='. urlencode(getStringFromServer('REQUEST_URI')) .'">['.$Language->getText('forum_utils','loggedin').']</a></font></strong>';
 			}
 			?>
 			<br />
@@ -343,7 +343,7 @@
 		} elseif ($this->Forum->allowAnonymous()) {
 			echo "<div align=\"center\">";
 			echo '<h3><font color="red">';
-			echo $Language->getText('forum_utils','couldpostif',array('<a href="/account/login.php?return_to='.urlencode($REQUEST_URI).' ">','</a>'));
+			echo $Language->getText('forum_utils','couldpostif',array('<a href="/account/login.php?return_to='.urlencode(getStringFromServer('REQUEST_URI')).' ">','</a>'));
 			echo '</font></h3>';
 			echo "</div>";
 		} else {
diff -urNad gforge/www/forum/index.php /tmp/dpep.cr36JK/gforge/www/forum/index.php
--- gforge/www/forum/index.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/forum/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -23,6 +23,7 @@
 require_once('common/forum/ForumFactory.class');
 require_once('common/forum/Forum.class');
 
+$group_id = getIntFromRequest('group_id');
 if ($group_id) {
 	$g =& group_get_object($group_id);
 	if (!$g || !is_object($g) || $g->isError()) {
@@ -30,9 +31,9 @@
 	}
 
 	$ff=new ForumFactory($g);
-    if (!$ff || !is_object($ff) || $ff->isError()) {
-        exit_error($Language->getText('general','error'),$ff->getErrorMessage());
-    }
+	if (!$ff || !is_object($ff) || $ff->isError()) {
+		exit_error($Language->getText('general','error'),$ff->getErrorMessage());
+	}
 
 	forum_header(array('title'=>$Language->getText('forum','forums_for', array($g->getPublicName())) ,'pagename'=>'forum','sectionvals'=>array($g->getPublicName())));
 
diff -urNad gforge/www/forum/message.php /tmp/dpep.cr36JK/gforge/www/forum/message.php
--- gforge/www/forum/message.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/forum/message.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,7 @@
 require_once('common/forum/ForumMessageFactory.class');
 require_once('common/forum/ForumMessage.class');
 
+$msg_id = getIntFromRequest('msg_id');
 if ($msg_id) {
 
 	/*
diff -urNad gforge/www/forum/monitor.php /tmp/dpep.cr36JK/gforge/www/forum/monitor.php
--- gforge/www/forum/monitor.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/forum/monitor.php	2005-01-21 00:09:56.000000000 +0100
@@ -24,6 +24,8 @@
 
 
 if (session_loggedin()) {
+	$forum_id = getIntFromRequest('forum_id');
+	$group_id = getIntFromRequest('group_id');
 	if ($forum_id && $group_id) {
 		//
 		//  Set up local objects
@@ -40,13 +42,13 @@
 			exit_error('Error',$f->getErrorMessage());
 		}
 
-		if ($stop) {
+		if (getStringFromRequest('stop')) {
 			if (!$f->stopMonitor()) {
 				exit_error('Error',$f->getErrorMessage());
 			} else {
 				header ("Location: /forum/forum.php?forum_id=$forum_id&feedback=".urlencode($Language->getText('forum_monitor','deactivated')));
 			}
-		} elseif($start) {
+		} elseif(getStringFromRequest('start')) {
 			if (!$f->setMonitor()) {
 				exit_error('Error',$f->getErrorMessage());
 			} else {
diff -urNad gforge/www/forum/new.php /tmp/dpep.cr36JK/gforge/www/forum/new.php
--- gforge/www/forum/new.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/forum/new.php	2005-01-21 00:09:56.000000000 +0100
@@ -27,6 +27,8 @@
 	User obviously has to be logged in to save place
 */
 
+$forum_id = getIntFromRequest('forum_id');
+$group_id = getIntFromRequest('group_id');
 if ($forum_id && $group_id) {
 	//
 	//  Set up local objects
diff -urNad gforge/www/forum/save.php /tmp/dpep.cr36JK/gforge/www/forum/save.php
--- gforge/www/forum/save.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/forum/save.php	2005-01-21 00:09:56.000000000 +0100
@@ -28,6 +28,8 @@
 		User obviously has to be logged in to save place
 	*/
 
+	$forum_id = getIntFromRequest('forum_id');
+	$group_id = getIntFromRequest('group_id');
 	if ($forum_id && $group_id) {
 		//
 		//  Set up local objects
diff -urNad gforge/www/frs/admin/deletepackage.php /tmp/dpep.cr36JK/gforge/www/frs/admin/deletepackage.php
--- gforge/www/frs/admin/deletepackage.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/frs/admin/deletepackage.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,8 @@
 require_once('www/frs/include/frs_utils.php');
 require_once('common/frs/FRSPackage.class');
 
+$group_id = getIntFromRequest('group_id');
+$package_id = getIntFromRequest('package_id');
 if (!$group_id) {
 	exit_no_group();
 }
diff -urNad gforge/www/frs/admin/deleterelease.php /tmp/dpep.cr36JK/gforge/www/frs/admin/deleterelease.php
--- gforge/www/frs/admin/deleterelease.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/frs/admin/deleterelease.php	2005-01-21 00:09:56.000000000 +0100
@@ -31,6 +31,9 @@
 require_once('common/frs/FRSRelease.class');
 require_once('common/frs/FRSFile.class');
 
+$group_id = getIntFromRequest('group_id');
+$package_id = getIntFromRequest('package_id');
+$release_id = getIntFromRequest('release_id');
 if (!$group_id) {
 	exit_no_group();
 }
diff -urNad gforge/www/frs/admin/editrelease.php /tmp/dpep.cr36JK/gforge/www/frs/admin/editrelease.php
--- gforge/www/frs/admin/editrelease.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/frs/admin/editrelease.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,9 +32,16 @@
 require_once('common/frs/FRSFile.class');
 require_once('www/frs/include/frs_utils.php');
 
+$group_id = getIntFromRequest('group_id');
+$package_id = getIntFromRequest('package_id');
+$release_id = getIntFromRequest('release_id');
 if (!$group_id) {
 	exit_no_group();
 }
+if (!$package_id || !$release_id) {
+	header("Location: /frs/admin/?group_id=$group_id");
+	exit;
+}
 
 $g =& group_get_object($group_id);
 if (!$g || $g->isError()) {
@@ -45,11 +52,6 @@
 	exit_permission_denied();
 }
 
-if (!$package_id || !$release_id) {
-	header("Location: /frs/admin/?group_id=$group_id");
-	exit;
-}
-
 //
 //  Get the package
 //
@@ -76,7 +78,15 @@
  */
 
 // Edit release info
-if ($step1) {
+if (getStringFromRequest('step1')) {
+	$release_date = getStringFromRequest('release_date');
+	$release_name = getStringFromRequest('release_name');
+	$status_id = getIntFromRequest('status_id');
+	$uploaded_notes = getUploadedFile('uploaded_notes');
+	$uploaded_changes = getUploadedFile('uploaded_changes');
+	$release_notes = getStringFromRequest('release_notes');
+	$release_changes = getStringFromRequest('release_changes');
+	$preformatted = getStringFromRequest('preformatted');
 	$exec_changes = true;
 
 	// Check for uploaded release notes
@@ -84,7 +94,7 @@
 		if (!is_uploaded_file($uploaded_notes)) {
 			exit_error('Error','Attempted File Upload Attack');
 		}
-		$notes = addslashes(fread(fopen($HTTP_POST_FILES['uploaded_notes']['tmp_name'],'r'),filesize($HTTP_POST_FILES['uploaded_notes']['tmp_name'])));
+		$notes = addslashes(fread(fopen($uploaded_notes['tmp_name'],'r'),filesize($uploaded_notes['tmp_name'])));
 		if (strlen($notes) < 20) {
 			$feedback .= $Language->getText('project_admin_editrelease','release_notes_too_small');
 			$exec_changes = false;
@@ -98,7 +108,7 @@
 		if (!is_uploaded_file($uploaded_changes)) {
 			exit_error('Error','Attempted File Upload Attack');
 		}
-		$changes = addslashes(fread(fopen($HTTP_POST_FILES['uploaded_changes']['tmp_name'],'r'), filesize($HTTP_POST_FILES['uploaded_changes']['tmp_name'])));
+		$changes = addslashes(fread(fopen($uploaded_changes['tmp_name'],'r'), filesize($uploaded_changes['tmp_name'])));
 		if (strlen($changes) < 20) {
 			$feedback .= $Language->getText('project_admin_editrelease','changelog_too_small');
 			$exec_changes = false;
@@ -121,7 +131,11 @@
 }
 
 // Add file(s) to the release
-if ($step2) {
+if (getStringFromRequest('step2')) {
+	$userfile = getUploadedFile('userfile');
+	$userfile_name = $userfile['name'];
+	$type_id = getIntFromRequest('type_id');
+	$processor_id = getStringFromRequest('processor_id');
 	// Build a Unix time value from the supplied Y-m-d value
 	$group_unix_name=group_getunixname($group_id);
 
@@ -155,7 +169,18 @@
 }
 
 // Edit/Delete files in a release
-if ($step3) {
+if (getStringFromRequest('step3')) {
+	$file_id = getIntFromRequest('file_id');
+	$processor_id = getIntFromRequest('processor_id');
+	$type_id = getIntFromRequest('type_id');
+	$new_release_id = getIntFromRequest('new_release_id');
+	$release_time = getStringFromRequest('release_time');
+	$group_id = getIntFromRequest('group_id');
+	$release_id = getIntFromRequest('release_id');
+	$package_id = getIntFromRequest('package_id');
+	$file_id = getIntFromRequest('file_id');
+	$im_sure = getStringFromRequest('im_sure');
+
 	// If the user chose to delete the file and he's sure then delete the file
 	if( $step3 == "Delete File" && $im_sure ) {
 		$frsf = new FRSFile($frsr,$file_id);
@@ -198,7 +223,7 @@
 
 <h3><?php echo $Language->getText('project_admin_editrelease','step_1') ?></h3>
 
-<form enctype="multipart/form-data" method="post" action="<?php echo $PHP_SELF."?group_id=$group_id&release_id=$release_id&package_id=$package_id"; ?>">
+<form enctype="multipart/form-data" method="post" action="<?php echo getStringFromServer('PHP_SELF')."?group_id=$group_id&release_id=$release_id&package_id=$package_id"; ?>">
 <input type="hidden" name="step1" value="1" />
 <table border="0" cellpadding="1" cellspacing="1">
 <tr>
@@ -257,7 +282,7 @@
 <hr />
 <h3><?php echo $Language->getText('project_admin_editrelease','step_2') ?></h3>
 <p>
-<form enctype="multipart/form-data" method="post" action="<?php echo $PHP_SELF."?group_id=$group_id&release_id=$release_id&package_id=$package_id"; ?>">
+<form enctype="multipart/form-data" method="post" action="<?php echo getStringFromServer('PHP_SELF')."?group_id=$group_id&release_id=$release_id&package_id=$package_id"; ?>">
 <input type="hidden" name="step2" value="1" />
 <span style="color:red"><strong>
 <?php echo $Language->getText('project_admin_editrelease','add_files_note') ?>
@@ -313,7 +338,7 @@
 
 		for($x=0; $x<$rows; $x++) {
 ?>
-			<form action="<?php echo $PHP_SELF."?group_id=$group_id&release_id=$release_id&package_id=$package_id"; ?>" method="post">
+			<form action="<?php echo getStringFromServer('PHP_SELF')."?group_id=$group_id&release_id=$release_id&package_id=$package_id"; ?>" method="post">
 				<input type="hidden" name="file_id" value="<?php echo db_result($res,$x,'file_id'); ?>" />
 				<input type="hidden" name="step3" value="1" />
 				<tr <?php echo $HTML->boxGetAltRowStyle($x); ?>>
@@ -336,7 +361,7 @@
 				</tr>
 				</form>
 
-			<form action="<?php echo $PHP_SELF; ?>" method="post">
+			<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 				<input type="hidden" name="group_id" value="<?php echo $group_id; ?>" />
 				<input type="hidden" name="release_id" value="<?php echo $release_id; ?>" />
 				<input type="hidden" name="package_id" value="<?php echo $package_id; ?>" />
diff -urNad gforge/www/frs/admin/index.php /tmp/dpep.cr36JK/gforge/www/frs/admin/index.php
--- gforge/www/frs/admin/index.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/frs/admin/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,6 +32,7 @@
 require_once('common/frs/FRSRelease.class');
 require_once('common/frs/FRSFile.class');
 
+$group_id = getIntFromRequest('group_id');
 if (!$group_id) {
 	exit_no_group();
 }
@@ -52,7 +53,13 @@
 */
 
 // only admin can modify packages (vs modifying releases of packages)
-if ($submit) {
+if (getStringFromRequest('submit')) {
+	$func = getStringFromRequest('func');
+	$package_id = getIntFromRequest('package_id');
+	$package_name = getStringFromRequest('package_name');
+	$status_id = getIntFromRequest('status_id');
+	$is_public = getStringFromRequest('is_public');
+
 	/*
 
 		make updates to the database
@@ -139,7 +146,7 @@
 
 	for ($i=0; $i<$rows; $i++) {
 		echo '
-		<form action="'. $PHP_SELF .'" method="post">
+		<form action="'. getStringFromServer('PHP_SELF') .'" method="post">
 		<input type="hidden" name="group_id" value="'.$group_id.'" />
 		<input type="hidden" name="func" value="update_package" />
 		<input type="hidden" name="package_id" value="'. db_result($res,$i,'package_id') .'" />
@@ -183,7 +190,7 @@
 </p>
 <h3><?php echo $Language->getText('project_admin_editpackages','new_package_name') ?>:</h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <input type="hidden" name="group_id" value="<?php echo $group_id; ?>" />
 <input type="hidden" name="func" value="add_package" />
 <input type="text" name="package_name" value="" size="20" maxlength="30" />
diff -urNad gforge/www/frs/admin/qrs.php /tmp/dpep.cr36JK/gforge/www/frs/admin/qrs.php
--- gforge/www/frs/admin/qrs.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/frs/admin/qrs.php	2005-01-21 00:09:56.000000000 +0100
@@ -14,6 +14,8 @@
 require_once('common/frs/FRSFile.class');
 require_once('www/frs/include/frs_utils.php');
 
+$group_id = getIntFromRequest('group_id');
+$package_id = getIntFromRequest('package_id');
 if (!$group_id) {
 	exit_no_group();
 }
@@ -34,7 +36,17 @@
 	With much code horked from editreleases.php
 */
 
-if( $submit ) {
+if (getStringFromRequest('submit')) {
+	$release_name = getStringFromRequest('release_name');
+	$userfile = getUploadedFile('userfile');
+	$userfile_name = $userfile['name'];
+	$type_id = getIntFromRequest('type_id');
+	$processor_id = getIntFromRequest('processor_id');
+	$release_date = getStringFromRequest('release_date');
+	$release_notes = getStringFromRequest('release_notes');
+	$release_changes = getStringFromRequest('release_changes');
+	$preformatted = getStringFromRequest('preformatted');
+
 	if ($sys_use_ftpuploads && $ftp_filename && util_is_valid_filename($ftp_filename) && is_file($sys_ftp_upload_dir.'/'.$ftp_filename)) {
 		//file was uploaded already via ftp
 		//use setuid prog to chown it
@@ -146,7 +158,7 @@
 
 ?>
 
-<form enctype="multipart/form-data" method="post" action="<?php echo $PHP_SELF."?group_id=$group_id"; ?>">
+<form enctype="multipart/form-data" method="post" action="<?php echo getStringFromServer('PHP_SELF')."?group_id=$group_id"; ?>">
 	<table border="0" cellpadding="2" cellspacing="2">
 	<tr>
 		<td>
diff -urNad gforge/www/frs/admin/showreleases.php /tmp/dpep.cr36JK/gforge/www/frs/admin/showreleases.php
--- gforge/www/frs/admin/showreleases.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/frs/admin/showreleases.php	2005-01-21 00:09:56.000000000 +0100
@@ -35,9 +35,15 @@
 require_once('common/frs/FRSRelease.class');
 require_once('common/frs/FRSFile.class');
 
+$group_id = getIntFromRequest('group_id');
+$package_id = getIntFromRequest('package_id');
 if (!$group_id) {
 	exit_no_group();
 }
+if (!$package_id) {
+	header("Location /frs/admin/?group_id=$group_id?feedback=Choose+Package");
+	exit;
+}
 
 $project =& group_get_object($group_id);
 if (!$project || $project->isError()) {
@@ -49,11 +55,6 @@
 	exit_permission_denied();
 }
 
-if (!$package_id) {
-	header("Location /frs/admin/?group_id=$group_id?feedback=Choose+Package");
-	exit;
-}
-
 $frsp = new FRSPackage($project,$package_id);
 if (!$frsp || !is_object($frsp)) {
 	exit_error('Error','Could Not Get FRS Package');
@@ -64,7 +65,11 @@
 //
 //
 //
+$release_id = getIntFromRequest('release_id');
 if ($func=='delete_release' && $release_id) {
+	$sure = getStringFromRequest('sure');
+	$really_sure = getStringFromRequest('really_sure');
+
 	$frsr = new FRSRelease($frsp,$release_id);
 	if (!$frsr || !is_object($frsr)) {
 		exit_error('Error','Could Not Get FRS Release');
diff -urNad gforge/www/frs/download.php /tmp/dpep.cr36JK/gforge/www/frs/download.php
--- gforge/www/frs/download.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/frs/download.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,7 +29,7 @@
 
 require_once('pre.php');
 
-$arr=explode('/',$REQUEST_URI);
+$arr=explode('/',getStringFromServer('REQUEST_URI'));
 $file_id=$arr[3];
 
 $res=db_query("SELECT frs_file.filename,frs_package.is_public,
diff -urNad gforge/www/frs/index.php /tmp/dpep.cr36JK/gforge/www/frs/index.php
--- gforge/www/frs/index.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/frs/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,6 +29,7 @@
 require_once('pre.php');	
 require_once('www/frs/include/frs_utils.php');
 
+$group_id = getIntFromRequest('group_id');
 $cur_group =& group_get_object($group_id);
 
 if (!$cur_group) {
diff -urNad gforge/www/frs/monitor.php /tmp/dpep.cr36JK/gforge/www/frs/monitor.php
--- gforge/www/frs/monitor.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/frs/monitor.php	2005-01-21 00:09:56.000000000 +0100
@@ -14,7 +14,9 @@
 
 
 if (session_loggedin()) {
-	if ($filemodule_id && $group_id) {
+	$group_id = getIntFromRequest('group_id');
+	$filemodule_id = getIntFromRequest('filemodule_id');
+	if ($group_id && $filemodule_id) {
 		//
 		//  Set up local objects
 		//
diff -urNad gforge/www/frs/shownotes.php /tmp/dpep.cr36JK/gforge/www/frs/shownotes.php
--- gforge/www/frs/shownotes.php	2005-01-19 22:18:47.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/frs/shownotes.php	2005-01-21 00:09:56.000000000 +0100
@@ -28,6 +28,8 @@
 require_once('pre.php');
 require_once('www/frs/include/frs_utils.php');
 
+$release_id = getIntFromRequest('release_id');
+
 $result=db_query("SELECT frs_release.notes,frs_release.changes,
 		frs_release.preformatted,frs_release.name,frs_package.group_id,frs_package.is_public
 		FROM frs_release,frs_package 
diff -urNad gforge/www/help/tracker.php /tmp/dpep.cr36JK/gforge/www/help/tracker.php
--- gforge/www/help/tracker.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/help/tracker.php	2005-01-21 00:09:56.000000000 +0100
@@ -27,6 +27,8 @@
 
 require_once('pre.php');
 
+$helpname = getStringFromRequest('helpname');
+
 help_header('Tracker Help - ' . ucwords(str_replace('_',' ',$helpname)));
 ?>
 <table width="100%" cellpadding="0" cellspacing="0" border="0">
diff -urNad gforge/www/help/trove_cat.php /tmp/dpep.cr36JK/gforge/www/help/trove_cat.php
--- gforge/www/help/trove_cat.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/help/trove_cat.php	2005-01-21 00:09:56.000000000 +0100
@@ -27,6 +27,8 @@
 
 require_once('pre.php');
 
+$trove_cat_id = getIntFromRequest('trove_cat_id');
+
 $res_cat = db_query("
 	SELECT *
 	FROM trove_cat
diff -urNad gforge/www/include/browser.php /tmp/dpep.cr36JK/gforge/www/include/browser.php
--- gforge/www/include/browser.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/include/browser.php	2005-01-21 00:09:56.000000000 +0100
@@ -64,13 +64,13 @@
 */
 
 
-if (ereg( 'MSIE ([0-9].[0-9]{1,2})',$HTTP_USER_AGENT,$log_version)) {
+if (ereg( 'MSIE ([0-9].[0-9]{1,2})',getStringFromServer('HTTP_USER_AGENT'),$log_version)) {
 	$BROWSER_VER=$log_version[1];
 	$BROWSER_AGENT='IE';
-} elseif (ereg( 'Opera ([0-9].[0-9]{1,2})',$HTTP_USER_AGENT,$log_version)) {
+} elseif (ereg( 'Opera ([0-9].[0-9]{1,2})',getStringFromServer('HTTP_USER_AGENT'),$log_version)) {
 	$BROWSER_VER=$log_version[1];
 	$BROWSER_AGENT='OPERA';
-} elseif (ereg( 'Mozilla/([0-9].[0-9]{1,2})',$HTTP_USER_AGENT,$log_version)) {
+} elseif (ereg( 'Mozilla/([0-9].[0-9]{1,2})',getStringFromServer('HTTP_USER_AGENT'),$log_version)) {
 	$BROWSER_VER=$log_version[1];
 	$BROWSER_AGENT='MOZILLA';
 } else {
@@ -82,20 +82,20 @@
 	Determine platform
 */
 
-if (strstr($HTTP_USER_AGENT,'Win')) {
+if (strstr(getStringFromServer('HTTP_USER_AGENT'),'Win')) {
 	$BROWSER_PLATFORM='Win';
-} else if (strstr($HTTP_USER_AGENT,'Mac')) {
+} else if (strstr(getStringFromServer('HTTP_USER_AGENT'),'Mac')) {
 	$BROWSER_PLATFORM='Mac';
-} else if (strstr($HTTP_USER_AGENT,'Linux')) {
+} else if (strstr(getStringFromServer('HTTP_USER_AGENT'),'Linux')) {
 	$BROWSER_PLATFORM='Linux';
-} else if (strstr($HTTP_USER_AGENT,'Unix')) {
+} else if (strstr(getStringFromServer('HTTP_USER_AGENT'),'Unix')) {
 	$BROWSER_PLATFORM='Unix';
 } else {
 	$BROWSER_PLATFORM='Other';
 }
 
 /*
-echo "\n\nAgent: $HTTP_USER_AGENT";
+echo "\n\nAgent: ".getStringFromServer('HTTP_USER_AGENT');
 echo "\nIE: ".browser_is_ie();
 echo "\nMac: ".browser_is_mac();
 echo "\nWindows: ".browser_is_windows();
diff -urNad gforge/www/include/exit.php /tmp/dpep.cr36JK/gforge/www/include/exit.php
--- gforge/www/include/exit.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/include/exit.php	2005-01-21 00:09:56.000000000 +0100
@@ -44,9 +44,8 @@
  * exit_not_logged_in() - Exit with not logged in error
  */
 function exit_not_logged_in() {
-	global $REQUEST_URI;
 	//instead of a simple error page, now take them to the login page
-	header ("Location: /account/login.php?return_to=".urlencode($REQUEST_URI));
+	header ("Location: /account/login.php?return_to=".urlencode(getStringFromServer('REQUEST_URI')));
 	//exit_error('Not Logged In','Sorry, you have to be <a href="/account/login.php">logged in</a> to view this page.');
 }
 
diff -urNad gforge/www/include/Layout.class /tmp/dpep.cr36JK/gforge/www/include/Layout.class
--- gforge/www/include/Layout.class	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/include/Layout.class	2005-01-21 00:09:56.000000000 +0100
@@ -326,8 +326,7 @@
 	global $sys_show_source;
 	global $Language;
 	if ($sys_show_source) {
-		global $SCRIPT_NAME;
-		print '<a class="showsource" href="/source.php?file=' . $SCRIPT_NAME . '"> '.$Language->getText('source','show_source').' </a>';
+		print '<a class="showsource" href="/source.php?file=' . getStringFromServer('SCRIPT_NAME') . '"> '.$Language->getText('source','show_source').' </a>';
 	}
 ?>
 
@@ -501,18 +500,18 @@
 					$selected=count($TABS_DIRS)-1;
 				}
 			}
-		} elseif (strstr($GLOBALS['REQUEST_URI'],'/my/') || strstr($GLOBALS['REQUEST_URI'],'/account/') || 
-				strstr($GLOBALS['REQUEST_URI'],'/themes/') ) {
+		} elseif (strstr(getStringFromServer('REQUEST_URI'),'/my/') || strstr(getStringFromServer('REQUEST_URI'),'/account/') || 
+				strstr(getStringFromServer('REQUEST_URI'),'/themes/') ) {
 			$selected=array_search("/my/", $TABS_DIRS);
-		} elseif (strstr($GLOBALS['REQUEST_URI'],'softwaremap')) {
+		} elseif (strstr(getStringFromServer('REQUEST_URI'),'softwaremap')) {
 			$selected=array_search("/softwaremap/", $TABS_DIRS);
-		} elseif (strstr($GLOBALS['REQUEST_URI'],'/snippet/')) {
+		} elseif (strstr(getStringFromServer('REQUEST_URI'),'/snippet/')) {
 			$selected=array_search("/snippet/", $TABS_DIRS);
-		} elseif (strstr($GLOBALS['REQUEST_URI'],'/people/')) {
+		} elseif (strstr(getStringFromServer('REQUEST_URI'),'/people/')) {
 			$selected=array_search("/people/", $TABS_DIRS);
-		} elseif (strstr($GLOBALS['REQUEST_URI'],'/reporting/')) {
+		} elseif (strstr(getStringFromServer('REQUEST_URI'),'/reporting/')) {
 			$selected=array_search('/reporting/',$TABS_DIRS);
-		} elseif (strstr($GLOBALS['REQUEST_URI'],'/admin/') && user_ismember(1,'A')) {
+		} elseif (strstr(getStringFromServer('REQUEST_URI'),'/admin/') && user_ismember(1,'A')) {
 			$selected=array_search('/admin/',$TABS_DIRS);;
 		} else {
 			$selected=0;
diff -urNad gforge/www/include/LayoutSF.class /tmp/dpep.cr36JK/gforge/www/include/LayoutSF.class
--- gforge/www/include/LayoutSF.class	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/include/LayoutSF.class	2005-01-21 00:09:56.000000000 +0100
@@ -359,8 +359,8 @@
 	 * @param	array	Footer parameters array
 	 */
 	function generic_footer($params) {
-		global $PHP_SELF, $Language, $sys_name;
-		echo '<P><A HREF="/source.php?page_url='.$PHP_SELF.'"><B><FONT COLOR="WHITE">Show Source</FONT></B></A><P>';
+		global $Language, $sys_name;
+		echo '<P><A HREF="/source.php?page_url='.getStringFromServer('PHP_SELF').'"><B><FONT COLOR="WHITE">Show Source</FONT></B></A><P>';
 
 		global $IS_DEBUG,$QUERY_COUNT;
 		if ($IS_DEBUG && user_isloggedin() && user_ismember(1,'A')) {
diff -urNad gforge/www/include/logger.php /tmp/dpep.cr36JK/gforge/www/include/logger.php
--- gforge/www/include/logger.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/include/logger.php	2005-01-21 00:09:56.000000000 +0100
@@ -27,7 +27,7 @@
 	//	for foundry and project summary pages
 	//
 	//
-	$expl_pathinfo = explode('/',$REQUEST_URI);
+	$expl_pathinfo = explode('/',getStringFromServer('REQUEST_URI'));
 	if (($expl_pathinfo[1]=='foundry') || ($expl_pathinfo[1]=='projects')) {
 		$res_grp=db_query("
 			SELECT *
@@ -64,7 +64,7 @@
 	. "(day,hour,group_id,browser,ver,platform,time,page,type) "
 	. "VALUES (" . date('Ymd', mktime()) . ",'" . date('H', mktime())
 	. "','$log_group','" . browser_get_agent() . "','" . browser_get_version() 
-	. "','" . browser_get_platform() . "','" . time() . "','$PHP_SELF','0');";
+	. "','" . browser_get_platform() . "','" . time() . "','".getStringFromServer('PHP_SELF')."','0');";
 
 $res_logger = db_query ( $sql );
 
diff -urNad gforge/www/include/menuSF.php /tmp/dpep.cr36JK/gforge/www/include/menuSF.php
--- gforge/www/include/menuSF.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/include/menuSF.php	2005-01-21 00:09:56.000000000 +0100
@@ -169,8 +169,8 @@
 	$HTML->menuhtml_top(' ');
 	print "<center>";
 	// /check?uri= works better than  /check/referer
-	$valid_server = $GLOBALS['HTTP_HOST'];
-	$valid_page = $GLOBALS['PHP_SELF'];
+	$valid_server = getStringFromServer('HTTP_HOST');
+	$valid_page = getStringFromServer('PHP_SELF');
 	echo "<a href=\"http://validator.w3.org/check?uri=http://".$valid_server.$valid_page."\">";
 	print html_image("valid-html401.png",array('width'=>'88', 'height'=>'31', 'alt'=>'Valid HTML 4.01!'));
 	echo "</a>";
@@ -189,7 +189,7 @@
 	$HTML->menu_entry('/account/',$Language->getText('menu', 'my_account'));
 	if (!$GLOBALS['HTTP_POST_VARS']) {
 		$bookmark_title = urlencode( str_replace($sys_name.': ', '', $page_title));
-		$HTML->menu_entry('/my/bookmark_add.php?bookmark_url='.urlencode($GLOBALS['REQUEST_URI']).'&amp;bookmark_title='.$bookmark_title,$Language->getText('menu', 'bookmark_page'));
+		$HTML->menu_entry('/my/bookmark_add.php?bookmark_url='.urlencode(getStringFromServer('REQUEST_URI')).'&amp;bookmark_title='.$bookmark_title,$Language->getText('menu', 'bookmark_page'));
 	}
 	$HTML->menu_entry('/account/logout.php',$Language->getText('menu', 'logout'));
 	$HTML->menuhtml_bottom();
diff -urNad gforge/www/include/pre.php /tmp/dpep.cr36JK/gforge/www/include/pre.php
--- gforge/www/include/pre.php	2005-01-19 22:18:48.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/include/pre.php	2005-01-21 00:09:56.000000000 +0100
@@ -9,7 +9,11 @@
  * @version   $Id$
  */
 
-if (!isset($no_gz_buffer) || !$no_gz_buffer) {
+// escaping lib
+require_once('common/include/escapingUtils.php');
+
+$no_gz_buffer = getStringFromRequest('no_gz_buffer');
+if (!$no_gz_buffer) {
 	ob_start("ob_gzhandler");
 }
 
@@ -34,11 +38,11 @@
 /*
 	redirect to proper hostname to get around certificate problem on IE 5
 */
-if ($HTTP_HOST != $GLOBALS['sys_default_domain'] && $HTTP_HOST != $GLOBALS['sys_fallback_domain']) {
-	if ($SERVER_PORT == '443') {
-		header ("Location: https://".$GLOBALS['sys_default_domain']."$REQUEST_URI");
+if (getStringFromServer('HTTP_HOST') != $GLOBALS['sys_default_domain'] && getStringFromServer('HTTP_HOST') != $GLOBALS['sys_fallback_domain']) {
+	if (getStringFromServer('SERVER_PORT') == '443') {
+		header ("Location: https://".$GLOBALS['sys_default_domain'].getStringFromServer('REQUEST_URI'));
 	} else {
-		header ("Location: http://".$GLOBALS['sys_default_domain']."$REQUEST_URI");
+		header ("Location: http://".$GLOBALS['sys_default_domain'].getStringFromServer('REQUEST_URI'));
 	}
 	exit;
 }
@@ -84,9 +88,6 @@
 //permission functions
 require_once('common/include/Permission.class');
 
-// escaping lib
-require_once('common/include/escapingUtils.php');
-
 //library to set up context help
 require_once('www/include/help.php');
 
@@ -119,8 +120,8 @@
 
 //mandatory login
 if (!session_loggedin() && $sys_force_login == 1 ) {
-        $expl_pathinfo = explode('/',$REQUEST_URI);
-        if ($REQUEST_URI!='/' && $expl_pathinfo[1]!='account' && $expl_pathinfo[1]!='export' ) exit_not_logged_in();
+	$expl_pathinfo = explode('/',getStringFromServer('REQUEST_URI'));
+        if (getStringFromServer('REQUEST_URI')!='/' && $expl_pathinfo[1]!='account' && $expl_pathinfo[1]!='export' ) exit_not_logged_in();
 	// Show proj* export even if not logged in when force login
 	// If not default web project page would be broken
 	if ($expl_pathinfo[1]=='export' && !ereg("^proj", $expl_pathinfo[2])) exit_not_logged_in();
@@ -179,8 +180,8 @@
 	//if you aren't logged in, check your browser settings 
 	//and see if we support that language
 	//if we don't support it, just use default language
-	if ($HTTP_ACCEPT_LANGUAGE) {
-		$classname = getLanguageClassName($HTTP_ACCEPT_LANGUAGE);
+	if (getStringFromServer('HTTP_ACCEPT_LANGUAGE')) {
+		$classname = getLanguageClassName(getStringFromServer('HTTP_ACCEPT_LANGUAGE'));
 	}
 	if (!$classname) {
 		$classname=$sys_lang;
diff -urNad gforge/www/include/tool_reports.php /tmp/dpep.cr36JK/gforge/www/include/tool_reports.php
--- gforge/www/include/tool_reports.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/include/tool_reports.php	2005-01-21 00:09:56.000000000 +0100
@@ -74,9 +74,8 @@
 	global $period;
 	global $span;
 	global $Language;
-	global $PHP_SELF;
 
-	print "<form method=\"get\" action=\"$PHP_SELF#b\">";
+	print '<form method="get" action="'.getStringFromServer('PHP_SELF').'#b">';
 
 	print $html;
 
diff -urNad gforge/www/include/vote_function.php /tmp/dpep.cr36JK/gforge/www/include/vote_function.php
--- gforge/www/include/vote_function.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/include/vote_function.php	2005-01-21 00:09:56.000000000 +0100
@@ -92,12 +92,11 @@
 	}
 	$rating=((16*vote_get_rating ($vote_on_id,$flag))-15);
 
-	global $REQUEST_URI;
 	?>
 	<span style="font-size:smaller">
 	<form action="/survey/rating_resp.php" method="post">
 	<input type="radio" name="vote_on_id" value="<?php echo $vote_on_id; ?>" />
-	<input type="radio" name="redirect_to" value="<?php echo urlencode($REQUEST_URI); ?>" />
+	<input type="radio" name="redirect_to" value="<?php echo urlencode(getStringFromServer('REQUEST_URI')); ?>" />
 	<input type="radio" name="flag" value="<?php echo $flag; ?>" />
 	<div align="center">
 	<?php echo html_image("rateit.png","100","9",array()); ?>
diff -urNad gforge/www/my/bookmark_add.php /tmp/dpep.cr36JK/gforge/www/my/bookmark_add.php
--- gforge/www/my/bookmark_add.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/my/bookmark_add.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,7 +29,10 @@
 
 site_user_header(array("title"=>$Language->getText('my_bookmark_add','section')));
 
-if ($bookmark_url) {
+$bookmark_url = trim(getStringFromRequest('bookmark_url'));
+$bookmark_title = trim(getStringFromRequest('bookmark_title'));
+
+if (getStringFromRequest('submit') && $bookmark_url && $bookmark_title) {
 
 	print $Language->getText('my_bookmark_add','added_bookmark', array($bookmark_url,$bookmark_title)).".<p>&nbsp;</p>";
 
@@ -39,7 +42,7 @@
 
 } else {
 	?>
-	<form action="<?php echo $PHP_SELF; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 	<p><?php echo $Language->getText('my_bookmark_add','bookmark_url') ?>:<br />
 	<input type="text" name="bookmark_url" value="http://" />
 	</p>
diff -urNad gforge/www/my/bookmark_delete.php /tmp/dpep.cr36JK/gforge/www/my/bookmark_delete.php
--- gforge/www/my/bookmark_delete.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/my/bookmark_delete.php	2005-01-21 00:09:56.000000000 +0100
@@ -27,6 +27,8 @@
 require_once('pre.php');
 require_once('bookmarks.php');
 
+$bookmark_id = getStringFromRequest('bookmark_id');
+
 if ($bookmark_id) {
 	bookmark_delete ($bookmark_id);
 	session_redirect('/my/');
diff -urNad gforge/www/my/bookmark_edit.php /tmp/dpep.cr36JK/gforge/www/my/bookmark_edit.php
--- gforge/www/my/bookmark_edit.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/my/bookmark_edit.php	2005-01-21 00:09:56.000000000 +0100
@@ -27,18 +27,22 @@
 require_once('pre.php');
 require_once('bookmarks.php');
 
-if ($bookmark_url && $bookmark_title && $bookmark_id) {
-	if (bookmark_edit($bookmark_id, $bookmark_url, $bookmark_title)) {
+$bookmark_id = getIntFromRequest('bookmark_id');
+if (!$bookmark_id) {
+	exit_missing_param();
+}
+
+if (getStringFromRequest('submit')) {
+	$bookmark_url = getStringFromRequest('bookmark_url');
+	$bookmark_title = getStringFromRequest('bookmark_title');
+
+	if ($bookmark_url && $bookmark_title && bookmark_edit($bookmark_id, $bookmark_url, $bookmark_title)) {
 		$feedback = $Language->getText('my_bookmark_edit', 'bookmark_updated');
 	} else {
 		$feedback = $Language->getText('my_bookmark_edit', 'failed_to_update_bookmark');
 	}
 }
 
-if (!$bookmark_id) {
-	exit_missing_param();
-}
-
 site_user_header(array('title'=>$Language->getText('my_bookmark_edit','title')));
 
 $result = db_query("SELECT * from user_bookmarks where "
@@ -48,7 +52,7 @@
 	$bookmark_title = db_result($result,0,'bookmark_title');
 }
 ?>
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <input type="hidden" name="bookmark_id" value="<?php echo $bookmark_id; ?>" />
 <p><?php echo $Language->getText('my_bookmark_add','bookmark_url') ?>:<br />
 <input type="text" name="bookmark_url" value="<?php echo $bookmark_url; ?>" />
diff -urNad gforge/www/my/diary.php /tmp/dpep.cr36JK/gforge/www/my/diary.php
--- gforge/www/my/diary.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/my/diary.php	2005-01-21 00:09:56.000000000 +0100
@@ -34,16 +34,19 @@
 } else {
 
 	$u =& session_get_user();
+	$diary_id = getIntFromRequest('diary_id');
 
-	if ($submit) {
+	if (getStringFromRequest('submit')) {
+		$summary = getStringFromRequest('summary');
+		$details = getStringFromRequest('details');
 		// set $is_public
-		if ($is_public) {
+		if (getStringFromRequest('is_public')) {
 			$is_public = '1';
 		} else {
 			$is_public = '0';
 		}
 		//make changes to the database
-		if ($update) {
+		if (getStringFromRequest('update')) {
 			//updating an existing diary entry
 			$res=db_query("UPDATE user_diary SET summary='". htmlspecialchars($summary) ."',details='". htmlspecialchars($details) ."',is_public='$is_public' ".
 			"WHERE user_id='". user_getid() ."' AND id='$diary_id'");
@@ -53,7 +56,7 @@
 				echo db_error();
 				$feedback .= $Language->getText('my_diary','nothing_updated');
 			}
-		} else if ($add) {
+		} else if (getStringFromRequest('add')) {
 			//inserting a new diary entry
 
 			$sql="INSERT INTO user_diary (user_id,date_posted,summary,details,is_public) VALUES ".
@@ -132,7 +135,7 @@
 	<p>&nbsp;</p>
 	<h3>'. $info_str .'</h3>
 	<p />
-	<form action="'. $PHP_SELF .'" method="post">
+	<form action="'. getStringFromServer('PHP_SELF') .'" method="post">
 	<input type="hidden" name="'. $proc_str .'" value="1" />
 	<input type="hidden" name="diary_id" value="'. $_diary_id .'" />
 	<table>
@@ -170,7 +173,7 @@
 		echo '&nbsp;</td></tr>';
 		for ($i=0; $i<$rows; $i++) {
 			echo '
-			<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'><td><a href="'. $PHP_SELF .'?diary_id='.
+			<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'><td><a href="'. getStringFromServer('PHP_SELF') .'?diary_id='.
 				db_result($result,$i,'id').'">'.db_result($result,$i,'summary').'</a></td>'.
 				'<td>'. date($sys_datefmt, db_result($result,$i,'date_posted')).'</td></tr>';
 		}
diff -urNad gforge/www/my/rmproject.php /tmp/dpep.cr36JK/gforge/www/my/rmproject.php
--- gforge/www/my/rmproject.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/my/rmproject.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,6 +32,8 @@
 	exit_not_logged_in();
 }
 
+$group_id = getIntFromRequest('group_id');
+
 $group =& group_get_object($group_id);
 if (!$group || !is_object($group)) {
 	exit_error('Error','Could Not Get Group');
@@ -39,7 +41,7 @@
 	exit_error('Error',$group->getErrorMessage());
 }
 
-if ($confirm) {
+if (getStringFromRequest('confirm')) {
 
 	$user_id = user_getid();
 
@@ -75,7 +77,7 @@
 <table>
 <tr><td>
 
-<form action="'.$PHP_SELF.'" method="post">
+<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 <input type="hidden" name="confirm" value="1" />
 <input type="hidden" name="group_id" value="'.$group_id.'" />
 <input type="submit" value="'.$Language->getText('general','remove').'" />
diff -urNad gforge/www/new/index.php /tmp/dpep.cr36JK/gforge/www/new/index.php
--- gforge/www/new/index.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/new/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -16,6 +16,8 @@
 
 $HTML->header(array("title"=>$Language->getText('new','title'),'pagename'=>'new'));
 
+$offset = getIntFromRequest('offset');
+
 if ( !$offset || $offset < 0 ) {
 	$offset = 0;
 }
diff -urNad gforge/www/news/admin/index.php /tmp/dpep.cr36JK/gforge/www/news/admin/index.php
--- gforge/www/news/admin/index.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/news/admin/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,7 +32,19 @@
 //common forum tools which are used during the creation/editing of news items
 require_once('common/forum/Forum.class');
 
+$group_id = getIntFromRequest('group_id');
+$post_changes = getStringFromRequest('post_changes');
+$approve = getStringFromRequest('approve');
+$status = getIntFromRequest('status');
+$summary = getStringFromRequest('summary');
+$details = getStringFromRequest('details');
+
 if ($group_id && $group_id != $sys_news_group && user_ismember($group_id,'A')) {
+	$id = getIntFromRequest('id');
+	$status = getIntFromRequest('status');
+	$summary = getStringFromRequest('summary');
+	$details = getStringFromRequest('details');
+
 	/*
 
 		Per-project admin pages.
@@ -99,7 +111,7 @@
 		echo '
 		<h3>'.$Language->getText('news_admin', 'approve_newsbyte', array($group->getPublicName())).'</h3>
 		<p />
-		<form action="'.$PHP_SELF.'" method="post">
+		<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 		<input type="hidden" name="group_id" value="'.db_result($result,0,'group_id').'" />
 		<input type="hidden" name="id" value="'.db_result($result,0,'id').'" />';
 
@@ -194,7 +206,7 @@
 			*/
 			$approve='';
 			$list_queue='y';
-		} else if ($mass_reject) {
+		} else if (getStringFromRequest('mass_reject')) {
 			/*
 				Move msg to rejected status
 			*/
@@ -232,7 +244,7 @@
 		echo '
 		<h3>'.$Language->getText('news_admin', 'approve_newsbyte', array($group->getPublicName())).'</h3>
 		<p />
-		<form action="'.$PHP_SELF.'" method="post">
+		<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 		<input type="hidden" name="for_group" value="'.db_result($result,0,'group_id').'" />
 		<input type="hidden" name="id" value="'.db_result($result,0,'id').'" />
 		<strong>'.$Language->getText('news_admin', 'submitted_for_group').':</strong> <a href="/projects/'.strtolower(db_result($result,0,'unix_group_name')).'/">'.$group->getPublicName().'</a><br />
diff -urNad gforge/www/news/admin/news_admin_utils.php /tmp/dpep.cr36JK/gforge/www/news/admin/news_admin_utils.php
--- gforge/www/news/admin/news_admin_utils.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/news/admin/news_admin_utils.php	2005-01-21 00:09:56.000000000 +0100
@@ -34,7 +34,7 @@
        	// function to show single news item
        	// factored out because called 3 time below
        	function show_news_item($result,$i,$approved,$selectable) {
-	        global $PHP_SELF,$HTML, $sys_shortdatefmt;
+	        global $HTML, $sys_shortdatefmt;
 
 		echo '<tr '. $HTML->boxGetAltRowStyle($i) . '><td width="20%">';
        		if ($selectable) {
@@ -45,7 +45,7 @@
        		echo date($sys_shortdatefmt, db_result($result,$i,'post_date')).'</td>
        		<td width="45%">';
        		echo '
-       		<a href="'.$PHP_SELF.'?approve=1&amp;id='.db_result($result,$i,'id').'">'.db_result($result,$i,'summary').'</a>
+       		<a href="'.getStringFromServer('PHP_SELF').'?approve=1&amp;id='.db_result($result,$i,'id').'">'.db_result($result,$i,'summary').'</a>
        		</td>
 
        		<td width="35%">
@@ -68,7 +68,7 @@
        	$result=db_query($sql_pending);
        	$rows=db_numrows($result);
 
-       	echo '<form action="'. $PHP_SELF .'" method="post">';
+       	echo '<form action="'. getStringFromServer('PHP_SELF') .'" method="post">';
        	echo '<input type="hidden" name="mass_reject" value="1" />';
        	echo '<input type="hidden" name="post_changes" value="y" />';
 
diff -urNad gforge/www/news/index.php /tmp/dpep.cr36JK/gforge/www/news/index.php
--- gforge/www/news/index.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/news/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -33,6 +33,10 @@
 
 echo $Language->getText('news', 'choose');
 
+$group_id = getIntFromRequest('group_id');
+$limit = getIntFromRequest('limit');
+$offset = getIntFromRequest('offset');
+
 /*
 	Put the result set (list of forums for this group) into a column with folders
 */
@@ -73,7 +77,7 @@
 		<br />';
 	}
 
-        if ($more) {
+        if (getStringFromRequest('more')) {
         	echo '<br /><a href="'
                      .'?group_id='.$group_id.'&amp;limit='.$limit
                      .'&amp;offset='. (string)($offset+$limit) .'">['.$Language->getText('news', 'olderheadlines').']</a>';
diff -urNad gforge/www/news/news_utils.php /tmp/dpep.cr36JK/gforge/www/news/news_utils.php
--- gforge/www/news/news_utils.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/news/news_utils.php	2005-01-21 00:09:56.000000000 +0100
@@ -31,7 +31,7 @@
 */
 
 function news_header($params) {
-	global $DOCUMENT_ROOT,$HTML,$group_id,$news_name,$news_id,$sys_news_group,$Language,$sys_use_news;
+	global $HTML,$group_id,$news_name,$news_id,$sys_news_group,$Language,$sys_use_news;
 
 	if (!$sys_use_news) {
 		exit_disabled();
diff -urNad gforge/www/news/submit.php /tmp/dpep.cr36JK/gforge/www/news/submit.php
--- gforge/www/news/submit.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/news/submit.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,7 @@
 require_once('www/news/news_utils.php');
 require_once('common/forum/Forum.class');
 
+$group_id = getIntFromRequest('group_id');
 
 if (session_loggedin()) {
 
@@ -37,11 +38,16 @@
 		exit_permission_denied($Language->getText('news_submit','cannot'));
 	}
 
+	$group_id = getIntFromRequest('group_id');
+
 	if ($group_id == $sys_news_group) {
 		exit_permission_denied($Language->getText('news_submit','cannotadmin'));
 	}
 
-	if ($post_changes) {
+	if (getStringFromRequest('post_changes')) {
+		$summary = getStringFromRequest('summary');
+		$details = getStringFromRequest('details');
+
 		//check to make sure both fields are there
 		if ($summary && $details) {
 			/*
@@ -92,7 +98,7 @@
 		<p>
 		'. $Language->getText('news_submit', 'post_blurb', $GLOBALS['sys_name']) .'</p>' . $jsfunc . 
 		'<p>
-		<form action="'.$PHP_SELF.'" method="post">
+		<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 		<input type="hidden" name="group_id" value="'.$group_id.'" />
 		<strong>'.$Language->getText('news_submit', 'forproject').': '.$group->getPublicName().'</strong>
 		<input type="hidden" name="post_changes" value="y" /></p>
diff -urNad gforge/www/notepad.php /tmp/dpep.cr36JK/gforge/www/notepad.php
--- gforge/www/notepad.php	2003-11-04 21:52:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/notepad.php	2005-01-21 00:09:56.000000000 +0100
@@ -37,17 +37,22 @@
  *  cols:       Colums
  */
 
-if ($wrap == '') {
+$form = getStringFromRequest('form');
+$wrap = getStringFromRequest('wrap');
+$rows = getIntFromRequest('rows');
+$cols = getIntFromRequest('cols');
+
+if (!$wrap) {
         $wrap = "SOFT";
 }
-if ($rows == '') {
+if (!$rows) {
         $rows = 30;
 }
-if ($cols == '') {
+if (!$cols) {
         $cols = 75;
 }
 $pform = '';
-if ($form != '') {
+if ($form) {
         $pform = "opener.".$form;
 }
 ?>
diff -urNad gforge/www/people/admin/index.php /tmp/dpep.cr36JK/gforge/www/people/admin/index.php
--- gforge/www/people/admin/index.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/people/admin/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,14 +32,18 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
+$job_id = getIntFromRequest('job_id');
+
 if (user_ismember(1,'A')) {
 
-	if ($post_changes) {
+	if (getStringFromRequest('post_changes')) {
 		/*
 			Update the database
 		*/
 
-		if ($people_cat) {
+		if (getStringFromRequest('people_cat')) {
+			$cat_name = getStringFromRequest('cat_name');
 
 			$sql="INSERT INTO people_job_category (name) VALUES ('$cat_name')";
 			$result=db_query($sql);
@@ -50,7 +54,8 @@
 
 			$feedback .= ' Category Inserted ';
 
-		} else if ($people_skills) {
+		} else if (getStringFromRequest('people_skills')) {
+			$skill_name = getStringFromRequest('skill_name');
 
 			$sql="INSERT INTO people_skill (name) VALUES ('$skill_name')";
 			$result=db_query($sql);
@@ -61,7 +66,9 @@
 
 			$feedback .= ' Skill Inserted ';
 /*
-		} else if ($people_cat_mod) {
+		} else if (getStringFromRequest('people_cat_mod')) {
+			$cat_name = getStringFromRequest('cat_name');
+			$people_cat_id = getIntFromRequest('people_cat_id');
 
 			$sql="UPDATE people_category SET category_name='$cat_name' WHERE people_category_id='$people_cat_id' AND group_id='$group_id'";
 			$result=db_query($sql);
@@ -72,7 +79,10 @@
 				$feedback .= ' Bug Category Modified ';
 			}
 
-		} else if ($people_group_mod) {
+		} else if (getStringFromRequest('people_group_mod')) {
+			$group_name = getStringFromRequest('group_name');
+			$people_group_id = getIntFromRequest('people_group_id');
+			$group_id = getIntFromRequest('group_id');
 
 			$sql="UPDATE people_group SET group_name = '$group_name' WHERE people_group_id='$people_group_id' AND group_id='$group_id'";
 			$result=db_query($sql);
@@ -90,7 +100,7 @@
 		Show UI forms
 	*/
 
-	if ($people_cat) {
+	if (getStringFromRequest('people_cat')) {
 		/*
 			Show categories and blank row
 		*/
@@ -111,7 +121,7 @@
 		}
 		?>
 		<p>
-		<form action="<?php echo $PHP_SELF; ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 		<input type="hidden" name="people_cat" value="y" />
 		<input type="hidden" name="post_changes" value="y" />
 		<h4>New Category Name:</h4>
@@ -125,7 +135,7 @@
 
 		people_footer(array());
 
-	} else if ($people_skills) {
+	} else if (getStringFromRequest('people_skills')) {
 		/*
 			Show people_groups and blank row
 		*/
@@ -145,7 +155,7 @@
 		}
 		?>
 		<p>
-		<form action="<?php echo $PHP_SELF; ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 		<input type="hidden" name="people_skills" value="y" />
 		<input type="hidden" name="post_changes" value="y" />
 		<h4>New Skill Name:</h4>
@@ -167,10 +177,10 @@
 		people_header(array ('title'=>'People Administration','pagename'=>'people_admin'));
 
 		echo '<p>
-			<a href="'.$PHP_SELF.'?people_cat=1">Add Job Categories</a><br />';
+			<a href="'.getStringFromServer('PHP_SELF').'?people_cat=1">Add Job Categories</a><br />';
 	//	echo "\nAdd categories of bugs like, 'mail module','gant chart module','interface', etc<p>";
 
-		echo "\n<a href=\"$PHP_SELF?people_skills=1\">Add Job Skills</a><br />";
+		echo "\n<a href=\"".getStringFromServer('PHP_SELF')."?people_skills=1\">Add Job Skills</a><br />";
 	//	echo "\nAdd Groups of bugs like 'future requests','unreproducible', etc<p>";
 
 		people_footer(array());
diff -urNad gforge/www/people/createjob.php /tmp/dpep.cr36JK/gforge/www/people/createjob.php
--- gforge/www/people/createjob.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/people/createjob.php	2005-01-21 00:09:56.000000000 +0100
@@ -33,6 +33,8 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
+
 if ($group_id && (user_ismember($group_id, 'A'))) {
 
 	project_admin_header(array());
diff -urNad gforge/www/people/editjob.php /tmp/dpep.cr36JK/gforge/www/people/editjob.php
--- gforge/www/people/editjob.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/people/editjob.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,9 +32,19 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
+
 if ($group_id && (user_ismember($group_id, 'A'))) {
+	$title = getStringFromRequest('title');
+	$description = getStringFromRequest('description');
+	$category_id = getIntFromRequest('category_id');
+	$status_id = getIntFromRequest('status_id');
+	$job_id = getStringFromRequest('job_id');
+	$skill_id = getIntFromRequest('skill_id');
+	$skill_level_id = getIntFromRequest('skill_level_id');
+	$skill_year_id = getIntFromRequest('skill_year_id');
 
-	if ($add_job) {
+	if (getStringFromRequest('add_job')) {
 		/*
 			create a new job
 		*/
@@ -52,7 +62,7 @@
 			$feedback .= $Language->getText('people_editjob','job_insert_ok');
 		}
 
-	} else if ($update_job) {
+	} else if (getStringFromRequest('update_job')) {
 		/*
 			update the job's description, status, etc
 		*/
@@ -71,7 +81,7 @@
 			$feedback .= $Language->getText('people_editjob','job_update_ok');
 		}
 
-	} else if ($add_to_job_inventory) {
+	} else if (getStringFromRequest('add_to_job_inventory')) {
 		/*
 			add item to job inventory
 		*/
@@ -87,7 +97,7 @@
 			$feedback .= $Language->getText('people_editjob','job_update_no_wrong_id');
 		}
 
-	} else if ($update_job_inventory) {
+	} else if (getStringFromRequest('update_job_inventory')) {
 		/*
 			Change Skill level, experience etc.
 		*/
@@ -110,7 +120,7 @@
 			$feedback .= $Language->getText('people_editjob','job_skill_update_no_wrong_id');
 		}
 
-	} else if ($delete_from_job_inventory) {
+	} else if (getStringFromRequest('delete_from_job_inventory')) {
 		/*
 			remove this skill from this job
 		*/
@@ -150,7 +160,7 @@
 
 		echo $Language->getText('people_editjob','skill_explains').'
 
-		<p /><form action="'.$PHP_SELF.'" method="post">
+		<p /><form action="'.getStringFromServer('PHP_SELF').'" method="post">
 		<input type="hidden" name="group_id" value="'.$group_id.'" />
 		<input type="hidden" name="job_id" value="'.$job_id.'" />
 		<strong>'.$Language->getText('people','category').':</strong><br />
diff -urNad gforge/www/people/editprofile.php /tmp/dpep.cr36JK/gforge/www/people/editprofile.php
--- gforge/www/people/editprofile.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/people/editprofile.php	2005-01-21 00:09:56.000000000 +0100
@@ -18,9 +18,14 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
+$job_id = getIntFromRequest('job_id');
+
 if (session_loggedin()) {
 
-	if ($update_profile) {
+	if (getStringFromRequest('update_profile')) {
+		$people_view_skills = getStringFromRequest('people_view_skills');
+
 		/*
 			update the job's description, status, etc
 		*/
@@ -34,8 +39,15 @@
 			$feedback .= $Language->getText('people_editprofile','update_ok');
 		}
 
-	} else if($AddSkill) {
-	
+	} else if (getStringFromRequest('AddSkill')) {
+		$type = getStringFromRequest('type');
+		$title = getStringFromRequest('title');
+		$startM = getStringFromRequest('startM');
+		$startY = getStringFromRequest('startY');
+		$endM = getStringFromRequest('endM');
+		$endY = getStringFromRequest('endY');
+		$keywords = getStringFromRequest('keywords');
+
 		if($type && $title && $startM && $startY && $endM && $endY && $keywords) {			 
 			$start = $startY.$startM;
 			$finish = $endY.$endM;
@@ -74,41 +86,49 @@
 			exit_error($Language->getText('people_editprofile','error'),$Language->getText('people_editprofile','fill_all_required_fields'));
 		}
 	}
-	if ($MultiEdit) {
+	if (getStringFromRequest('MultiEdit')) {
+		$type = getStringFromRequest('type');
+		$title = getStringFromRequest('title');
+		$startM = getStringFromRequest('startM');
+		$startY = getStringFromRequest('startY');
+		$endM = getStringFromRequest('endM');
+		$endY = getStringFromRequest('endY');
+		$keywords = getStringFromRequest('keywords');
+		$skill_edit = getStringFromRequest('skill_edit');
+
 		$numItems = count($skill_edit);
 		if($numItems == 0) {
 			$feedback .= $Language->getText('people_editprofile','no_skills_selected');
 		} else {
-			if($confirmMultiEdit) {
-			   $rowsDone = 0;
-				
+			if (getStringFromRequest('confirmMultiEdit')) {
+				$rowsDone = 0;
+
 				for($i = 0; $i < $numItems; $i++) {
 					$title[$i] = substr($title[$i], 0, 100);	/* delimit the title to 100 chars */
 					$keywords[$i] = substr($keywords[$i], 0, 255); /* ditto the keywords. */
-			
+
 					$keywords[$i] = str_replace("\n", " ", $keywords[$i]);  /* strip out any backspace characters. */
 					$title[$i] = str_replace("\n", " ", $title[$i]);
-			
 					$sql="UPDATE skills_data SET type='$type[$i]',title='$title[$i]',start='$startY[$i]$startM[$i]',".
-						 "finish='$endY[$i]$endM[$i]',keywords='$keywords[$i]' ".
+						"finish='$endY[$i]$endM[$i]',keywords='$keywords[$i]' ".
 						"WHERE skills_data_id='$skill_edit[$i]'";
-						
+
 					$result=db_query($sql);
 					if (!$result || db_affected_rows($result) < 1) {
 						echo db_error();
 						$feedback = $Language->getText('people_editprofile','failed_update_skills');
 						break;
-					} else {	  
-					   $rowsDone++; 
-					   $feedback = $Language->getText('people_editprofile','update_skills_ok', ($rowsDone>1?"s":""));
-					}						
+					} else {
+						$rowsDone++;
+						$feedback = $Language->getText('people_editprofile','update_skills_ok', ($rowsDone>1?"s":""));
+					}
 				}   /* end for */
-				
+
 			} else	/* not confirmed multiedit */ {
 				people_header(array('title'=>$Language->getText('people_editprofile','skills_edit'),'pagename'=>'people_editskills'));
 				echo '<h2><span style="color:red">'.$Language->getText('people_editprofile','edit_skills').'</span><h2>';
 				echo $Language->getText('people_editprofile','change_required_fields');
-				echo '<form action="'.$PHP_SELF.'" method="post">';
+				echo '<form action="'.getStringFromServer('PHP_SELF').'" method="post">';
 				handle_multi_edit($skill_edit);
 				echo '<input type="hidden" name="confirmMultiEdit" value="1" />';
 				echo '<input type="submit" name="MultiEdit" value="'.$Language->getText('general','done').'" />';
@@ -118,16 +138,17 @@
 				return;
 			}
 		}
-	} else if($cancelMultiEdit) {
+	} else if (getStringFromRequest('cancelMultiEdit')) {
 		$feedback = $Language->getText('people_editprofile','cancel_skills_update');
 	}
 	
-	if($MultiDelete) {
+	if (getStringFromRequest('MultiDelete')) {
+		$skill_delete = $skill_delete;
 		$numItems = count($skill_delete);
 		if($numItems == 0) {
 			$feedback .= $Language->getText('people_editprofile','no_skills_selected_to_delete');
 		} else {
-			if($confirmMultiDelete) {
+			if(getStringFromRequest('confirmMultiDelete')) {
 				$sql = "DELETE FROM skills_data where skills_data_id in(".$skill_delete[0];
 				for($i = 1; $i < $numItems; $i++) {
 					$sql .= ",".$skill_delete[$i];
@@ -163,7 +184,7 @@
 					echo "<br />".$Language->getText('people_editprofile','from_skills_database')."<br /><br />";
 					echo $Language->getText('people_editprofile','are_you_sure');
 					
-					echo '<form action="'.$PHP_SELF.'" method="post">';
+					echo '<form action="'.getStringFromServer('PHP_SELF').'" method="post">';
 					for($i = 0; $i < $rows; $i ++) {
 						echo '<input type="hidden" name="skill_delete[]" value="'.$skill_delete[$i].'">';
 					}
@@ -177,7 +198,7 @@
 			}
 			
 		}
-	} elseif($MultiDeleteCancel) {
+	} elseif (getStringFromRequest('MultiDeleteCancel')) {
 		$feedback .= $Language->getText('people_editprofile','skill_deletion_cancelled');
 	}
 
@@ -198,7 +219,7 @@
 
 		echo '
 		<h2>'.$Language->getText('people_editprofile','edit_public_permissions').'<h2>
-		<form action="'.$PHP_SELF.'" method="post">
+		<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 		'.$Language->getText('people_editprofile','following_options').'
 		<p>
 		<strong>'.$Language->getText('people_editprofile','publicly_viewable').':</strong><br />
@@ -236,7 +257,7 @@
 		echo '<h2>'.$Language->getText('people_editprofile','add_new_skill').'</h2>';
 		echo $Language->getText('people_editprofile','you_can_enter_new_skills').'<br />'.
 			 '<FONT COLOR="#ff0000"><em><strong>'.$Language->getText('people_editprofile','all_fields_required').'</em></strong></FONT>';
-	   	echo '<form action="'.$PHP_SELF.'" METHOD="POST">';
+	   	echo '<form action="'.getStringFromServer('PHP_SELF').'" METHOD="POST">';
 		$cell_data = array();
 		$cell_data[] = array($Language->getText('people_editprofile','type'));
 		$cell_data[] = array($Language->getText('people_editprofile','start_date'));
@@ -279,7 +300,7 @@
 		
 		echo '<h2>'.$Language->getText('people_editprofile','edit_delete_your_skills').'</h2>
 		<table border="0" width="100%">';
-		echo '<form action="'.$PHP_SELF.'" METHOD="POST">';
+		echo '<form action="'.getStringFromServer('PHP_SELF').'" METHOD="POST">';
 		displayUserSkills(user_getid(), 1); 
 		echo '</form>';				
 		echo '</TABLE>';
diff -urNad gforge/www/people/helpwanted-latest.php /tmp/dpep.cr36JK/gforge/www/people/helpwanted-latest.php
--- gforge/www/people/helpwanted-latest.php	2004-10-10 22:59:05.000000000 +0200
+++ /tmp/dpep.cr36JK/gforge/www/people/helpwanted-latest.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,6 +32,9 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
+$job_id = getIntFromRequest('job_id');
+
 people_header(array('title'=>$Language->getText('people_help_wanted_latest','title'),'pagename'=>'people_helpwanted_latest'));
 
 {
diff -urNad gforge/www/people/index.php /tmp/dpep.cr36JK/gforge/www/people/index.php
--- gforge/www/people/index.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/people/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -33,6 +33,9 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
+$category_id = getIntFromRequest('category_id');
+
 if ($group_id) {
 	
 	project_admin_header(array());
diff -urNad gforge/www/people/people_utils.php /tmp/dpep.cr36JK/gforge/www/people/people_utils.php
--- gforge/www/people/people_utils.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/people/people_utils.php	2005-01-21 00:09:56.000000000 +0100
@@ -26,7 +26,7 @@
  */
 
 function people_header($params) {
-	global $group_id,$job_id,$DOCUMENT_ROOT,$HTML;
+	global $group_id,$job_id,$HTML;
 
 	if ($group_id) {
 		$params['toptab']='people';
@@ -157,7 +157,7 @@
 }
 
 function people_edit_skill_inventory($user_id) {
-	global $PHP_SELF, $Language;
+	global $Language;
 	$sql="SELECT * FROM people_skill_inventory WHERE user_id='$user_id'";
 	$result=db_query($sql);
 
@@ -177,7 +177,7 @@
 	} else {
 		for ($i=0; $i < $rows; $i++) {
 			echo '
-			<form action="'.$PHP_SELF.'" method="post">
+			<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 			<input type="hidden" name="skill_inventory_id" value="'.db_result($result,$i,'skill_inventory_id').'" />
 			<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'>
 				<td><span style="font-size:smaller">'. people_get_skill_name(db_result($result,$i,'skill_id')) .'</span></td>
@@ -194,7 +194,7 @@
 
 	echo '
 	<tr><td colspan="4"><h3>'.$Language->getText('people','add_new_skill').'</h3></td></tr>
-	<form action="'.$PHP_SELF.'" method="post">
+	<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 	<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'>
 		<td><span style="font-size:smaller">'. people_skill_box('skill_id'). '</span></td>
 		<td><span style="font-size:smaller">'. people_skill_level_box('skill_level_id'). '</span></td>
@@ -307,7 +307,7 @@
 // think of a way of turning into valid XHTML without the resulting
 // table looking like poo.
 function people_edit_job_inventory($job_id,$group_id) {
-	global $PHP_SELF, $Language, $HTML;
+	global $Language, $HTML;
 	$sql="SELECT * FROM people_job_inventory WHERE job_id='$job_id'";
 	$result=db_query($sql);
 
@@ -328,7 +328,7 @@
 		for ($i=0; $i < $rows; $i++) {
 			echo '
 			<tr '. $HTML->boxGetAltRowStyle($i) . '>
-			<form action="'.$PHP_SELF.'" method="post">
+			<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 			<input type="hidden" name="job_inventory_id" value="'. db_result($result,$i,'job_inventory_id') .'" />
 			<input type="hidden" name="job_id" value="'. db_result($result,$i,'job_id') .'" />
 			<input type="hidden" name="group_id" value="'.$group_id.'" />
@@ -347,7 +347,7 @@
 	echo '
 	<tr><td colspan="4"><h3>'.$Language->getText('people','add_new_skill').'</h3></td></tr>
 	<tr '. $HTML->boxGetAltRowStyle($i) . '>
-	<form action="'.$PHP_SELF.'" method="post">
+	<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 	<input type="hidden" name="job_id" value="'. $job_id .'" />
 	<input type="hidden" name="group_id" value="'.$group_id.'" />
 		<td width="25%"><span style="font-size:smaller">'. people_skill_box('skill_id'). '</span></td>
diff -urNad gforge/www/people/viewjob.php /tmp/dpep.cr36JK/gforge/www/people/viewjob.php
--- gforge/www/people/viewjob.php	2005-01-19 22:18:49.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/people/viewjob.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,6 +32,9 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
+$job_id = getIntFromRequest('job_id');
+
 if ($group_id && $job_id) {
 
 	/*
diff -urNad gforge/www/people/viewprofile.php /tmp/dpep.cr36JK/gforge/www/people/viewprofile.php
--- gforge/www/people/viewprofile.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/people/viewprofile.php	2005-01-21 00:09:56.000000000 +0100
@@ -18,6 +18,10 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
+$job_id = getIntFromRequest('job_id');
+
+$user_id = getStringFromRequest('user_id');
 if ($user_id) {
 
 	/*
diff -urNad gforge/www/pm/add_task.php /tmp/dpep.cr36JK/gforge/www/pm/add_task.php
--- gforge/www/pm/add_task.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/add_task.php	2005-01-21 00:09:56.000000000 +0100
@@ -18,11 +18,16 @@
 
 require_once('note.php');
 
+$group_id = getIntFromRequest('group_id');
+$group_project_id = getIntFromRequest('group_project_id');
+$related_artifact_id = getIntFromRequest('related_artifact_id');
+$related_artifact_summary = getStringFromRequest('related_artifact_summary');
+
 pm_header(array('title'=>$Language->getText('pm_addtask','title'),'pagename'=>'pm_addtask','group_project_id'=>$group_project_id));
 echo notepad_func();
 ?>
 
-<form action="<?php echo "$PHP_SELF?group_id=$group_id&amp;group_project_id=$group_project_id"; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF')."?group_id=$group_id&amp;group_project_id=$group_project_id"; ?>" method="post">
 <input type="hidden" name="func" value="postaddtask" />
 <input type="hidden" name="add_artifact_id[]" value="<?php echo $related_artifact_id; ?>" />
 
diff -urNad gforge/www/pm/admin/index.php /tmp/dpep.cr36JK/gforge/www/pm/admin/index.php
--- gforge/www/pm/admin/index.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/admin/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,9 @@
 	exit_not_logged_in();
 }
 
+$group_id = getIntFromRequest('group_id');
+$group_project_id = getIntFromRequest('group_project_id');
+
 if (!$group_id) {
 	exit_no_group();
 }
@@ -38,7 +41,12 @@
 
 $perm =& $g->getPermission( session_get_user() );
 
-if ($post_changes) {
+$update_cat = getStringFromRequest('update_cat');
+$add_cat = getStringFromRequest('add_cat');
+$delete = getStringFromRequest('delete');
+$id = getIntFromRequest('id');
+
+if (getStringFromRequest('post_changes')) {
 	/*
 		Update the database
 	*/
@@ -49,7 +57,12 @@
 		exit_error('Error',$pg->getErrorMessage());
 	}
 
-	if ($addproject) {
+	if (getStringFromRequest('addproject')) {
+		$project_name = getStringFromRequest('project_name');
+		$description = getStringFromRequest('description');
+		$is_public = getStringFromRequest('is_public');
+		$send_all_posts_to = getStringFromRequest('send_all_posts_to');
+
 		/*
 			Add new subproject
 		*/
@@ -63,6 +76,8 @@
 		}
 
 	} else if ($add_cat) {
+		$name = getStringFromRequest('name');
+
 		/*
 			Add a project_category
 		*/
@@ -82,6 +97,9 @@
 		}
 
 	} else if ($update_cat) {
+		$id = getIntFromRequest('id');
+		$name = getStringFromRequest('name');
+
 		/*
 			Update a project_category
 		*/
@@ -104,7 +122,11 @@
 			}
 		}
 
-	} else if ($update_pg) {
+	} else if (getStringFromRequest('update_pg')) {
+		$project_name = getStringFromRequest('project_name');
+		$description = getStringFromRequest('description');
+		$send_all_posts_to = getStringFromRequest('send_all_posts_to');
+
 		/*
 			Update a subproject
 		*/
@@ -119,6 +141,9 @@
 		}
 
 	} else if ($delete) {
+		$sure = getStringFromRequest('sure');
+		$really_sure = getStringFromRequest('really_sure');
+
 		/*
 			Delete a subproject
 		*/
@@ -126,12 +151,12 @@
 			exit_permission_denied();
 		}
 
-		if (!$pg->delete($sure,$really_sure)) {
+		if (!$pg->delete(getStringFromRequest('sure'),getStringFromRequest('really_sure'))) {
 			exit_error('Error',$pg->getErrorMessage());
 		} else {
 			$feedback .= $Language->getText('pm_admin_projects','deleted');
 			$group_project_id=0;
-			$delete=0;
+			$delete=false;
 		}
 	}
 }
@@ -171,7 +196,7 @@
 		for ($i=0; $i < $rows; $i++) {
 			echo '<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'>'.
 				'<td>'.db_result($result, $i, 'category_id').'</td>'.
-				'<td><a href="'.$PHP_SELF.'?update_cat=1&amp;id='.
+				'<td><a href="'.getStringFromServer('PHP_SELF').'?update_cat=1&amp;id='.
 					db_result($result, $i, 'category_id').'&amp;group_id='.$group_id.'&amp;group_project_id='. $pg->getID() .'">'.
 					db_result($result, $i, 'category_name').'</a></td></tr>';
 		}
@@ -184,7 +209,7 @@
 
 	?>
 	<p />
-	<form action="<?php echo $PHP_SELF.'?group_id='.$group_id; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id; ?>" method="post">
 	<input type="hidden" name="add_cat" value="y" />
 	<input type="hidden" name="group_project_id" value="<?php echo $pg->getID(); ?>" />
 	<strong><?php echo $Language->getText('pm_admin_projects','category_name') ?>:</strong><br />
@@ -228,7 +253,7 @@
 	} else {
 		?>
 		<p />
-		<form action="<?php echo $PHP_SELF.'?group_id='.$group_id; ?>" method="post" />
+		<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id; ?>" method="post" />
 		<input type="hidden" name="update_cat" value="y" />
 		<input type="hidden" name="id" value="<?php echo $ac->getID(); ?>" />
 		<input type="hidden" name="group_project_id" value="<?php echo $pg->getID(); ?>" />
@@ -245,7 +270,7 @@
 
 	pm_footer(array());
 
-} elseif ($addproject) {
+} elseif (getStringFromRequest('addproject')) {
 	/*
 		Create a new subproject
 	*/
@@ -259,7 +284,7 @@
 	<p><?php echo $Language->getText('pm_admin_projects','projects_intro') ?></p>
 
 	<p />
-	<form action="<?php echo $PHP_SELF."?group_id=$group_id"; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF')."?group_id=$group_id"; ?>" method="post">
 	<input type="hidden" name="addproject" value="y" />
 	<input type="hidden" name="post_changes" value="y" />
 	<p />
@@ -282,8 +307,7 @@
 	<?php
 	pm_footer(array());
 
-} else if ($update_pg && $group_project_id) {
-
+} else if (getStringFromRequest('update_pg') && $group_project_id) {
 
 	$pg = new ProjectGroup($g,$group_project_id);
 	if (!$pg || !is_object($pg)) {
@@ -301,7 +325,7 @@
 	<p><?php echo $Language->getText('pm_admin_projects','change_project_intro') ?></p>
 	<p />
 
-	<form action="<?php echo $PHP_SELF.'?group_id='.$group_id; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id; ?>" method="post">
 	<input type="hidden" name="post_changes" value="y" />
 	<input type="hidden" name="update_pg" value="y" />
 	<input type="hidden" name="group_project_id" value="<?php echo $pg->getID(); ?>" />
@@ -333,8 +357,8 @@
 	</tr>
 	<tr>
 		<td>
-			<strong><a href="<?php echo $PHP_SELF."?group_id=$group_id&amp;add_cat=1&amp;group_project_id=".$pg->getID(); ?>"><?php echo $Language->getText('pm_admin_projects','add_edit_categories')?></a></strong><br />
-			<strong><a href="<?php echo $PHP_SELF."?group_id=$group_id&amp;delete=1&amp;group_project_id=".$pg->getID(); ?>"><?php echo $Language->getText('pm_admin_projects','delete_info')?></a></strong><br />
+			<strong><a href="<?php echo getStringFromServer('PHP_SELF')."?group_id=$group_id&amp;add_cat=1&amp;group_project_id=".$pg->getID(); ?>"><?php echo $Language->getText('pm_admin_projects','add_edit_categories')?></a></strong><br />
+			<strong><a href="<?php echo getStringFromServer('PHP_SELF')."?group_id=$group_id&amp;delete=1&amp;group_project_id=".$pg->getID(); ?>"><?php echo $Language->getText('pm_admin_projects','delete_info')?></a></strong><br />
 		</td>
 	</tr>
 	<tr>
@@ -364,7 +388,7 @@
 	pm_header(array('title'=>$Language->getText('pm_admin_projects','delete')));
 
 	?>
-	<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&amp;group_project_id='.$group_project_id; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;group_project_id='.$group_project_id; ?>" method="post">
 	<input type="hidden" name="post_changes" value="y" />
 	<input type="hidden" name="delete" value="y" /><br />
 	<?php echo $Language->getText('pm_admin_projects','delete_warning'); ?>
@@ -391,7 +415,7 @@
 	if ($perm->isPMAdmin()) {
 		?>
 		<p />
-		<a href="<?php echo $PHP_SELF.'?group_id='.$group_id; ?>&amp;addproject=1"><?php echo $Language->getText('pm_admin_projects','add_project') ?></a><br />
+		<a href="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id; ?>&amp;addproject=1"><?php echo $Language->getText('pm_admin_projects','add_project') ?></a><br />
 		<?php echo $Language->getText('pm_admin_projects','add_project_intro') ?>
 		<p />
 		<?php
@@ -411,7 +435,7 @@
 		echo db_error();
 	} else {
 		for ($i=0; $i<count($pg_arr); $i++) {
-			echo '<a href="'. $PHP_SELF.'?group_id='.$group_id.'&amp;group_project_id='.$pg_arr[$i]->getID().'&amp;update_pg=1">'.$Language->getText('pm_admin_projects','edit_update').': <strong>'.$pg_arr[$i]->getName().'</strong></a><p />';
+			echo '<a href="'. getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;group_project_id='.$pg_arr[$i]->getID().'&amp;update_pg=1">'.$Language->getText('pm_admin_projects','edit_update').': <strong>'.$pg_arr[$i]->getName().'</strong></a><p />';
 		}
 
 	}
diff -urNad gforge/www/pm/browse_task.php /tmp/dpep.cr36JK/gforge/www/pm/browse_task.php
--- gforge/www/pm/browse_task.php	2005-01-21 00:03:02.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/browse_task.php	2005-01-21 00:09:56.000000000 +0100
@@ -23,6 +23,9 @@
 
 $pagename = "pm_browse_custom";
 
+$offset = getIntFromRequest('offset');
+$max_rows = getIntFromRequest('max_rows');
+
 $ptf = new ProjectTaskFactory($pg);
 if (!$ptf || !is_object($ptf)) {
 	exit_error('Error','Could Not Get ProjectTaskFactory');
@@ -101,7 +104,7 @@
 /*
 	Show the new pop-up boxes to select assigned to and/or status
 */
-echo '	<form action="'. $PHP_SELF .'?group_id='.$group_id.'&amp;group_project_id='.$group_project_id.'" method="post">
+echo '	<form action="'. getStringFromServer('PHP_SELF') .'?group_id='.$group_id.'&amp;group_project_id='.$group_project_id.'" method="post">
 	<input type="hidden" name="set" value="custom" />
 	<table width="10%" border="0">
 	<tr>
@@ -136,7 +139,7 @@
 
 	if ($IS_ADMIN) {
 		echo '
-		<form name="taskList" action="'. $PHP_SELF .'?group_id='.$group_id.'&group_project_id='.$pg->getID().'" METHOD="POST">
+		<form name="taskList" action="'. getStringFromServer('PHP_SELF') .'?group_id='.$group_id.'&group_project_id='.$pg->getID().'" METHOD="POST">
 		<input type="hidden" name="func" value="massupdate">';
 	}
 
diff -urNad gforge/www/pm/calendar.php /tmp/dpep.cr36JK/gforge/www/pm/calendar.php
--- gforge/www/pm/calendar.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/calendar.php	2005-01-21 00:09:56.000000000 +0100
@@ -15,6 +15,13 @@
 
 require_once('pre.php');
 
+$group_id = getIntFromRequest('group_id');
+$group_project_id = getIntFromRequest('group_project_id');
+$year = getIntFromRequest('year');
+$month = getIntFromRequest('month');
+$day = getIntFromRequest('day');
+$type = getStringFromRequest('type');
+
 // Some sanity checks first.
 if (isset($year) && ($year < 1990 || $year > 2020)) {
 	exit_error($Language->getText("calendar", "invalidyear"),
diff -urNad gforge/www/pm/deletetask.php /tmp/dpep.cr36JK/gforge/www/pm/deletetask.php
--- gforge/www/pm/deletetask.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/deletetask.php	2005-01-21 00:09:56.000000000 +0100
@@ -16,11 +16,14 @@
 	Total rewrite in OO and GForge coding guidelines 12/2002 by Tim Perdue
 */
 
+$group_id = getIntFromRequest('group_id');
+$group_project_id = getIntFromRequest('group_project_id');
+
 pm_header(array('title'=>$Language->getText('pm_deletetask','title'),'group_project_id'=>$group_project_id));
 
 ?>
 
-<form action="<?php echo "$PHP_SELF?group_id=$group_id&amp;group_project_id=$group_project_id"; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF')."?group_id=$group_id&amp;group_project_id=$group_project_id"; ?>" method="post">
 <input type="hidden" name="func" value="postdeletetask" />
 <input type="hidden" name="project_task_id" value="<?php echo $project_task_id; ?>" />
 
diff -urNad gforge/www/pm/detail_task.php /tmp/dpep.cr36JK/gforge/www/pm/detail_task.php
--- gforge/www/pm/detail_task.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/detail_task.php	2005-01-21 00:09:56.000000000 +0100
@@ -16,6 +16,8 @@
 	Total rewrite in OO and GForge coding guidelines 12/2002 by Tim Perdue
 */
 
+$group_project_id = getIntFromRequest('group_project_id');
+
 pm_header(array('title'=>$Language->getText('pm_detailtask','title'),'pagename'=>'pm_detailtask','group_project_id'=>$group_project_id));
 
 ?>
diff -urNad gforge/www/pm/ganttpage.php /tmp/dpep.cr36JK/gforge/www/pm/ganttpage.php
--- gforge/www/pm/ganttpage.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/ganttpage.php	2005-01-21 00:09:56.000000000 +0100
@@ -154,7 +154,7 @@
 		</script>
 		<?php
 
-echo '	<form action="'. $PHP_SELF .'?group_id='.$group_id.'&amp;group_project_id='.$group_project_id.'&amp;func=ganttpage" method="post">
+echo '	<form action="'. getStringFromServer('PHP_SELF') .'?group_id='.$group_id.'&amp;group_project_id='.$group_project_id.'&amp;func=ganttpage" method="post">
 	<table width="10%" border="0">
 	<tr>
 		<td><font size="-1">'.$Language->getText('pm_ganttpage','assignee').':<br />'. $tech_box .'</font></td>
@@ -166,7 +166,7 @@
 		<td><font size="-1"><input type="submit" name="submit" value="'.$Language->getText('general','browse').'" /></font></td>
 	</tr></table></form>';
 
-echo '<img src="'. $PHP_SELF .
+echo '<img src="'. getStringFromServer('PHP_SELF') .
 		'?func=ganttchart&amp;group_id='.$group_id.
 		'&amp;group_project_id='.$group_project_id.
 		'&amp;_assigned_to='.$_assigned_to.
diff -urNad gforge/www/pm/include/ProjectGroupHTML.class /tmp/dpep.cr36JK/gforge/www/pm/include/ProjectGroupHTML.class
--- gforge/www/pm/include/ProjectGroupHTML.class	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/include/ProjectGroupHTML.class	2005-01-21 00:09:56.000000000 +0100
@@ -19,7 +19,8 @@
 require_once('common/pm/ProjectGroup.class');
 
 function pm_header($params) {
-	global $group_id,$is_pm_page,$words,$group_project_id,$HTML,$DOCUMENT_ROOT,$order,$pg,$Language,$sys_use_pm;
+	// XXX ogi: What to do with these?
+	global $group_id,$is_pm_page,$words,$group_project_id,$HTML,$order,$pg,$Language,$sys_use_pm;
 
 	if (!$sys_use_pm) {
 		exit_disabled();
diff -urNad gforge/www/pm/index.php /tmp/dpep.cr36JK/gforge/www/pm/index.php
--- gforge/www/pm/index.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -20,6 +20,7 @@
 require_once('www/pm/include/ProjectGroupHTML.class');
 require_once('common/pm/ProjectGroupFactory.class');
 
+$group_id = getIntFromRequest('group_id');
 if (!$group_id) {
 	exit_no_group();
 }
diff -urNad gforge/www/pm/mod_task.php /tmp/dpep.cr36JK/gforge/www/pm/mod_task.php
--- gforge/www/pm/mod_task.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/mod_task.php	2005-01-21 00:09:56.000000000 +0100
@@ -26,11 +26,14 @@
 }
 echo notepad_func();
 
-pm_header(array('title'=>$Language->getText('pm_modtask','title'),'group_project_id'=>$group_project_id));
+$group_id = getIntFromRequest('group_id');
+$group_project_id = getIntFromRequest('group_project_id');
+
+pm_header(array('title'=>$Language->getText('pm_modtask','title'),'pagename'=>'pm_modtask','group_project_id'=>$group_project_id));
 
 ?>
 
-<form action="<?php echo "$PHP_SELF?group_id=$group_id&amp;group_project_id=$group_project_id"; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF')."?group_id=$group_id&amp;group_project_id=$group_project_id"; ?>" method="post">
 <input type="hidden" name="func" value="postmodtask" />
 <input type="hidden" name="project_task_id" value="<?php echo $project_task_id; ?>" />
 
diff -urNad gforge/www/pm/reporting/index.php /tmp/dpep.cr36JK/gforge/www/pm/reporting/index.php
--- gforge/www/pm/reporting/index.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/reporting/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -27,6 +27,8 @@
 	exit_not_logged_in();
 }
 
+$group_id = getIntFromRequest('group_id');
+
 if (!$group_id) {
 	exit_no_group();
 }
@@ -73,7 +75,11 @@
 
 include_once('www/include/HTML_Graphs.php');
 
+$what = getStringFromRequest('what');
 if ($what) {
+	$period = getStringFromRequest('period');
+	$span = getStringFromRequest('span');
+
 	/*
 		Update the database
 	*/
@@ -81,6 +87,8 @@
 	$period_clause=period2sql($period,$span,"start_date");
 
 	if ($what=="aging") {
+		$start = getStringFromRequest('start');
+		$end = getStringFromRequest('end');
 
 		pm_header(array ("title"=>$Language->getText('pm_reporting','aging_report'),'pagename'=>'pm_reporting'));
 		pm_reporting_header($group_id);
diff -urNad gforge/www/pm/task.php /tmp/dpep.cr36JK/gforge/www/pm/task.php
--- gforge/www/pm/task.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/pm/task.php	2005-01-21 00:09:56.000000000 +0100
@@ -21,6 +21,32 @@
 require_once('www/pm/include/ProjectTaskHTML.class');
 require_once('common/pm/ProjectGroupFactory.class');
 
+$group_id = getIntFromRequest('group_id');
+$group_project_id = getIntFromRequest('group_project_id');
+$project_task_id = getIntFromRequest('project_task_id');
+$start_hour = getStringFromRequest('start_hour');
+$start_minute = getStringFromRequest('start_minute');
+$start_month = getStringFromRequest('start_month');
+$start_day = getStringFromRequest('start_day');
+$start_year = getStringFromRequest('start_year');
+$end_hour = getStringFromRequest('end_hour');
+$end_minute = getStringFromRequest('end_minute');
+$end_month = getStringFromRequest('end_month');
+$end_day = getStringFromRequest('end_day');
+$end_year = getStringFromRequest('end_year');
+$summary = getStringFromRequest('summary');
+$details = getStringFromRequest('details');
+$priority = getStringFromRequest('priority');
+$hours = getStringFromRequest('hours');
+$start_date = getStringFromRequest('start_date');
+$end_date = getStringFromRequest('end_date');
+$category_id = getStringFromRequest('category_id');
+$percent_complete = getStringFromRequest('percent_complete');
+$assigned_to = getStringFromRequest('assigned_to');
+$dependent_on = getStringFromRequest('dependent_on');
+$duration = getStringFromRequest('duration');
+$parent_id = getStringFromRequest('parent_id');
+
 if (!$group_id || !$group_project_id) {
 	exit_missing_param();
 }
@@ -42,7 +68,7 @@
 /*
 	Figure out which function we're dealing with here
 */
-switch ($func) {
+switch (getStringFromRequest('func')) {
 
 	//
 	//	Show blank form to add new task
@@ -67,6 +93,8 @@
 	//
 	case 'postaddtask' : {
 		if ($pg->userIsAdmin()) {
+			$add_artifact_id = getStringFromRequest('add_artifact_id');
+
 			$pt = new ProjectTask($pg);
 			if (!$pt || !is_object($pt)) {
 				exit_error('Error','Could Not Get Empty ProjectTask');
@@ -99,6 +127,8 @@
 	//
 	case 'postmodtask' : {
 		if ($pg->userIsAdmin()) {
+			$rem_artifact_id = $rem_artifact_id;
+
 			$pt = new ProjectTask($pg,$project_task_id);
 			if (!$pt || !is_object($pt)) {
 				exit_error('Error','Could Not Get ProjectTask');
@@ -127,6 +157,7 @@
 	}
 
 	case 'massupdate' : {
+		$project_task_id_list = getStringFromRequest('project_task_id_list');
 		$count=count($project_task_id_list);
 
 		if ($pg->userIsAdmin()) {
@@ -181,6 +212,8 @@
 	//
 	case 'addartifact' : {
 		if ($pg->userIsAdmin()) {
+			$add_artifact_id = getStringFromRequest('add_artifact_id');
+
 			$pt = new ProjectTask($pg,$project_task_id);
 			if (!$pt || !is_object($pt)) {
 				exit_error('Error','Could Not Get ProjectTask');
diff -urNad gforge/www/project/admin/database.php /tmp/dpep.cr36JK/gforge/www/project/admin/database.php
--- gforge/www/project/admin/database.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/admin/database.php	2005-01-21 00:09:56.000000000 +0100
@@ -38,12 +38,14 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
 session_require(array('group'=>$group_id,'admin_flags'=>'A'));
 
 $group =& group_get_object($group_id);
 exit_assert_object($group, 'Group');
 
-if ($createdb) {
+if (getStringFromRequest('createdb')) {
+	$newdbtypeid = getIntFromRequest('newdbtypeid');
 
 	//mysql takes issue with database names that have dashes in them - so strip the dashes, replace with ""
 	//e.g. free-mysql becomes freemysql (it's a workaround) 
@@ -71,7 +73,11 @@
 
 }
 
-if ($updatedbrec) {
+if (getStringFromRequest('updatedbrec')) {
+	$dbid = getIntFromRequest('dbid');
+	$pw = getStringFromRequest('pw');
+	$pwconfirm = getStringFromRequest('pwconfirm');
+	$newdbtypeid = getIntFromRequest('newdbtypeid');
 
 	if ($pw == $pwconfirm) {
 
@@ -104,7 +110,8 @@
 
 }
 
-if ($deletedbconfirm) {
+if (getStringFromRequest('deletedbconfirm')) {
+	$dbid = getIntFromRequest('dbid');
 
 	//schedule for deletion
 
@@ -125,9 +132,10 @@
 
 project_admin_header(array('title'=>$Language->getText('project_admin_database','title').'','group'=>$group_id,'pagename'=>'project_admin_database','sectionvals'=>array(group_getname($group_id))));
 
+// XXX ogi: where's deletedb defined?
 if ($deletedb == 1) {
 
-	print "<hr /><strong><div align=\"center\">".$Language->getText('project_admin_database','confirm_deletion')."[ <a href=\"".$PHP_SELF."?deletedbconfirm=1&amp;group_id=".$group_id."&amp;dbid=$dbid\">'.$Language->getText('project_admin_database','confirm_delete').'</a> ] </div></strong> <hr />";
+	print "<hr /><strong><div align=\"center\">".$Language->getText('project_admin_database','confirm_deletion')."[ <a href=\"".getStringFromServer('PHP_SELF')."?deletedbconfirm=1&amp;group_id=".$group_id."&amp;dbid=$dbid\">'.$Language->getText('project_admin_database','confirm_delete').'</a> ] </div></strong> <hr />";
 
 }
 
@@ -151,7 +159,7 @@
 		<p><em>'.$Language->getText('project_admin_database','add_new_database_info').'</em></p>
 
 		<p><strong>'.$Language->getText('project_admin_database','database_type').':</strong></p>
-		<p><form action="'.$PHP_SELF.'" method="post">
+		<p><form action="'.getStringFromServer('PHP_SELF').'" method="post">
 		<input type="hidden" name="createdb" value="1" />
 		<input type="hidden" name="group_id" value="'.$group_id.'" />
 		<select name="newdbtypeid">
@@ -211,7 +219,7 @@
 		
 		if (($row_db['state'] == 1) || ($row_db['state'] == 4) || ($row_db['state'] == 2)) {
 
-			print '<form name="dbupdate" method="post" action="'.$PHP_SELF.'?group_id='.$group_id.'">
+			print '<form name="dbupdate" method="post" action="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'">
 				     <input type="hidden" name="dbid" value="'.$row_db['dbid'].'" />
 				     <input type="hidden" name="updatedbrec" value="1" />
 				     <td><input type="text" name="pw" size="8" maxlength="16" /></td>
diff -urNad gforge/www/project/admin/editgroupinfo.php /tmp/dpep.cr36JK/gforge/www/project/admin/editgroupinfo.php
--- gforge/www/project/admin/editgroupinfo.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/admin/editgroupinfo.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,7 @@
 require_once('pre.php');
 require_once('www/project/admin/project_admin_utils.php');
 
+$group_id = getIntFromRequest('group_id');
 session_require(array('group'=>$group_id,'admin_flags'=>'A'));
 
 $group =& group_get_object($group_id);
@@ -37,8 +38,25 @@
 
 // If this was a submission, make updates
 
-if ($submit) {
-
+if (getStringFromRequest('submit')) {
+	$form_group_name = getStringFromRequest('form_group_name');
+	$form_shortdesc = getStringFromRequest('form_shortdesc');
+	$form_homepage = getStringFromRequest('form_homepage');
+	$logo_image_id = getIntFromRequest('logo_image_id');
+	$use_mail = getStringFromRequest('use_mail');
+	$use_survey = getStringFromRequest('use_survey');
+	$use_forum = getStringFromRequest('use_forum');
+	$use_pm = getStringFromRequest('use_pm');
+	$use_scm = getStringFromRequest('use_scm');
+	$use_news = getStringFromRequest('use_news');
+	$use_docman = getStringFromRequest('use_docman');
+	$use_ftp = getStringFromRequest('use_ftp');
+	$use_tracker = getStringFromRequest('use_tracker');
+	$use_frs = getStringFromRequest('use_frs');
+	$use_stats = getStringFromRequest('use_stats');
+	$new_doc_address = getStringFromRequest('new_doc_address');
+	$send_all_docs = getStringFromRequest('send_all_docs');
+  
 	$res = $group->update(
 		session_get_user(),
 		$form_group_name,
@@ -74,7 +92,7 @@
 
 project_admin_header(array('title'=>$Language->getText('project_admin_editgroupinfo','title').'','group'=>$group->getID(),'pagename'=>'project_admin_editgroupinfo','sectionvals'=>array(group_getname($group_id))));
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
 	$hookParams['group']=$group_id;
 	plugin_hook("groupisactivecheckboxpost",$hookParams);
 
@@ -95,7 +113,7 @@
 ?>
 
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <input type="hidden" name="group_id" value="<?php echo $group->getID(); ?>" />
 
 <p><?php echo $Language->getText('project_admin_editgroupinfo','group_name') ?>:
diff -urNad gforge/www/project/admin/editimages.php /tmp/dpep.cr36JK/gforge/www/project/admin/editimages.php
--- gforge/www/project/admin/editimages.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/admin/editimages.php	2005-01-21 00:09:56.000000000 +0100
@@ -36,6 +36,7 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
 session_require(array('group'=>$group_id,'admin_flags'=>'A'));
 
 function check_file_size($size) {
@@ -51,7 +52,7 @@
 	}
 }
 
-function store_file($id, $input_file, $input_file_name, $input_file_type) {
+function store_file($id, $input_file) {
 	global $group_id;
 	global $description;
 	global $feedback;
@@ -61,9 +62,10 @@
 		exit_error("Error","Invalid filename");
 	}
 
-	$dimensions = @getimagesize($input_file);
-	$size = @filesize($input_file);
-	$data = addslashes(base64_encode(fread( fopen($input_file, 'rb'), $size)));
+	$filename = $input_file['tmp_name'];
+	$dimensions = @getimagesize($filename);
+	$size = @filesize($filename);
+	$data = addslashes(base64_encode(fread( fopen($filename, 'rb'), $size)));
 	$width=$dimensions[0];
 	$height=$dimensions[1];
 
@@ -79,16 +81,16 @@
 					 width,height,upload_date,version)
 					VALUES
 					('$group_id','$description',
-					 '$data','$input_file_name',
-					 '$size','$input_file_type',
+					 '$data','".$input_file['name']."',
+					 '$size','".$input_file['type']."',
 					 '$width','$height','$curtime',1)";
 		} else {
 			$sql="	UPDATE db_images
 					SET description='$description',
 					 bin_data='$data',
-					 filename='$input_file_name',
+					 filename='".$input_file['name']."',
 					 filesize='$size',
-					 filetype='$input_file_type',
+					 filetype='".$input_file['type']."',
 					 width='$width',
 					 height='$height',
 					 upload_date='$curtime',
@@ -108,26 +110,30 @@
 	}
 }
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
+	$input_file = getUploadedFile('input_file');
+	$id = getIntFromRequest('id');
+	$description = getStringFromRequest('description');
+	$filetype = getStringFromRequest('filetype');
 
 	if (!util_check_fileupload($input_file)) {
 		exit_error("Error","Invalid filename");
 	}
 
-	if ($add) {
-		if ($input_file == "none" || $description == "") {
+	if (getStringFromRequest('add')) {
+		if (!count($input_file) || $description == "") {
 			$feedback .= $Language->getText('project_admin_editimages','required_fields');
 		} else {
 			//see if they have too many data in the system
 			$res=db_query("SELECT sum(filesize) WHERE group_id='$group_id'");
 			if (db_result($res,0,'sum') < $QUOTA) {
-				store_file(0, $input_file, $input_file_name, $input_file_type);
+				store_file(0, $input_file);
 			} else {
 				$feedback .= ' Sorry - you are over your '.$QUOTA.' quota ';
 			}
 		}
 
-	} else if ($remove) {
+	} else if (getStringFromRequest('remove')) {
 
 		$res=db_query("DELETE FROM db_images WHERE id='$id' AND group_id='$group_id'");
 
@@ -142,7 +148,7 @@
 		if ($description == "") {
 			$feedback .= $Language->getText('project_admin_editimages','file_description_required').'<b />';
 		} else {
-			if ($input_file=="none" || $input_file=="") {
+			if (!count($input_file)) {
 
 				// Just replace description/mime type
 
@@ -170,10 +176,10 @@
 						WHERE group_id='$group_id'
 						AND id<>'$id'");
 
-				$size = @filesize($input_file);
+				$size = @filesize($input_file['tmp_name']);
 				if (db_result($res,0,'sum')+$size < $QUOTA) {
 
-					store_file($id, $input_file, $input_file_name, $input_file_type);
+					store_file($id, $input_file);
 
 				} else {
 
@@ -207,7 +213,7 @@
 
 	echo '</p><h4>'.$Language->getText('project_admin_editimages','title').'</h4>
 	<p>
-	<form action="'. $PHP_SELF .'" method="post" enctype="multipart/form-data">
+	<form action="'. getStringFromServer('PHP_SELF') .'" method="post" enctype="multipart/form-data">
 	<input type="hidden" name="group_id" value="'.$group_id.'" />
 	<input type="hidden" name="id" value="'.$id.'" />
 
@@ -236,7 +242,7 @@
 
 	echo '<h4>'.$Language->getText('project_admin_editimages','add_data').'</h4>
 	<p>
-	<form action="'. $PHP_SELF .'" method="post" enctype="multipart/form-data">
+	<form action="'. getStringFromServer('PHP_SELF') .'" method="post" enctype="multipart/form-data">
 	<input type="hidden" name="group_id" value="'.$group_id.'" />
 	<strong>'.$Language->getText('project_admin_editimages','local_filename').':</strong>'.utils_requiredField().'<br />
 	<input type="file" name="input_file" size="30" />
@@ -276,10 +282,10 @@
 	echo '
 	<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'>'
 	.'<td align="center">'
-	 .'<a href="'. $PHP_SELF .'?submit=1&amp;group_id='.$group_id.'&amp;remove=1&amp;id='
+	 .'<a href="'. getStringFromServer('PHP_SELF') .'?submit=1&amp;group_id='.$group_id.'&amp;remove=1&amp;id='
 	 .db_result($result,$i,'id').'">'
 	 .'['.$Language->getText('project_admin_editimages','del').']'.'</a>'
-	 .'<a href="'. $PHP_SELF .'?submit=1&amp;group_id='.$group_id.'&amp;mode=edit&amp;id='
+	 .'<a href="'. getStringFromServer('PHP_SELF') .'?submit=1&amp;group_id='.$group_id.'&amp;mode=edit&amp;id='
 	 .db_result($result,$i,'id').'"> '
 	 .'['.$Language->getText('project_admin_editimages','edit').']'.'</a>'
 	.'</td>'
diff -urNad gforge/www/project/admin/group_trove.php /tmp/dpep.cr36JK/gforge/www/project/admin/group_trove.php
--- gforge/www/project/admin/group_trove.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/admin/group_trove.php	2005-01-21 00:09:56.000000000 +0100
@@ -31,15 +31,17 @@
 require_once('trove.php');
 require_once('www/project/admin/project_admin_utils.php');
 
+$group_id = getIntFromRequest('group_id');
 session_require(array('group'=>$group_id,'admin_flags'=>'A'));
 
 // Check for submission. If so, make changes and redirect
 
-if ($GLOBALS['submit'] && $root1) {
+if (getStringFromRequest('submit') && getStringFromRequest('root1')) {
+	// XXX ogi: What's $rm_id?
 	group_add_history ('Changed Trove',$rm_id,$group_id);
 
 	// there is at least a $root1[xxx]
-	while (list($rootnode,$value) = each($root1)) {
+	while (list($rootnode,$value) = each(getStringFromRequest('root1'))) {
 		// check for array, then clear each root node for group
 		db_query("
 			DELETE FROM trove_group_link
@@ -50,8 +52,9 @@
 		for ($i=1;$i<=$GLOBALS['TROVE_MAXPERROOT'];$i++) {
 			$varname = 'root'.$i;
 			// check to see if exists first, then insert into DB
-			if (${$varname}[$rootnode]) {
-				trove_setnode($group_id,${$varname}[$rootnode],$rootnode);
+			$category = getStringFromRequest($varname) [$rootnode];
+			if ($category) {
+				trove_setnode($group_id,$category,$rootnode);
 			}
 		}
 	}
@@ -63,7 +66,7 @@
 ?>
 <?php echo $Language->getText('project_admin_group_trove','intro') ?>
 
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 
 <?php
 
diff -urNad gforge/www/project/admin/history.php /tmp/dpep.cr36JK/gforge/www/project/admin/history.php
--- gforge/www/project/admin/history.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/admin/history.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,6 +29,7 @@
 require_once('pre.php');
 require_once('www/project/admin/project_admin_utils.php');
 
+$group_id = getIntFromRequest('group_id');
 session_require(array('group'=>$group_id,'admin_flags'=>'A'));
 
 project_admin_header(array('title'=>$Language->getText('project_admin_history','title'),'group'=>$group_id,'pagename'=>'project_admin_history','sectionvals'=>array(group_getname($group_id))));
diff -urNad gforge/www/project/admin/index.php /tmp/dpep.cr36JK/gforge/www/project/admin/index.php
--- gforge/www/project/admin/index.php	2005-01-19 22:18:50.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/admin/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -35,6 +35,7 @@
 require_once('common/include/account.php');
 require_once('common/include/GroupJoinRequest.class');
 
+$group_id = getIntFromRequest('group_id');
 session_require(array('group'=>$group_id,'admin_flags'=>'A'));
 
 // get current information
@@ -56,29 +57,34 @@
 	exit_permission_denied();
 }
 
-if ($submit) {
-	if ($adduser) {
+if (getStringFromRequest('submit')) {
+	if (getStringFromRequest('adduser')) {
 		/*
 			add user to this project
 		*/
+		$form_unix_name = getStringFromRequest('form_unix_name');
+		$role_id = getIntFromRequest('role_id');
 		if (!$group->addUser($form_unix_name,$role_id)) {
 			$feedback .= $group->getErrorMessage();
 		} else {
 			$feedback = $Language->getText('project_admin','user_added');
 		}
-	} else if ($rmuser) {
+	} else if (getStringFromRequest('rmuser')) {
 		/*
 			remove a user from this group
 		*/
+		$user_id = getIntFromRequest('user_id');
 		if (!$group->removeUser($user_id)) {
 			$feedback .= $group->getErrorMessage();
 		} else {
 			$feedback = $Language->getText('project_admin','user_removed');
 		}
-	} else if ($updateuser) {
+	} else if (getStringFromRequest('updateuser')) {
 		/*
 			Adjust User Role
 		*/
+		$user_id = getIntFromRequest('user_id');
+		$role_id = getIntFromRequest('role_id');
 		if (!$group->updateUser($user_id,$role_id)) {
 			$feedback .= 'Foo'.$group->getErrorMessage();
 		} else {
@@ -214,7 +220,7 @@
 while ($row_memb=db_fetch_array($res_memb)) {
 
 		echo '
-			<form action="'.$PHP_SELF.'" method="post">
+			<form action="'.getStringFromServer('PHP_SELF').'" method="post">
 			<input type="hidden" name="submit" value="y" />
 			<input type="hidden" name="user_id" value="'.$row_memb['user_id'].'" />
 			<input type="hidden" name="group_id" value="'. $group_id .'" />
@@ -235,7 +241,7 @@
 */
 
 ?>
-			<form action="<?php echo $PHP_SELF.'?group_id='.$group_id; ?>" method="post">
+			<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id; ?>" method="post">
 			<input type="hidden" name="submit" value="y" />
 			<tr><td><input type="text" name="form_unix_name" size="10" value="" /></td>
 			<td><?php echo role_box($group_id,'role_id',$row_memb['role_id']); ?></td>
diff -urNad gforge/www/project/admin/massadd.php /tmp/dpep.cr36JK/gforge/www/project/admin/massadd.php
--- gforge/www/project/admin/massadd.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/admin/massadd.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,6 +29,7 @@
 require_once('www/project/admin/project_admin_utils.php');
 require_once('www/include/role_utils.php');
 
+$group_id = getIntFromRequest('group_id');
 session_require(array('group'=>$group_id,'admin_flags'=>'A'));
 
 $group =& group_get_object($group_id);
@@ -45,12 +46,14 @@
 $res=db_query("SELECT user_id,user_name,lastname,firstname FROM users 
 	WHERE status='A' and type_id='1' and lastname ILIKE '$sw%' ORDER BY lastname,firstname ASC");
 
+$accumulated_ids = getStringFromRequest('accumulated_ids');
 if (!$accumulated_ids) {
 	$accumulated_ids=array();
 } else {
 	$accumulated_ids =& explode(',',$accumulated_ids);
 }
 
+$newids = getStringFromRequest('newids');
 if (count($newids) > 0) {
 	if (count($accumulated_ids) > 0) {
 		$accumulated_ids =& array_merge($accumulated_ids,$newids);
@@ -69,7 +72,7 @@
 <p>
 '.$Language->getText('project_admin','addfromlist1').'
 <p>
-<form action="'.$PHP_SELF.'?group_id='.$group_id.'" method="post">
+<form action="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'" method="post">
 <input type="hidden" name="accumulated_ids" value="'. implode(',',$accumulated_ids) .'">';
 
 $abc_array = array('A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z');
diff -urNad gforge/www/project/admin/massfinish.php /tmp/dpep.cr36JK/gforge/www/project/admin/massfinish.php
--- gforge/www/project/admin/massfinish.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/admin/massfinish.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,6 +29,7 @@
 require_once('www/project/admin/project_admin_utils.php');
 require_once('www/include/role_utils.php');
 
+$group_id = getIntFromRequest('group_id');
 session_require(array('group'=>$group_id,'admin_flags'=>'A'));
 
 $group =& group_get_object($group_id);
@@ -38,7 +39,8 @@
 	exit_error('Error',$group->getErrorMessage());
 }
 
-if ($finished) {
+if (getStringFromRequest('finished')) {
+	$addrole = getStringFromRequest('addrole');
 	$keys=array_keys($addrole);
 	for ($i=0; $i<count($keys); $i++) {
 		$group->addUser($keys[$i],$addrole[$keys[$i]]);
@@ -62,7 +64,7 @@
 <p>
 '.$Language->getText('project_admin','addfromlist2').'
 <p>
-<form action="'.$PHP_SELF.'?group_id='.$group_id.'" method="post">';
+<form action="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'" method="post">';
 
 if (!$res || db_numrows($res) < 1) {
 	echo "No Matching Users Found";
diff -urNad gforge/www/project/admin/project_admin_utils.php /tmp/dpep.cr36JK/gforge/www/project/admin/project_admin_utils.php
--- gforge/www/project/admin/project_admin_utils.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/admin/project_admin_utils.php	2005-01-21 00:09:56.000000000 +0100
@@ -33,7 +33,7 @@
 */
 
 function project_admin_header($params) {
-	global $DOCUMENT_ROOT,$group_id,$feedback,$HTML,$Language;
+	global $group_id,$feedback,$HTML,$Language;
 
 	$params['toptab']='admin';
 	$params['group']=$group_id;
diff -urNad gforge/www/project/admin/roleedit.php /tmp/dpep.cr36JK/gforge/www/project/admin/roleedit.php
--- gforge/www/project/admin/roleedit.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/admin/roleedit.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,8 +30,12 @@
 require_once('common/include/Role.class');
 require_once('common/include/RoleObserver.class');
 
+$group_id = getIntFromRequest('group_id');
 session_require(array('group'=>$group_id,'admin_flags'=>'A'));
 
+$role_id = getStringFromRequest('role_id');
+$data = getStringFromRequest('data');
+
 //
 //	The observer is a special role, which is actually
 //	just controlling the is_public/allow anon flags
@@ -46,7 +50,7 @@
 		exit_error('Error',$role->getErrorMessage());
 	}
 
-	if ($submit) {
+	if (getStringFromRequest('submit')) {
 		if (!$role->update($data)) {
 			$feedback .= $role->getErrorMessage();
 		} else {
@@ -61,7 +65,8 @@
 		exit_error('Error',$role->getErrorMessage());
 	}
 
-	if ($submit) {
+	if (getStringFromRequest('submit')) {
+		$role_name = getStringFromRequest('role_name');
 		if (!$role_id) {
 			$role_id=$role->create($role_name,$data);
 			if (!$role_id) {
diff -urNad gforge/www/project/admin/vhost.php /tmp/dpep.cr36JK/gforge/www/project/admin/vhost.php
--- gforge/www/project/admin/vhost.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/admin/vhost.php	2005-01-21 00:09:56.000000000 +0100
@@ -33,6 +33,7 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
 session_require(array('group'=>$group_id,'admin_flags'=>'A'));
 
 $group = &group_get_object($group_id);
@@ -43,7 +44,8 @@
         exit_error('ERROR',$group->getErrorMessage());
 }
 
-if ($createvhost) {
+if (getStringFromRequest('createvhost')) {
+	$vhost_name = getStringFromRequest('vhost_name');
 
 	$homedir = account_group_homedir($group->getUnixName());
 	$docdir = $homedir.'/htdocs/';
@@ -71,7 +73,8 @@
 }
 
 
-if ($deletevhost) {
+if (getStringFromRequest('deletevhost')) {
+	$vhostid = getStringFromRequest('vhostid');
 
 	//schedule for deletion
 
@@ -108,7 +111,7 @@
 <?php echo $Language->getText('project_admin_vhost','info', array($group->getUnixName(),$GLOBALS['sys_default_domain'],$GLOBALS['sys_name'],$group->getUnixName(),$GLOBALS['sys_default_domain']   )) ?>
 <p>
 
-<form name="new_vhost" action="<?php echo $PHP_SELF.'?group_id='.$group->getID().'&createvhost=1'; ?>" method="post"> 
+<form name="new_vhost" action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group->getID().'&createvhost=1'; ?>" method="post"> 
 <table border="0">
 <tr>
 	<td> <?php echo $Language->getText('project_admin_vhost','name') ?> </td>
@@ -137,7 +140,7 @@
 
 		print '	<tr>
 			<td>'.$row_db['vhost_name'].'</td>
-			<td>[ <strong><a href="'.$PHP_SELF.'?group_id='.$group->getID().'&amp;vhostid='.$row_db['vhostid'].'&amp;deletevhost=1">'.$Language->getText('project_admin_vhost','delete').'</a></strong>]
+			<td>[ <strong><a href="'.getStringFromServer('PHP_SELF').'?group_id='.$group->getID().'&amp;vhostid='.$row_db['vhostid'].'&amp;deletevhost=1">'.$Language->getText('project_admin_vhost','delete').'</a></strong>]
 			</tr>	
 		';
 
diff -urNad gforge/www/project/stats/index.php /tmp/dpep.cr36JK/gforge/www/project/stats/index.php
--- gforge/www/project/stats/index.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/project/stats/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -11,6 +11,7 @@
 require_once('common/reporting/report_utils.php');
 require_once('common/reporting/Report.class');
 
+$group_id = getIntFromRequest('group_id');
 if ( !$group_id ) {
 	exit_no_group();
 }
@@ -20,6 +21,11 @@
     exit_error($report->getErrorMessage());
 }
 
+$area = getStringFromRequest('area');
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -33,7 +39,7 @@
 ?>
 <h3><?php echo $Language->getText('reporting','project_activity_title'); ?></h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <input type="hidden" name="group_id" value="<?php echo $group_id; ?>">
 <table><tr>
 <td><strong><?php echo $Language->getText('reporting','area'); ?>:</strong><br /><?php echo report_area_box('area',$area); ?></td>
diff -urNad gforge/www/projects /tmp/dpep.cr36JK/gforge/www/projects
--- gforge/www/projects	2005-01-18 20:57:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/projects	2005-01-21 00:09:56.000000000 +0100
@@ -41,12 +41,14 @@
 if (!$group_id || !$project) {
 	exit_error("Invalid Project","Invalid Project");
 } else {
+	$subpage = getStringFromRequest('subpage');
+
 	if ($subpage == "admin") {
 //		include('www/project/admin/index.php');
 		session_redirect("/project/admin/?group_id=$group_id");
 		exit();
 	} else if ($subpage == "files" || $subpage == "download" || $subpage == "dl") {
-		if ($subpage2 == "release") {
+		if (getStringFromRequest('subpage2') == "release") {
 			session_redirect("/frs/admin/qrs.php?group_id=$group_id");
 		} else {
 			session_redirect("/frs/?group_id=$group_id");
diff -urNad gforge/www/register/projectinfo.php /tmp/dpep.cr36JK/gforge/www/register/projectinfo.php
--- gforge/www/register/projectinfo.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/register/projectinfo.php	2005-01-21 00:09:56.000000000 +0100
@@ -50,12 +50,14 @@
 
 session_require(array('isloggedin'=>'1'));
 
-if ($submit) {
-	$full_name = trim($full_name);
-	$purpose = trim($purpose);
-	$license_other = trim($license_other);
-	$description = trim($description);
-	$unix_name = strtolower($unix_name);
+if (getStringFromRequest('submit')) {
+	$full_name = trim(getStringFromRequest('full_name'));
+	$purpose = trim(getStringFromRequest('purpose'));
+	$license = trim(getStringFromRequest('license'));
+	$license_other = trim(getStringFromRequest('license_other'));
+	$description = trim(getStringFromRequest('description'));
+	$unix_name = strtolower(getStringFromRequest('unix_name'));
+	$scm = getStringFromRequest('scm');
 
 	if ($sys_use_scm && !$scm) {
 		$feedback .= $Language->getText('register','scm_not_selected');
@@ -92,7 +94,7 @@
 			exit();
 		}
 	}
-} else if ($i_disagree) {
+} else if (getStringFromRequest('i_disagree')) {
 	session_redirect("/");
 }
 
@@ -102,7 +104,7 @@
 <p><?php echo $Language->getText('register','apply_for_registration') ?>
 </p>
 
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 
 <?php echo $Language->getText('register','project_full_name') ?>
 
diff -urNad gforge/www/reporting/groupadded_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/groupadded_graph.php
--- gforge/www/reporting/groupadded_graph.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/groupadded_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,6 +32,10 @@
 
 session_require( array('group'=>$sys_stats_group) );
 
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 //
 //	Create Report
 //
diff -urNad gforge/www/reporting/groupadded.php /tmp/dpep.cr36JK/gforge/www/reporting/groupadded.php
--- gforge/www/reporting/groupadded.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/groupadded.php	2005-01-21 00:09:56.000000000 +0100
@@ -36,6 +36,10 @@
 	exit_error('Error',$report->getErrorMessage());
 }
 
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -48,7 +52,7 @@
 ?>
 <h3><?php echo $Language->getText('reporting','groups_added_title'); ?></h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <table><tr>
 <td><strong><?php echo $Language->getText('reporting','type'); ?>:</strong><br /><?php echo report_span_box('SPAN',$SPAN); ?></td>
 <td><strong><?php echo $Language->getText('reporting','start'); ?>:</strong><br /><?php echo report_months_box($report, 'start', $start); ?></td>
diff -urNad gforge/www/reporting/groupcum_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/groupcum_graph.php
--- gforge/www/reporting/groupcum_graph.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/groupcum_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,6 +32,10 @@
 
 session_require( array('group'=>$sys_stats_group) );
 
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 //
 //	Create Report
 //
diff -urNad gforge/www/reporting/groupcum.php /tmp/dpep.cr36JK/gforge/www/reporting/groupcum.php
--- gforge/www/reporting/groupcum.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/groupcum.php	2005-01-21 00:09:56.000000000 +0100
@@ -36,6 +36,10 @@
 	exit_error($report->getErrorMessage());
 }
 
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -48,7 +52,7 @@
 ?>
 <h3><?php echo $Language->getText('reporting','cumulative_groups_title'); ?></h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <table><tr>
 <td><strong><?php echo $Language->getText('reporting','type'); ?>:</strong><br /><?php echo report_span_box('SPAN',$SPAN); ?></td>
 <td><strong><?php echo $Language->getText('reporting','start'); ?>:</strong><br /><?php echo report_months_box($report, 'start', $start); ?></td>
diff -urNad gforge/www/reporting/projectact.php /tmp/dpep.cr36JK/gforge/www/reporting/projectact.php
--- gforge/www/reporting/projectact.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/projectact.php	2005-01-21 00:09:56.000000000 +0100
@@ -38,6 +38,12 @@
 	exit_error($report->getErrorMessage());
 }
 
+$g_id = getStringFromRequest('g_id');
+$area = getStringFromRequest('area');
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -49,7 +55,7 @@
 ?>
 <h3><?php echo $Language->getText('reporting','project_activity_title'); ?></h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <input type="hidden" name="sw" value="<?php echo $sw; ?>">
 <table><tr>
 <td><strong><?php echo $Language->getText('reporting','project'); ?>:</strong><br /><?php echo report_group_box('g_id',$g_id); ?></td>
diff -urNad gforge/www/reporting/projecttime_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/projecttime_graph.php
--- gforge/www/reporting/projecttime_graph.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/projecttime_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -34,6 +34,11 @@
 
 session_require( array('group'=>$sys_stats_group) );
 
+$g_id = getStringFromRequest('g_id');
+$type = getStringFromRequest('type');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 //
 //	Create Report
 //
@@ -47,6 +52,7 @@
 	exit;
 }
 
+// XXX ogi: Isn't it $type?
 if (!isset($datatype)) {
 	$datatype=1;
 }
diff -urNad gforge/www/reporting/projecttime.php /tmp/dpep.cr36JK/gforge/www/reporting/projecttime.php
--- gforge/www/reporting/projecttime.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/projecttime.php	2005-01-21 00:09:56.000000000 +0100
@@ -38,6 +38,13 @@
 	exit_error($report->getErrorMessage());
 }
 
+$sw = getStringFromRequest('sw');
+$typ = getStringFromRequest('typ');
+$g_id = getStringFromRequest('g_id');
+$typ = getStringFromRequest('typ');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -58,7 +65,7 @@
 ?>
 <h3><?php echo $Language->getText('reporting_ttbp','title'); ?></h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <input type="hidden" name="sw" value="<?php echo $sw; ?>">
 <input type="hidden" name="typ" value="<?php echo $typ; ?>">
 <table><tr>
diff -urNad gforge/www/reporting/rebuild.php /tmp/dpep.cr36JK/gforge/www/reporting/rebuild.php
--- gforge/www/reporting/rebuild.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/rebuild.php	2005-01-21 00:09:56.000000000 +0100
@@ -36,7 +36,7 @@
 
 echo report_header($Language->getText('reporting_rebuild','title'));
 
-if ($submit && $im_sure) {
+if (getStringFromRequest('submit') && getStringFromRequest('im_sure')) {
 
 	$r = new ReportSetup();
 
@@ -49,7 +49,7 @@
 }
 	echo $Language->getText('reporting_rebuild','message');
 ?>
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <input type="checkbox" name="im_sure" value="1"><?php echo $Language->getText('reporting_rebuild','imsure'); ?><p>
 <p>
 <input type="submit" name="submit" value="<?php echo $Language->getText('reporting_rebuild','pressonlyonce'); ?>">
diff -urNad gforge/www/reporting/siteact_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/siteact_graph.php
--- gforge/www/reporting/siteact_graph.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/siteact_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -33,6 +33,11 @@
 
 session_require( array('group'=>$sys_stats_group) );
 
+$area = getStringFromRequest('area');
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 //
 //	Create Report
 //
diff -urNad gforge/www/reporting/siteact.php /tmp/dpep.cr36JK/gforge/www/reporting/siteact.php
--- gforge/www/reporting/siteact.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/siteact.php	2005-01-21 00:09:56.000000000 +0100
@@ -37,6 +37,11 @@
 	exit_error($report->getErrorMessage());
 }
 
+$area = getStringFromRequest('area');
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -48,7 +53,7 @@
 ?>
 <h3><?php echo $Language->getText('reporting','site_wide_activity'); ?></h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <table><tr>
 <td><strong><?php echo $Language->getText('reporting', 'area'); ?>:</strong><br /><?php echo report_area_box('area',$area); ?></td>
 <td><strong><?php echo $Language->getText('reporting', 'type'); ?>:</strong><br /><?php echo report_span_box('SPAN',$SPAN); ?></td>
diff -urNad gforge/www/reporting/sitetimebar_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/sitetimebar_graph.php
--- gforge/www/reporting/sitetimebar_graph.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/sitetimebar_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -45,6 +45,9 @@
 	exit;
 }
 
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$start=mktime(0,0,0,date('m'),1,date('Y'));;
 }
diff -urNad gforge/www/reporting/sitetimebar.php /tmp/dpep.cr36JK/gforge/www/reporting/sitetimebar.php
--- gforge/www/reporting/sitetimebar.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/sitetimebar.php	2005-01-21 00:09:56.000000000 +0100
@@ -37,6 +37,10 @@
 	exit_error($report->getErrorMessage());
 }
 
+$typ = getStringFromRequest('typ');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -47,7 +51,7 @@
 ?>
 <h3><?php echo $Language->getText('reporting','site_wide_time_tracking'); ?></h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <input type="hidden" name="typ" value="<?php echo $typ; ?>">
 <table><tr>
 <td><strong><?php echo $Language->getText('reporting','start'); ?>:</strong><br /><?php echo report_months_box($report, 'start', $start); ?></td>
diff -urNad gforge/www/reporting/sitetime_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/sitetime_graph.php
--- gforge/www/reporting/sitetime_graph.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/sitetime_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -34,6 +34,10 @@
 
 session_require( array('group'=>$sys_stats_group) );
 
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+$type = getStringFromRequest('type');
+
 //
 //	Create Report
 //
@@ -47,6 +51,7 @@
 	exit;
 }
 
+// XXX ogi: Isn't it $type?
 if (!isset($datatype)) {
 	$datatype=1;
 }
diff -urNad gforge/www/reporting/sitetime.php /tmp/dpep.cr36JK/gforge/www/reporting/sitetime.php
--- gforge/www/reporting/sitetime.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/sitetime.php	2005-01-21 00:09:56.000000000 +0100
@@ -37,6 +37,11 @@
 	exit_error($report->getErrorMessage());
 }
 
+$typ = getStringFromRequest('typ');
+$type = getStringFromRequest('type');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -57,7 +62,7 @@
 ?>
 <h3><?php echo $Language->getText('reporting','site_wide_time_tracking'); ?></h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <input type="hidden" name="typ" value="<?php echo $typ; ?>">
 <table><tr>
 <td><strong><?php echo $Language->getText('reporting', 'type'); ?>:</strong><br /><?php echo html_build_select_box_from_arrays($a2,$a,'type',$type,false); ?></td>
diff -urNad gforge/www/reporting/timeadd.php /tmp/dpep.cr36JK/gforge/www/reporting/timeadd.php
--- gforge/www/reporting/timeadd.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/timeadd.php	2005-01-21 00:09:56.000000000 +0100
@@ -40,9 +40,17 @@
 	exit_error('Error',$report->getErrorMessage());
 }
 
-if ($submit) {
+$week = getStringFromRequest('week');
+$project_task_id = getStringFromRequest('project_task_id');
+
+if (getStringFromRequest('submit')) {
+	$report_date = getStringFromRequest('report_date');
+	$time_code = getStringFromRequest('time_code');
+	$old_time_code = getStringFromRequest('old_time_code');
+	$hours = getStringFromRequest('hours');
+	
 /*
-	if ($update) {
+	if (getStringFromRequest('update')) {
 		
 		if ($project_task_id && $report_date && $time_code) {
 			$res=db_query("UPDATE rep_time_tracking 
@@ -60,8 +68,7 @@
 
 	} else
 */
-	if ($delete) {
-
+	if (getStringFromRequest('delete')) {
 		if ($project_task_id && $report_date && $old_time_code) {
 			$res=db_query("DELETE FROM rep_time_tracking 
 				WHERE user_id='".user_getid()."'
@@ -77,7 +84,9 @@
 			echo "$project_task_id && $report_date && $old_time_code";
 		}
 
-	} elseif ($add) {
+	} elseif (getStringFromRequest('add')) {
+		$days_adjust = getStringFromRequest('days_adjust');
+
 		if ($project_task_id && $week && $days_adjust && $time_code && $hours) {
 
 			//$date_list = split('[- :]',$report_date,5);
@@ -100,6 +109,7 @@
 }
 
 if ($week) {
+	$group_project_id = getStringFromRequest('group_project_id');
 
 	report_header($Language->getText('reporting_ta','title'));
 
@@ -138,7 +148,7 @@
 		echo $HTML->listTableTop ($title_arr);
 
 		while ($r=&db_fetch_array($res)) {
-			echo '<form action="'.$PHP_SELF.'?week='.$week.'&project_task_id='.$r['project_task_id'].'" method="post" />
+			echo '<form action="'.getStringFromServer('PHP_SELF').'?week='.$week.'&project_task_id='.$r['project_task_id'].'" method="post" />
 			<input type="hidden" name="submit" value="1" />
 			<input type="hidden" name="report_date" value="'.$r['report_date'] .'" />
 			<input type="hidden" name="old_time_code" value="'.$r['time_code'] .'" />
@@ -156,7 +166,7 @@
 
 			$respt=db_query("SELECT project_task_id,summary FROM project_task WHERE group_project_id='$group_project_id'");
 
-			echo '<form action="'.$PHP_SELF.'?week='.$week.'" method="post" />
+			echo '<form action="'.getStringFromServer('PHP_SELF').'?week='.$week.'" method="post" />
 			<input type="hidden" name="submit" value="1" />
 			<tr '.$HTML->boxGetAltRowStyle($xi++).'>
 				<td align="middle">'. html_build_select_box ($respt,'project_task_id',false,false) .'</td>
@@ -179,7 +189,7 @@
 		<p>
 		<?php echo $Language->getText('reporting_ta','add_entry_description'); ?>
 		<p>
-		<form action="<?php echo $PHP_SELF; ?>" method="get" />
+		<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get" />
 		<input type="hidden" name="week" value="<?php echo $week; ?>" />
 		<table>
 		<tr>
@@ -192,7 +202,7 @@
 		<p>
 		<h3>Change Week</h3>
 		<p>
-		<form action="<?php echo $PHP_SELF; ?>" method="get" />
+		<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get" />
 		<?php echo report_weeks_box($report,'week'); ?><input type="submit" name="submit" value="<?php echo $Language->getText('reporting_ta','change_week'); ?>" />
 		</form>
 		<?php
@@ -209,7 +219,7 @@
 	<p>
 	<?php echo $Language->getText('reporting_ta','choose_entry_description'); ?>
 	<p>
-	<form action="<?php echo $PHP_SELF; ?>" method="get" />
+	<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get" />
 	<strong><?php echo $Language->getText('reporting_ta','week_starting'); ?>:</strong><br />
 	<?php echo report_weeks_box($report,'week'); ?>
 	<p>
diff -urNad gforge/www/reporting/timecategory.php /tmp/dpep.cr36JK/gforge/www/reporting/timecategory.php
--- gforge/www/reporting/timecategory.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/timecategory.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,17 +32,20 @@
 session_require( array('group'=>$sys_stats_group,'A') );
 global $Language;
 
-if ($submit) {
-	if ($add) {
+$time_code = getStringFromRequest('time_code');
+$category_name = getStringFromRequest('category_name');
+
+if (getStringFromRequest('submit')) {
+	if (getStringFromRequest('add')) {
 
 		$r = new ReportSetup();
-		if (!$r->addTimeCode($category_name)) {
+		if (!$r->addTimeCode($category_name))) {
 			exit_error('Error',$r->getErrorMessage());
 		} else {
 			$feedback=$Language->getText('reporting_tc','successful');
 		}
 
-	} elseif ($update) {
+	} elseif (getStringFromRequest('update')) {
 
 		$r = new ReportSetup();
 
@@ -83,7 +86,7 @@
 <p>
 <?php echo $Language->getText('reporting_tc','description'); ?>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <input type="hidden" name="submit" value="1" />
 <input type="hidden" name="time_code" value="<?php echo $time_code; ?>" />
 <strong><?php echo $Language->getText('reporting_tc','category_name'); ?>:</strong><br />
diff -urNad gforge/www/reporting/toolspie_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/toolspie_graph.php
--- gforge/www/reporting/toolspie_graph.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/toolspie_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -47,6 +47,10 @@
 	exit;
 }
 
+$datatype = getIntFromRequest('datatype');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!isset($datatype)) {
 	$datatype=1;
 }
diff -urNad gforge/www/reporting/toolspie.php /tmp/dpep.cr36JK/gforge/www/reporting/toolspie.php
--- gforge/www/reporting/toolspie.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/toolspie.php	2005-01-21 00:09:56.000000000 +0100
@@ -45,6 +45,10 @@
 
 echo report_header($Language->getText('reporting_pie','title'));
 
+$datatype = getStringFromRequest('datatype');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!isset($datatype)) {
 	$datatype=1;
 }
@@ -52,7 +56,7 @@
 ?>
 <h3><?php echo $Language->getText('reporting_pie','title'); ?></h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <table><tr>
 <td><strong><?php echo $Language->getText('reporting_pie','trackers'); ?>:</strong><br /><?php echo report_tracker_box('datatype',$datatype); ?></td>
 <td><strong><?php echo $Language->getText('reporting_pie','start'); ?>:</strong><br /><?php echo report_months_box($report, 'start', $start); ?></td>
diff -urNad gforge/www/reporting/trackerpie_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/trackerpie_graph.php
--- gforge/www/reporting/trackerpie_graph.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/trackerpie_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -48,6 +48,10 @@
 	exit;
 }
 
+$area = getStringFromRequest('area');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!isset($area)) {
 	$area='category';
 }
diff -urNad gforge/www/reporting/useract_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/useract_graph.php
--- gforge/www/reporting/useract_graph.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/useract_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -33,6 +33,11 @@
 
 session_require( array('group'=>$sys_stats_group) );
 
+$dev_id = getStringFromRequest('dev_id');
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 //
 //	Create Report
 //
diff -urNad gforge/www/reporting/useract.php /tmp/dpep.cr36JK/gforge/www/reporting/useract.php
--- gforge/www/reporting/useract.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/useract.php	2005-01-21 00:09:56.000000000 +0100
@@ -38,6 +38,13 @@
 	exit_error($report->getErrorMessage());
 }
 
+$sw = getStringFromRequest('sw');
+$dev_id = getStringFromRequest('dev_id');
+$area = getStringFromRequest('area');
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -59,7 +66,7 @@
 	?>
 	<h3><?php echo $Language->getText('reporting','user_activity_title'); ?></h3>
 	<p>
-	<form action="<?php echo $PHP_SELF; ?>" method="get">
+	<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 	<input type="hidden" name="sw" value="<?php echo $sw; ?>">
 	<table><tr>
 	<td><strong><?php echo $Language->getText('reporting','user'); ?>:</strong><br /><?php echo report_useract_box('dev_id',$dev_id,$sw); ?></td>
diff -urNad gforge/www/reporting/useradded_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/useradded_graph.php
--- gforge/www/reporting/useradded_graph.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/useradded_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,6 +32,10 @@
 
 session_require( array('group'=>$sys_stats_group) );
 
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 //
 //	Create Report
 //
diff -urNad gforge/www/reporting/useradded.php /tmp/dpep.cr36JK/gforge/www/reporting/useradded.php
--- gforge/www/reporting/useradded.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/useradded.php	2005-01-21 00:09:56.000000000 +0100
@@ -36,6 +36,10 @@
 	exit_error('Error',$report->getErrorMessage());
 }
 
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -48,7 +52,7 @@
 ?>
 <h3><?php echo $Language->getText('reporting','users_added_title'); ?></h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <table><tr>
 <td><strong><?php echo $Language->getText('reporting','type'); ?>:</strong><br /><?php echo report_span_box('SPAN',$SPAN); ?></td>
 <td><strong><?php echo $Language->getText('reporting','start'); ?>:</strong><br /><?php echo report_months_box($report, 'start', $start); ?></td>
diff -urNad gforge/www/reporting/usercum_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/usercum_graph.php
--- gforge/www/reporting/usercum_graph.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/usercum_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,6 +32,10 @@
 
 session_require( array('group'=>$sys_stats_group) );
 
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 //
 //	Create Report
 //
diff -urNad gforge/www/reporting/usercum.php /tmp/dpep.cr36JK/gforge/www/reporting/usercum.php
--- gforge/www/reporting/usercum.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/usercum.php	2005-01-21 00:09:56.000000000 +0100
@@ -36,6 +36,10 @@
 	exit_error($report->getErrorMessage());
 }
 
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -48,7 +52,7 @@
 ?>
 <h3><?php echo $Language->getText('reporting','cumulative_users_title'); ?></h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <table><tr>
 <td><strong><?php echo $Language->getText('reporting','type'); ?>:</strong><br /><?php echo report_span_box('SPAN',$SPAN); ?></td>
 <td><strong><?php echo $Language->getText('reporting','start'); ?>:</strong><br /><?php echo report_months_box($report, 'start', $start); ?></td>
diff -urNad gforge/www/reporting/usersummary.php /tmp/dpep.cr36JK/gforge/www/reporting/usersummary.php
--- gforge/www/reporting/usersummary.php	2005-01-19 22:18:51.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/usersummary.php	2005-01-21 00:09:56.000000000 +0100
@@ -38,6 +38,10 @@
 	exit_error($report->getErrorMessage());
 }
 
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+$tstat = getStringFromRequest('tstat');
+
 if (!$start) {
 	$z =& $report->getWeekStartArr();
 	$start = $z[count($z)-1];
@@ -64,7 +68,7 @@
 	<p>
 	<?php echo $Language->getText('reporting_us','description'); ?>
 	<p>
-    <form action="<?php echo $PHP_SELF; ?>" method="get">
+    <form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
     <table><tr>
     <td><strong><?php echo $Language->getText('reporting','start'); ?>:</strong><br /><?php echo report_weeks_box($report, 'start', $start); ?></td>
     <td><strong><?php echo $Language->getText('reporting','end'); ?>:</strong><br /><?php echo report_weeks_box($report, 'end', $end); ?></td>
diff -urNad gforge/www/reporting/usertime_graph.php /tmp/dpep.cr36JK/gforge/www/reporting/usertime_graph.php
--- gforge/www/reporting/usertime_graph.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/usertime_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -34,6 +34,11 @@
 
 session_require( array('group'=>$sys_stats_group) );
 
+$dev_id = getStringFromRequest('dev_id');
+$type = getStringFromRequest('type');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 //
 //	Create Report
 //
@@ -47,6 +52,7 @@
 	exit;
 }
 
+// XXX ogi: Isn't it $type?
 if (!isset($datatype)) {
 	$datatype=1;
 }
diff -urNad gforge/www/reporting/usertime.php /tmp/dpep.cr36JK/gforge/www/reporting/usertime.php
--- gforge/www/reporting/usertime.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/reporting/usertime.php	2005-01-21 00:09:56.000000000 +0100
@@ -38,6 +38,13 @@
 	exit_error($report->getErrorMessage());
 }
 
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+$sw = getStringFromRequest('sw');
+$typ = getStringFromRequest('typ');
+$dev_id = getStringFromRequest('dev_id');
+$type = getStringFromRequest('type');
+
 if (!$start) {
 	$z =& $report->getMonthStartArr();
 	$start = $z[count($z)-1];
@@ -70,7 +77,7 @@
 	?>
 	<h3><?php echo $Language->getText('reporting_ut','title'); ?></h3>
 	<p>
-	<form action="<?php echo $PHP_SELF; ?>" method="get">
+	<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 	<input type="hidden" name="sw" value="<?php echo $sw; ?>">
 	<input type="hidden" name="typ" value="<?php echo $typ; ?>">
 	<table><tr>
diff -urNad gforge/www/scm/admin/index.php /tmp/dpep.cr36JK/gforge/www/scm/admin/index.php
--- gforge/www/scm/admin/index.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/scm/admin/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -31,15 +31,15 @@
 // Check permissions
 session_require(array('group'=>$group_id,'admin_flags'=>'A'));
 
-scm_header(array('title'=>$Language->getText('scm_index','scm_repository'),'group'=>$group_id));
-
+$group_id = getIntFromRequest('group_id');
 
+scm_header(array('title'=>$Language->getText('scm_index','scm_repository'),'group'=>$group_id));
 
-if ($submit) {
+if (getStringFromRequest('submit')) {
 	$hook_params = array () ;
 	$hook_params['group_id'] = $group_id ;
-	$scmvars = array_keys ($_GET) ;
-	foreach ($_GET as $key => $value) {
+	$scmvars = array_keys (_getRequestArray()) ;
+	foreach (_getRequestArray() as $key => $value) {
 		foreach ($scm_list as $scm) {
 			if ($key == strstr($key, $scm . "_")) {
 				$hook_params[$key] = $value ;
@@ -51,7 +51,7 @@
 }
 
 ?>
-<form action="<?php echo $PHP_SELF; ?>">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>">
 <?php
 
 	$hook_params = array () ;
diff -urNad gforge/www/scm/include/scm_utils.php /tmp/dpep.cr36JK/gforge/www/scm/include/scm_utils.php
--- gforge/www/scm/include/scm_utils.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/scm/include/scm_utils.php	2005-01-21 00:09:56.000000000 +0100
@@ -26,7 +26,7 @@
  */
 
 function scm_header($params) {
-	global $DOCUMENT_ROOT, $HTML, $Language, $sys_use_scm;
+	global $HTML, $Language, $sys_use_scm;
 	if (!$sys_use_scm) {
 		exit_disabled();
 	}
diff -urNad gforge/www/search/advanced_search.php /tmp/dpep.cr36JK/gforge/www/search/advanced_search.php
--- gforge/www/search/advanced_search.php	2004-12-15 22:26:22.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/search/advanced_search.php	2005-01-21 00:09:56.000000000 +0100
@@ -14,6 +14,7 @@
 require_once('common/include/escapingUtils.php');
 require_once('include/renderers/AdvancedSearchHtmlSearchRenderer.class');
 
+$group_id = getIntFromRequest('group_id');
 $offset = getIntFromRequest('offset');
 $words = getStringFromRequest('words');
 $mode = getStringFromRequest('mode', SEARCH__MODE_AND);
@@ -24,7 +25,7 @@
 	$exact = false;
 }
 
-if (!isset($search)) { 
+if (!getStringFromRequest('search')) { 
 	$searchQuery = new AdvancedSearchHtmlSearchRenderer($words, $offset, true, $group_id);
 	//just display the header and footer if search is not set
 	$searchQuery->writeHeader();
diff -urNad gforge/www/search/index.php /tmp/dpep.cr36JK/gforge/www/search/index.php
--- gforge/www/search/index.php	2004-10-16 18:38:52.000000000 +0200
+++ /tmp/dpep.cr36JK/gforge/www/search/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -11,26 +11,36 @@
  * @version $Id$
  */
 
+
+require_once('pre.php');
+require_once('www/tracker/include/ArtifactTypeHtml.class');
+require_once ('www/search/include/SearchManager.class');
+
+$group_id = getIntFromRequest('group_id');
+$atid = getIntFromRequest('atid');
+$forum_id = getIntFromRequest('forum_id');
+$group_project_id = getIntFromRequest('group_project_id');
+
+$words = getStringFromRequest('words');
+$type_of_search = getStringFromRequest('type_of_search');
+$exact = getStringFromRequest('exact');
+
 // Support for short aliases
 
 if (!$words) {
-	$words = $q;
+	$words = getStringFromRequest('q');
 }
 
 if (!$type_of_search) {
-	$type_of_search = $type;
+	$type_of_search = getStringFromRequest('type');
 }
 if (!$type_of_search) {
-	$type_of_search = $t;
+	$type_of_search = getStringFromRequest('t');
 }
 if (!$type_of_search) {
 	$type_of_search = SEARCH__TYPE_IS_SOFTWARE;
 }
 
-require_once('pre.php');
-require_once('www/tracker/include/ArtifactTypeHtml.class');
-require_once ('www/search/include/SearchManager.class');
-
 $offset = getIntFromGet('offset');
 
 $searchManager =& getSearchManager();
@@ -44,7 +54,7 @@
 
 $searchManager->setParametersValues($parameters);
 
-if($rss) {
+if (getStringFromRequest('rss')) {
 	$outputFormat = SEARCH__OUTPUT_RSS;
 } else {
 	$outputFormat = SEARCH__OUTPUT_HTML;
@@ -52,7 +62,7 @@
 
 $renderer = $searchManager->getSearchRenderer($type_of_search, $words, $offset, $exact, $outputFormat);
 
-if($renderer) {
+if ($renderer) {
 	$renderer->flush();
 } else {
 	$HTML->header(array('title'=>$Language->getText('search', 'title'), 'pagename'=>'search'));
diff -urNad gforge/www/sendmessage.php /tmp/dpep.cr36JK/gforge/www/sendmessage.php
--- gforge/www/sendmessage.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/sendmessage.php	2005-01-21 00:09:56.000000000 +0100
@@ -27,6 +27,9 @@
 
 require_once('pre.php');
 
+$toaddress = getStringFromRequest('toaddress');
+$touser = getStringFromRequest('touser');
+
 if (!$toaddress && !$touser) {
 	exit_error($Language->getText('general','error'),$Language->getText('sendmessage','error_variables'));
 }
@@ -47,7 +50,12 @@
 }
 
 
-if ($send_mail) {
+if (getStringFromRequest('send_mail')) {
+	$subject = getStringFromRequest('subject');
+	$body = getStringFromRequest('body');
+	$name = getStringFromRequest('name');
+	$email = getStringFromRequest('email');
+
 	if (!$subject || !$body || !$name || !$email) {
 		/*
 			force them to enter all vars
@@ -99,7 +107,7 @@
 <p />
 <?php echo $Language->getText('sendmessage', 'about_blurb'); ?>
 <p />
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <input type="hidden" name="toaddress" value="<?php echo $toaddress; ?>" />
 <input type="hidden" name="touser" value="<?php echo $touser; ?>" />
 
diff -urNad gforge/www/snapshots.php /tmp/dpep.cr36JK/gforge/www/snapshots.php
--- gforge/www/snapshots.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/snapshots.php	2005-01-21 00:09:56.000000000 +0100
@@ -22,6 +22,8 @@
 
 session_require(array('group'=>$group_id));
 
+$group_id = getIntFromRequest('group_id');
+
 // get current information
 $group =& group_get_object($group_id);
 exit_assert_object($group,'Group');
diff -urNad gforge/www/snippet/add_snippet_to_package.php /tmp/dpep.cr36JK/gforge/www/snippet/add_snippet_to_package.php
--- gforge/www/snippet/add_snippet_to_package.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/snippet/add_snippet_to_package.php	2005-01-21 00:09:56.000000000 +0100
@@ -15,6 +15,8 @@
 require_once('pre.php');
 require_once('www/snippet/snippet_utils.php');
 
+$suppress_nav = getStringFromRequest('suppress_nav');
+
 function handle_add_exit() {
 	global $suppress_nav;
         if ($suppress_nav) {
@@ -27,6 +29,8 @@
 }
 
 if (session_loggedin()) {
+	$snippet_package_version_id = getIntFromRequest('snippet_package_version_id');
+	$snippet_version_id = getIntFromRequest('snippet_version_id');
 
 	if ($suppress_nav) {
 		echo '
@@ -42,7 +46,7 @@
 		handle_add_exit();
 	}
 
-	if ($post_changes) {
+	if (getStringFromRequest('post_changes')) {
 		/*
 			Create a new snippet entry, then create a new snippet version entry
 		*/
@@ -112,7 +116,7 @@
 	<?php echo db_result($result,0,'name') . ' -  ' . db_result($result,0,'version'); ?></p>
 	<p><?php echo $Language->getText('add_snippet','you_can_use_this_form'); ?></p>
 	<p>
-	<form action="<?php echo $PHP_SELF; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 	<input type="hidden" name="post_changes" value="y" />
 	<input type="hidden" name="snippet_package_version_id" value="<?php echo $snippet_package_version_id; ?>" />
 	<input type="hidden" name="suppress_nav" value="<?php echo $suppress_nav; ?>" />
diff -urNad gforge/www/snippet/addversion.php /tmp/dpep.cr36JK/gforge/www/snippet/addversion.php
--- gforge/www/snippet/addversion.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/snippet/addversion.php	2005-01-21 00:09:56.000000000 +0100
@@ -16,6 +16,9 @@
 require_once('www/snippet/snippet_utils.php');
 
 if (session_loggedin()) {
+	$type = getStringFromRequest('type');
+	$id = getIntFromRequest('id');
+
 	if ($type=='snippet') {
 		/*
 			See if the snippet exists first
@@ -28,7 +31,11 @@
 		/*
 			handle inserting a new version of a snippet
 		*/
-		if ($post_changes) {
+		if (getStringFromRequest('post_changes')) {
+			$changes = getStringFromRequest('changes');
+			$version = getStringFromRequest('version');
+			$code = getStringFromRequest('code');
+
 			/*
 				Create a new snippet entry, then create a new snippet version entry
 			*/
@@ -58,7 +65,7 @@
 		?>
 		<p><?php echo $Language->getText('snippet_addversion','if_you_have_modified_a_version'); ?></p>
 		<p>
-		<form action="<?php echo $PHP_SELF; ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 		<input type="hidden" name="post_changes" value="y" />
 		<input type="hidden" name="type" value="snippet" />
 		<input type="hidden" name="snippet_id" value="<?php echo $id; ?>" />
@@ -100,7 +107,11 @@
 			exit_error($Language->getText('snippet_addversion','error_snippet_package_doesnt_exist'));
 		}
 
-		if ($post_changes) {
+		if (getStringFromRequest('post_changes')) {
+			$snippet_package_id = getIntFromRequest('snippet_package_id');
+			$changes = getStringFromRequest('changes');
+			$version = getStringFromRequest('version');
+
 			/*
 				Create a new snippet entry, then create a new snippet version entry
 			*/
@@ -172,7 +183,7 @@
 		<p>
 		<?php echo $Language->getText('snippet_addversion','if_you_have_modified'); ?></p>
 		<p>
-		<form action="<?php echo $PHP_SELF; ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 		<input type="hidden" name="post_changes" value="y" />
 		<input type="hidden" name="type" value="package" />
 		<input type="hidden" name="snippet_package_id" value="<?php echo $id; ?>" />
diff -urNad gforge/www/snippet/browse.php /tmp/dpep.cr36JK/gforge/www/snippet/browse.php
--- gforge/www/snippet/browse.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/snippet/browse.php	2005-01-21 00:09:56.000000000 +0100
@@ -34,11 +34,15 @@
 
 snippet_header(array('title'=>$Language->getText('snippet_browse','title'), 'header'=>'','pagename'=>'snippet_browse'));
 
+$by = $by;
+
 if ($by=='lang') {
+	$lang = getStringFromRequest('lang');
 	$sql=createSnippetQuery("snippet.language='$lang'");
 	$sql2=createPackageQuery("snippet_package.language='$lang'");
 	echo '<h2>' .$Language->getText('snippet_browse','snippets_by_language', array($SCRIPT_LANGUAGE[$lang])).'</h2>';
 } else if ($by=='cat') {
+	$cat = getStringFromRequest('cat');
 	$sql=createSnippetQuery("snippet.category='$cat'");
 	$sql2=createPackageQuery("snippet_package.category='$cat'");
 	echo '<h2>' .$Language->getText('snippet_browse','snippet_by_category', array($SCRIPT_CATEGORY[$cat])).'</h2>';
diff -urNad gforge/www/snippet/delete.php /tmp/dpep.cr36JK/gforge/www/snippet/delete.php
--- gforge/www/snippet/delete.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/snippet/delete.php	2005-01-21 00:09:56.000000000 +0100
@@ -22,6 +22,9 @@
 
 if (session_loggedin()) {
 	snippet_header(array('title'=>'Delete Snippets','pagename'=>'snippet_delete'));
+	$type = getStringFromRequest('type');
+	$snippet_version_id = getIntFromRequest('snippet_version_id');
+	$snippet_package_version_id = getIntFromRequest('snippet_package_version_id');
 
 	if ($type=='frompackage' && $snippet_version_id && $snippet_package_version_id) {
 		/*
diff -urNad gforge/www/snippet/detail.php /tmp/dpep.cr36JK/gforge/www/snippet/detail.php
--- gforge/www/snippet/detail.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/snippet/detail.php	2005-01-21 00:09:56.000000000 +0100
@@ -20,6 +20,9 @@
 	or a specific version of a package
 */
 
+$type = getStringFromRequest('type');
+$id = getIntFromRequest('id');
+
 if ($type=='snippet') {
 	/*
 		View a snippet and show its versions
diff -urNad gforge/www/snippet/download.php /tmp/dpep.cr36JK/gforge/www/snippet/download.php
--- gforge/www/snippet/download.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/snippet/download.php	2005-01-21 00:09:56.000000000 +0100
@@ -15,6 +15,8 @@
 
 require_once('pre.php');
 
+$id = getIntFromRequest('id');
+
 $sql="SELECT * FROM snippet_version WHERE snippet_version_id='$id'";
 $result=db_query($sql);
 
diff -urNad gforge/www/snippet/package.php /tmp/dpep.cr36JK/gforge/www/snippet/package.php
--- gforge/www/snippet/package.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/snippet/package.php	2005-01-21 00:09:56.000000000 +0100
@@ -17,7 +17,14 @@
 
 if (session_loggedin()) {
 
-	if ($post_changes) {
+	if (getStringFromRequest('post_changes')) {
+		$name = getStringFromRequest('name');
+		$description = getStringFromRequest('description');
+		$language = getIntFromRequest('language');
+		$category = getIntFromRequest('category');
+		$changes = getStringFromRequest('changes');
+		$version = getStringFromRequest('version');
+
 		/*
 			Create a new snippet entry, then create a new snippet version entry
 		*/
diff -urNad gforge/www/snippet/snippet_utils.php /tmp/dpep.cr36JK/gforge/www/snippet/snippet_utils.php
--- gforge/www/snippet/snippet_utils.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/snippet/snippet_utils.php	2005-01-21 00:09:56.000000000 +0100
@@ -77,7 +77,7 @@
 $SCRIPT_LANGUAGE[16] = 'C#';
 
 function snippet_header($params) {
-	global $DOCUMENT_ROOT, $HTML, $Language, $sys_use_snippet;
+	global $HTML, $Language, $sys_use_snippet;
 
 	if (!$sys_use_snippet) {
 		exit_disabled();
diff -urNad gforge/www/snippet/submit.php /tmp/dpep.cr36JK/gforge/www/snippet/submit.php
--- gforge/www/snippet/submit.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/snippet/submit.php	2005-01-21 00:09:56.000000000 +0100
@@ -17,7 +17,16 @@
 
 if (session_loggedin()) {
 
-	if ($post_changes) {
+	if (getStringFromRequest('post_changes')) {
+		$name = getStringFromRequest('name');
+		$description = getStringFromRequest('description');
+		$language = getIntFromRequest('language');
+		$license = getStringFromRequest('license');
+		$category = getIntFromRequest('category');
+		$type = getStringFromRequest('type');
+		$version = getStringFromRequest('version');
+		$code = getStringFromRequest('code');
+
 		/*
 			Create a new snippet entry, then create a new snippet version entry
 		*/
@@ -59,7 +68,7 @@
 	<p><?php echo $Language->getText('snippet_submit','you_can_post'); ?>
 	</p>
 	<p>
-	<form action="<?php echo $PHP_SELF; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 	<input type="hidden" name="post_changes" value="y" />
 	<input type="hidden" name="changes" value="First Posted Version" />
 
diff -urNad gforge/www/softwaremap/trove_list.php /tmp/dpep.cr36JK/gforge/www/softwaremap/trove_list.php
--- gforge/www/softwaremap/trove_list.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/softwaremap/trove_list.php	2005-01-21 00:09:56.000000000 +0100
@@ -19,13 +19,13 @@
 	exit_disabled();
 }
 
+$form_cat = intval(getIntFromRequest('form_cat'));
+
 // assign default. 18 is 'topic'
-if (!isset($form_cat) || !$form_cat) {
+if (!$form_cat) {
 	$form_cat = $default_trove_cat;
 }
 
-$form_cat = intval($form_cat);
-
 // get info about current folder
 $res_trove_cat = db_query("
 	SELECT *
@@ -49,10 +49,11 @@
 // #####################################
 // this section limits search and requeries if there are discrim elements
 
+$discrim = getStringFromRequest('discrim');
 $discrim_url = '';
 $discrim_desc = '';
 
-if (isset($discrim) && $discrim) {
+if ($discrim) {
 	unset ($discrim_queryalias);
 	unset ($discrim_queryand);
 	unset ($discrim_url_b);
@@ -236,7 +237,9 @@
 
 // no funny stuff with get vars
 
-if (!isset($page) || !is_numeric($page)) {
+$page = getStringFromRequest('page');
+
+if (!is_numeric($page)) {
 	$page = 1;
 }
 
diff -urNad gforge/www/source.php /tmp/dpep.cr36JK/gforge/www/source.php
--- gforge/www/source.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/source.php	2005-01-21 00:09:56.000000000 +0100
@@ -18,6 +18,8 @@
 	exit_permission_denied();
 }
 
+$file = getStringFromRequest('file');
+
 if (!$file) {
 	exit_error($Language->getText('source','missing_file'), $Language->getText('source','missing_file_text'));
 }
@@ -30,7 +32,7 @@
 
 // If this is a legal dir, then it is under the docroot, else use basename
 if ($dir) {
-	$fname = $DOCUMENT_ROOT . $file;
+	$fname = getStringFromServer('DOCUMENT_ROOT') . $file;
 } else {
 	$fname = basename($file);
 }
diff -urNad gforge/www/stats/users_graph.php /tmp/dpep.cr36JK/gforge/www/stats/users_graph.php
--- gforge/www/stats/users_graph.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/stats/users_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -18,6 +18,9 @@
    // require you to be a member of the sfstats group (group_id = 11084)
 session_require( array('group'=>$sys_stats_group) );
 
+$group_id = getIntFromRequest('group_id');
+$year = getIntFromRequest('year');
+
 if ( ! $group_id ) {
 	$group_id = 0;
 }
diff -urNad gforge/www/stats/views_graph.php /tmp/dpep.cr36JK/gforge/www/stats/views_graph.php
--- gforge/www/stats/views_graph.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/stats/views_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -18,6 +18,8 @@
    // require you to be a member of the sfstats group (group_id = 11084)
 session_require( array('group'=>$sys_stats_group) );
 
+$group_id = getIntFromRequest('group_id');
+$year = getIntFromRequest('year');
 
 if ( ! $group_id ) {
 	$group_id = 0;
diff -urNad gforge/www/survey/admin/add_question.php /tmp/dpep.cr36JK/gforge/www/survey/admin/add_question.php
--- gforge/www/survey/admin/add_question.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/add_question.php	2005-01-21 00:09:56.000000000 +0100
@@ -28,6 +28,8 @@
 require_once('pre.php');
 require_once('www/survey/survey_utils.php');
 $is_admin_page='y';
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
 survey_header(array('title'=>$Language->getText('survey_add_question','title'),'pagename'=>'survey_admin_add_question'));
 
 if (!session_loggedin() || !user_ismember($group_id,'A')) {
@@ -36,7 +38,10 @@
 	exit;
 }
 
-if ($post_changes) {
+if (getStringFromRequest('post_changes')) {
+	$question = getStringFromRequest('question');
+	$question_type = getStringFromRequest('question_type');
+
 	$sql="INSERT INTO survey_questions (group_id,question,question_type) VALUES ($group_id,'".htmlspecialchars($question)."',$question_type)";
 	$result=db_query($sql);
 	if ($result) {
@@ -60,7 +65,7 @@
 </script>
 
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <input type="hidden" name="post_changes" value="Y" />
 <input type="hidden" name="group_id" value="<?php echo $group_id; ?>" />
 <?php echo $Language->getText('survey_add_question','question') ?>:<br />
diff -urNad gforge/www/survey/admin/add_survey.php /tmp/dpep.cr36JK/gforge/www/survey/admin/add_survey.php
--- gforge/www/survey/admin/add_survey.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/add_survey.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,6 +29,8 @@
 require_once('www/survey/survey_utils.php');
 require_once('www/survey/admin/survey_utils.php');
 $is_admin_page='y';
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
 survey_header(array('title'=>$Language->getText('survey_add_survey','title'),'pagename'=>'survey_admin_add_survey'));
 
 if (!session_loggedin() || !user_ismember($group_id,'A')) {
@@ -37,7 +39,10 @@
 	exit;
 }
 
-if ($post_changes) {
+if (getStringFromRequest('post_changes')) {
+	$survey_title = getStringFromRequest('survey_title');
+	$survey_questions = getStringFromRequest('survey_questions');
+
 	if (!$survey_title) {
 		$feedback .= $Language->getText('survey_add_question','title_is_required');
 	} else {
@@ -65,7 +70,7 @@
 </script>
 
 
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 
 <strong><?php echo $Language->getText('survey_add_survey','name_of_survey') ?></strong><?php echo utils_requiredField(); ?>
 <br />
diff -urNad gforge/www/survey/admin/edit_question.php /tmp/dpep.cr36JK/gforge/www/survey/admin/edit_question.php
--- gforge/www/survey/admin/edit_question.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/edit_question.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,6 +29,8 @@
 require_once('www/survey/survey_utils.php');
 
 $is_admin_page='y';
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
 survey_header(array('title'=>$Language->getText('survey_edit_question','title'),'pagename'=>'survey_admin_edit_question'));
 
 if (!session_loggedin() || !user_ismember($group_id,'A')) {
@@ -37,7 +39,11 @@
 	exit;
 }
 
-if ($post_changes) {
+if (getStringFromRequest('post_changes')) {
+	$question = getStringFromRequest('question');
+	$question_type = getStringFromRequest('question_type');
+	$question_id = getIntFromRequest('question_id');
+
 	$sql="UPDATE survey_questions SET question='".htmlspecialchars($question)."', question_type='$question_type' where question_id='$question_id' AND group_id='$group_id'";
 	$result=db_query($sql);
         if (db_affected_rows($result) < 1) {
@@ -77,7 +83,7 @@
 <p><?php echo $Language->getText('survey_edit_question','if_you_change_after'); ?>.</p>
 
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <input type="hidden" name="post_changes" value="Y" />
 <input type="hidden" name="group_id" value="<?php echo $group_id; ?>"/>
 <input type="hidden" name="question_id" value="<?php echo $question_id; ?>" />
diff -urNad gforge/www/survey/admin/edit_survey.php /tmp/dpep.cr36JK/gforge/www/survey/admin/edit_survey.php
--- gforge/www/survey/admin/edit_survey.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/edit_survey.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,8 @@
 require_once('www/survey/admin/survey_utils.php');
 
 $is_admin_page='y';
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
 survey_header(array('title'=>$Language->getText('survey_edit','tilte'),'pagename'=>'survey_admin_edit_survey'));
 
 if (!session_loggedin() || !user_ismember($group_id,'A')) {
@@ -38,7 +40,11 @@
 	exit;
 }
 
-if ($post_changes) {
+if (getStringFromRequest('post_changes')) {
+	$survey_title = $survey_title;
+	$survey_questions = $survey_questions;
+	$is_active = $is_active;
+
 	if (!isset($survey_title) || $survey_title == "")
 	{
 		$feedback .= $Language->getText('survey_edit','survey_title_required');
@@ -97,7 +103,7 @@
 
 <p><?php echo $Language->getText('survey_edit','change_after_already_response'); ?>.</p>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="post">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="post">
 <input type="hidden" name="group_id" value="<?php echo $group_id; ?>" />
 <input type="hidden" name="post_changes" value="y" />
 <strong><?php echo $Language->getText('survey_edit','name_off_survey'); ?>:</strong>
diff -urNad gforge/www/survey/admin/graphs.php /tmp/dpep.cr36JK/gforge/www/survey/admin/graphs.php
--- gforge/www/survey/admin/graphs.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/graphs.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,6 +32,10 @@
 require_once($sys_path_to_jpgraph.'/jpgraph_pie.php');
 require_once($sys_path_to_jpgraph.'/jpgraph_pie3d.php');
 
+$type = getStringFromRequest('type');
+$legend = getStringFromRequest('legend');
+$value = getStringFromRequest('value');
+
 if ($type=='pie') {
     ShowPie($legend, $value);
 } else {
diff -urNad gforge/www/survey/admin/index.php /tmp/dpep.cr36JK/gforge/www/survey/admin/index.php
--- gforge/www/survey/admin/index.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,6 +29,8 @@
 require_once('www/survey/include/SurveyHTML.class');
 
 $is_admin_page='y';
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
 $sh = new  SurveyHtml();
 $sh->header(array('title'=>$Language->getText('survey_admin_index','title'),'pagename'=>'survey_admin'));
 
diff -urNad gforge/www/survey/admin/question.php /tmp/dpep.cr36JK/gforge/www/survey/admin/question.php
--- gforge/www/survey/admin/question.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/question.php	2005-01-21 00:09:56.000000000 +0100
@@ -13,6 +13,11 @@
 require_once('common/survey/SurveyQuestionFactory.class');
 require_once('www/survey/include/SurveyHTML.class');
 
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
+$question_id = getIntFromRequest('question_id');
+$question_type = getStringFromRequest('question_type');
+
 /* We need a group_id */ 
 if (!$group_id) {
     exit_no_group();
@@ -42,7 +47,7 @@
 }
 
 /* Delete a question */
-if ($delete=="Y" && $question_id) {
+if (getStringFromRequest('delete')=="Y" && $question_id) {
      $sq->delete();
 
     /* Error */
@@ -52,7 +57,7 @@
 	$msg = $Language->getText('survey_edit','delete_successful');
     }
     echo "<H3>".$msg ."</H3>";
-} else if ($post=="Y") {
+} else if (getStringFromRequest('post')=="Y") {
     /* Modification */
     if ($question_id) {
 	$sq->update($question, $question_type);
diff -urNad gforge/www/survey/admin/show_questions.php /tmp/dpep.cr36JK/gforge/www/survey/admin/show_questions.php
--- gforge/www/survey/admin/show_questions.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/show_questions.php	2005-01-21 00:09:56.000000000 +0100
@@ -27,8 +27,10 @@
 
 require_once('pre.php');
 require_once('www/survey/survey_utils.php');
-$is_admin_page='y';
 
+$is_admin_page='y';
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
 survey_header(array('title'=>$Language->getText('survey_show_questions','title'),'pagename'=>'survey_admin_show_questions'));
 
 if (!session_loggedin() || !user_ismember($group_id,'A')) {
diff -urNad gforge/www/survey/admin/show_results_aggregate.php /tmp/dpep.cr36JK/gforge/www/survey/admin/show_results_aggregate.php
--- gforge/www/survey/admin/show_results_aggregate.php	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/show_results_aggregate.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,8 @@
 require_once('www/survey/survey_utils.php');
 
 $is_admin_page='y';
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
 survey_header(array('title'=>$Language->getText('survey_show_results_aggregate','title'),'pagename'=>'survey_admin_show_results_aggregate'));
 
 if (!session_loggedin() || !user_ismember($group_id,'A')) {
diff -urNad gforge/www/survey/admin/show_results_comments.php /tmp/dpep.cr36JK/gforge/www/survey/admin/show_results_comments.php
--- gforge/www/survey/admin/show_results_comments.php	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/show_results_comments.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,8 @@
 require_once('www/survey/survey_utils.php');
 
 $is_admin_page='y';
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
 survey_header(array('title'=>'Survey Aggregate Results','pagename'=>'survey_admin_show_results_comments'));
 
 if (!session_loggedin() || !user_ismember($group_id,'A')) {
diff -urNad gforge/www/survey/admin/show_results_csv.php /tmp/dpep.cr36JK/gforge/www/survey/admin/show_results_csv.php
--- gforge/www/survey/admin/show_results_csv.php	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/show_results_csv.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,6 +29,9 @@
 require_once('HTML_Graphs.php');
 require_once('www/survey/survey_utils.php');
 
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
+
 if (!session_loggedin() || !user_ismember($group_id,'A')) {
         echo "<h1>".$Language->getText('survey_show_results_csv','permission_denied')."</h1>";
 	exit;
diff -urNad gforge/www/survey/admin/show_results_individual.php /tmp/dpep.cr36JK/gforge/www/survey/admin/show_results_individual.php
--- gforge/www/survey/admin/show_results_individual.php	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/show_results_individual.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,8 @@
 require_once('www/survey/survey_utils.php');
 
 $is_admin_page='y';
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
 survey_header(array('title'=>$Language->getText('survey_show_results_individual','title'),'pagename'=>'survey_admin_show_results_individual'));
 
 if (!session_loggedin() || !user_ismember($group_id,'A')) {
diff -urNad gforge/www/survey/admin/show_results.php /tmp/dpep.cr36JK/gforge/www/survey/admin/show_results.php
--- gforge/www/survey/admin/show_results.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/show_results.php	2005-01-21 00:09:56.000000000 +0100
@@ -35,6 +35,9 @@
 require_once('common/survey/SurveyResponseFactory.class');
 require_once('www/survey/include/SurveyHTML.class');
 
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
+
 /* We need a group_id */ 
 if (!$group_id) {
     exit_no_group();
@@ -72,6 +75,7 @@
     }
 
     /* A specific question */
+    $question_id = getIntFromRequest('question_id');
     if ($question_id) {
 	/* Create a Survey Question for general purpose */
 	$sq = new SurveyQuestion($g, $question_id);
diff -urNad gforge/www/survey/admin/survey.php /tmp/dpep.cr36JK/gforge/www/survey/admin/survey.php
--- gforge/www/survey/admin/survey.php	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/admin/survey.php	2005-01-21 00:09:56.000000000 +0100
@@ -16,6 +16,9 @@
 require_once('common/survey/SurveyQuestionFactory.class');
 require_once('www/survey/include/SurveyHTML.class');
 
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
+
 /* We need a group_id */ 
 if (!$group_id) {
     exit_no_group();
@@ -38,7 +41,12 @@
 	exit;
 }
 
-if ($post=="Y") {
+if (getStringFromRequest('post')=="Y") {
+    $survey_title = getStringFromRequest('survey_title');
+    $to_add = getStringFromRequest('to_add');
+    $to_del = getStringFromRequest('to_del');
+    $is_active = getStringFromRequest('is_active');
+  
     if ($survey_id) { /* Modify */
 	$s->update($survey_title, $to_add, $to_del, $is_active);
 	$feedback = $Language->getText('survey_edit','update_successful');
@@ -49,7 +57,10 @@
 }
 
 /* Order changes */
-if ($updown=="Y") {
+if (getStringFromRequest('updown')=="Y") {
+    $question_id = getIntFromRequest('question_id');
+    $is_up = getStringFromRequest('is_up');
+
     $s->updateOrder($question_id, $is_up);
     $feedback = $Language->getText('survey_edit','update_successful');
 }
diff -urNad gforge/www/survey/include/SurveyHTML.class /tmp/dpep.cr36JK/gforge/www/survey/include/SurveyHTML.class
--- gforge/www/survey/include/SurveyHTML.class	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/include/SurveyHTML.class	2005-01-21 00:09:56.000000000 +0100
@@ -31,7 +31,7 @@
 	 * Show survey header 
 	 */
 	function header($params) {
-		global $group_id,$is_admin_page,$HTML,$DOCUMENT_ROOT,$Language,$sys_use_survey;
+		global $group_id,$is_admin_page,$HTML,$Language,$sys_use_survey;
 
 		if (!$sys_use_survey) {
 			exit_disabled();
@@ -113,7 +113,7 @@
 
 		$ret = '<h2>'. $title. '</h2>';
 		$ret.= $warning;
-		$ret.='<form action="'.$PHP_SELF.'" method="post">';
+		$ret.='<form action="'.getStringFromServer('PHP_SELF').'" method="post">';
 		$ret.='<input type="hidden" name="post" value="Y" />';
 		$ret.='<input type="hidden" name="group_id" value="'.$group_id.'" />';
 		$ret.='<input type="hidden" name="question_id" value="'.$question_id.'" />';
@@ -165,7 +165,7 @@
 
 		$ret = '<h2>'. $title. '</h2>';
 		$ret.= $warning;
-		$ret.='<form action="'.$PHP_SELF.'" method="post">';
+		$ret.='<form action="'.getStringFromServer('PHP_SELF').'" method="post">';
 		$ret.='<input type="hidden" name="post" value="Y" />';
 		$ret.='<input type="hidden" name="group_id" value="'.$group_id.'" />';
 		$ret.='<input type="hidden" name="survey_id" value="'.$survey_id.'" />';
diff -urNad gforge/www/survey/index.php /tmp/dpep.cr36JK/gforge/www/survey/index.php
--- gforge/www/survey/index.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -28,7 +28,10 @@
 require_once('common/survey/SurveyFactory.class');
 require_once('www/survey/include/SurveyHTML.class');
 
-/* We need a group_id */ 
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
+
+ /* We need a group_id */ 
 if (!$group_id) {
     exit_no_group();
 }
diff -urNad gforge/www/survey/rating_resp.php /tmp/dpep.cr36JK/gforge/www/survey/rating_resp.php
--- gforge/www/survey/rating_resp.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/rating_resp.php	2005-01-21 00:09:56.000000000 +0100
@@ -33,6 +33,10 @@
 if (!session_loggedin()) {
 	echo "<h2>".$Language->getText('survey_rating_resp','you_must_be_logged_in')."</h2>";
 } else {
+	$vote_on_id = getIntFromRequest('vote_on_id');
+	$response = getStringFromRequest('response');
+	$flag = getStringFromRequest('flag');
+
 	if ($vote_on_id && $response && $flag) {
 		/*
 			$flag
diff -urNad gforge/www/survey/survey.php /tmp/dpep.cr36JK/gforge/www/survey/survey.php
--- gforge/www/survey/survey.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/survey.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,8 @@
 require_once('common/survey/Survey.class');
 require_once('www/survey/include/SurveyHTML.class');
 
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
 
 /* We need a group_id */ 
 if (!$group_id) {
diff -urNad gforge/www/survey/survey_resp.php /tmp/dpep.cr36JK/gforge/www/survey/survey_resp.php
--- gforge/www/survey/survey_resp.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/survey_resp.php	2005-01-21 00:09:56.000000000 +0100
@@ -31,6 +31,9 @@
 require_once('common/survey/SurveyResponse.class');
 require_once('www/survey/include/SurveyHTML.class');
 
+$group_id = getIntFromRequest('group_id');
+$survey_id = getIntFromRequest('survey_id');
+
 $g =& group_get_object($group_id);
 if (!$g || !is_object($g) || $g->isError()) {
     exit_no_group();
diff -urNad gforge/www/survey/survey_utils.php /tmp/dpep.cr36JK/gforge/www/survey/survey_utils.php
--- gforge/www/survey/survey_utils.php	2005-01-19 22:18:52.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/survey/survey_utils.php	2005-01-21 00:09:56.000000000 +0100
@@ -32,7 +32,7 @@
 */
 
 function survey_header($params) {
-	global $group_id,$is_admin_page,$HTML,$DOCUMENT_ROOT,$Language,$sys_use_survey;
+	global $group_id,$is_admin_page,$HTML,$Language,$sys_use_survey;
 
 	if (!$sys_use_survey) {
 		exit_disabled();
diff -urNad gforge/www/tarballs.php /tmp/dpep.cr36JK/gforge/www/tarballs.php
--- gforge/www/tarballs.php	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tarballs.php	2005-01-21 00:09:56.000000000 +0100
@@ -13,6 +13,8 @@
 
 require_once('pre.php');
 
+$group_id = getIntFromRequest('group_id');
+
 session_require(array('group'=>$group_id));
 
 // get current information
diff -urNad gforge/www/themes/osx/Theme.class /tmp/dpep.cr36JK/gforge/www/themes/osx/Theme.class
--- gforge/www/themes/osx/Theme.class	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/themes/osx/Theme.class	2005-01-21 00:09:56.000000000 +0100
@@ -376,8 +376,7 @@
 <?php
 	global $sys_show_source;
 	if ($sys_show_source) {
-		global $SCRIPT_NAME;
-		print '<a class="showsource" href="/source.php?file=' . $SCRIPT_NAME . '">Show Source</a>';
+		print '<a class="showsource" href="/source.php?file=' . getStringFromServer('SCRIPT_NAME') . '">Show Source</a>';
 	}
 ?>
 
diff -urNad gforge/www/themes/ultralite/Theme.class /tmp/dpep.cr36JK/gforge/www/themes/ultralite/Theme.class
--- gforge/www/themes/ultralite/Theme.class	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/themes/ultralite/Theme.class	2005-01-21 00:09:56.000000000 +0100
@@ -144,8 +144,7 @@
 		<?php
 		global $sys_show_source;
 		if ($sys_show_source) {
-		global $SCRIPT_NAME;
-		print '<a class="showsource" href="/source.php?file=' . $SCRIPT_NAME . '">Show Source</a>';
+		print '<a class="showsource" href="/source.php?file=' . getStringFromServer('SCRIPT_NAME') . '">Show Source</a>';
 		}
 		?>
 		</body>
diff -urNad gforge/www/top/mostactive.php /tmp/dpep.cr36JK/gforge/www/top/mostactive.php
--- gforge/www/top/mostactive.php	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/top/mostactive.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,6 +29,10 @@
 require ('pre.php');    
 require_once ('common/include/Stats.class');    
 
+$offset = getIntFromRequest('offset');
+$type = getStringFromRequest('type');
+$limit = getStringFromRequest('limit');
+
 if (!$offset || $offset < 0) {
 	$offset=0;
 }
diff -urNad gforge/www/top/toplist.php /tmp/dpep.cr36JK/gforge/www/top/toplist.php
--- gforge/www/top/toplist.php	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/top/toplist.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,18 +29,20 @@
 require "pre.php";    
 require_once "common/include/Stats.class";    
 
+$type = getStringFromRequest('type');
+
 $stats = new Stats();
 
-if ($GLOBALS['type'] == 'downloads_week') {
+if ($type == 'downloads_week') {
 	$title = $Language->getText('top_toplist','top_download_7_days');
 	$column1 = $Language->getText('top_toplist','download');
 }
-else if ($GLOBALS['type'] == 'pageviews_proj') {
+else if ($type == 'pageviews_proj') {
 	$res_top = $stats->getTopPageViews();
 	$title = $Language->getText('top_toplist','top_weekly_pagesviews',array($GLOBALS['sys_default_domain'],$GLOBALS['sys_name']));
 	$column1 = $Language->getText('top_toplist','pageviews');
 }
-else if ($GLOBALS['type'] == 'forumposts_week') {
+else if ($type == 'forumposts_week') {
 	$res_top = $stats->getTopMessagesPosted();
 	$title = $Language->getText('top_toplist','top_forum_post_count');
 	$column1 = $Language->getText('top_toplist','posts');
diff -urNad gforge/www/top/topusers.php /tmp/dpep.cr36JK/gforge/www/top/topusers.php
--- gforge/www/top/topusers.php	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/top/topusers.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,8 @@
 
 require_once('pre.php');
 
+$offset = getStringFromRequest('offset');
+
 $yesterday = time()-60*60*24;
 $yd_month = date('Ym', $yesterday);
 $yd_day = date('d', $yesterday);
diff -urNad gforge/www/tracker/add.php /tmp/dpep.cr36JK/gforge/www/tracker/add.php
--- gforge/www/tracker/add.php	2005-01-19 22:18:53.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/add.php	2005-01-21 00:09:56.000000000 +0100
@@ -22,7 +22,7 @@
 
 	echo '<p>
 
-	<form action="'.$PHP_SELF.'?group_id='.$group_id.'&atid='.$ath->getID().'" method="post" enctype="multipart/form-data">
+	<form action="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&atid='.$ath->getID().'" method="post" enctype="multipart/form-data">
 	<input type="hidden" name="func" value="postadd" />
 	<table>
 	<tr>
@@ -79,7 +79,7 @@
 	<?php 
 	if (!session_loggedin()) {
 		echo '
-		<h3><span style="color:red">'.$Language->getText('tracker','please_login',array('<a href="/account/login.php?return_to='.urlencode($REQUEST_URI).'">','</a>')).'</span></h3><br />
+		<h3><span style="color:red">'.$Language->getText('tracker','please_login',array('<a href="/account/login.php?return_to='.urlencode(getStringFromServer('REQUEST_URI')).'">','</a>')).'</span></h3><br />
 		'.$Language->getText('tracker','insert_email').':<p>
 		<input type="text" name="user_email" size="30" maxlength="35" /></p>
 		';
diff -urNad gforge/www/tracker/admin/form-addcanned.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-addcanned.php
--- gforge/www/tracker/admin/form-addcanned.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-addcanned.php	2005-01-21 00:09:56.000000000 +0100
@@ -27,7 +27,7 @@
 			for ($i=0; $i < $rows; $i++) {
 				echo '<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'>'.
 					'<td>'.db_result($result, $i, 'id').'</td>'.
-					'<td><a href="'.$PHP_SELF.'?update_canned=1&amp;id='.
+					'<td><a href="'.getStringFromServer('PHP_SELF').'?update_canned=1&amp;id='.
 						db_result($result, $i, 'id').'&amp;group_id='.$group_id.'&amp;atid='. $ath->getID() .'">'.
 						db_result($result, $i, 'title').'</a></td></tr>';
 			}
@@ -40,7 +40,7 @@
 		?>
 		<p><?php echo $Language->getText('tracker_admin_add_canned','canned_response_info') ?></p>
 		<p>
-		<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
 		<input type="hidden" name="add_canned" value="y" />
 		<strong><?php echo $Language->getText('tracker_admin_add_canned','canned_response_title') ?>:</strong><br />
 		<input type="text" name="title" value="" size="50" maxlength="50" />
diff -urNad gforge/www/tracker/admin/form-addcategory.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-addcategory.php
--- gforge/www/tracker/admin/form-addcategory.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-addcategory.php	2005-01-21 00:09:56.000000000 +0100
@@ -23,7 +23,7 @@
 			for ($i=0; $i < $rows; $i++) {
 				echo '<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'>'.
 					'<td>'.db_result($result, $i, 'id').'</td>'.
-					'<td><a href="'.$PHP_SELF.'?update_cat=1&amp;id='.
+					'<td><a href="'.getStringFromServer('PHP_SELF').'?update_cat=1&amp;id='.
 						db_result($result, $i, 'id').'&amp;group_id='.$group_id.'&amp;atid='. $ath->getID() .'">'.
 						db_result($result, $i, 'category_name').'</a></td></tr>';
 			}		   
@@ -35,7 +35,7 @@
 		}
 		?>
 		<p>
-		<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
 		<input type="hidden" name="add_cat" value="y" />
 		<strong><?php echo $Language->getText('tracker_admin','category_name') ?>:</strong><br />
 		<input type="text" name="name" value="" size="15" maxlength="30" /><br />
diff -urNad gforge/www/tracker/admin/form-addextrafieldoption.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-addextrafieldoption.php
--- gforge/www/tracker/admin/form-addextrafieldoption.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-addextrafieldoption.php	2005-01-21 00:09:56.000000000 +0100
@@ -16,7 +16,7 @@
 		$rows=count($efearr);
 		if ($rows > 0) {
 			
-			echo '<a href="'.$PHP_SELF.'?copy_opt=1&amp;boxid='.$boxid.'&amp;group_id='.
+			echo '<a href="'.getStringFromServer('PHP_SELF').'?copy_opt=1&amp;boxid='.$boxid.'&amp;group_id='.
 				$group_id.'&amp;atid='. $ath->getID() .'">'.
 				$Language->getText('tracker_admin_copy','copy_choices'). '</a><p>';
 
@@ -27,7 +27,7 @@
 
 			for ($i=0; $i < $rows; $i++) {
 				echo '<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'>'.
-					'<td><a href="'.$PHP_SELF.'?update_opt=1&amp;id='.
+					'<td><a href="'.getStringFromServer('PHP_SELF').'?update_opt=1&amp;id='.
 					$efearr[$i]['element_id'].'&amp;boxid='.			
 					$efearr[$i]['extra_field_id'].'&amp;group_id='.$group_id.'&amp;atid='. $ath->getID() .'">'.
 					$efearr[$i]['element_name'].' ['.$Language->getText('tracker_admin_build_boxes','edit').']</a></td>';
@@ -39,7 +39,7 @@
 		}
 		?>
 		<p>
-		<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&boxid='.$boxid.'&atid='.$ath->getID(); ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&boxid='.$boxid.'&atid='.$ath->getID(); ?>" method="post">
 		<input type="hidden" name="add_opt" value="y" />
 		<strong><?php echo $Language->getText('tracker_admin_build_boxes','opt_add_name') ?>:</strong><br />
 		<input type="text" name="name" value="" size="15" maxlength="30" /> <br \>
diff -urNad gforge/www/tracker/admin/form-addextrafield.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-addextrafield.php
--- gforge/www/tracker/admin/form-addextrafield.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-addextrafield.php	2005-01-21 00:09:56.000000000 +0100
@@ -22,7 +22,7 @@
 			for ($i=0; $i < $rows; $i++) {
 
 				echo '<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'>'.
-					'<td><a href="'.$PHP_SELF.'?update_box=1&amp;id='.
+					'<td><a href="'.getStringFromServer('PHP_SELF').'?update_box=1&amp;id='.
 						$efarr[$i]['extra_field_id'].'&amp;group_id='.$group_id.'&amp;atid='. $ath->getID() .'">'.
 						$efarr[$i]['field_name'].' ['.$Language->getText('tracker_admin_build_boxes','edit').']</a></td>';
 				/*
@@ -35,7 +35,7 @@
 					echo '<td>';
 					for ($j=0; $j <$optrows; $j++)
 				
-						echo '<a href="'.$PHP_SELF.'?update_opt=1&amp;id='.
+						echo '<a href="'.getStringFromServer('PHP_SELF').'?update_opt=1&amp;id='.
 						$elearray[$j]['element_id'].'&amp;group_id='.$group_id.'&amp;atid='. $ath->getID() .'&amp;boxid='.
 						$efarr[$i]['extra_field_id'].'">'.
 						$elearray[$j]['element_name'].' ['.$Language->getText('tracker_admin_build_boxes','edit').']</a><br \>';
@@ -46,7 +46,7 @@
 				echo '</td>';
 				echo '<td>';
 				if ($efarr[$i]['field_type'] == ARTIFACT_EXTRAFIELDTYPE_SELECT || $efarr[$i]['field_type'] == ARTIFACT_EXTRAFIELDTYPE_RADIO) {
-					echo '<a href="'.$PHP_SELF.'?add_opt=1&amp;boxid='.
+					echo '<a href="'.getStringFromServer('PHP_SELF').'?add_opt=1&amp;boxid='.
 						$efarr[$i]['extra_field_id'].'&amp;group_id='.$group_id.'&amp;atid='. $ath->getID() .'">['.
 						$Language->getText('tracker_admin_build_boxes', 'box_add_choices').']</a>';
 				}
@@ -60,7 +60,7 @@
 		}
 		?>
 		<p>
-		<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
 		<input type="hidden" name="add_extrafield" value="y" />
 		<strong><?php echo $Language->getText('tracker_admin_build_boxes','box_name') ?>:</strong><br />
 		<input type="text" name="name" value="" size="15" maxlength="30" /><br />
diff -urNad gforge/www/tracker/admin/form-addgroup.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-addgroup.php
--- gforge/www/tracker/admin/form-addgroup.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-addgroup.php	2005-01-21 00:09:56.000000000 +0100
@@ -20,7 +20,7 @@
 			for ($i=0; $i < $rows; $i++) {
 				echo '<tr '. $GLOBALS['HTML']->boxGetAltRowStyle($i) .'>'.
 					'<td>'.db_result($result, $i, 'id').'</td>'.
-					'<td><a href="'.$PHP_SELF.'?update_group=1&amp;id='.
+					'<td><a href="'.getStringFromServer('PHP_SELF').'?update_group=1&amp;id='.
 						db_result($result, $i, 'id').'&amp;group_id='.$group_id.'&amp;atid='. $ath->getID() .'">'.
 						db_result($result, $i, 'group_name').'</a></td></tr>';
 			}		   
@@ -32,7 +32,7 @@
 		}
 		?>
 		<p>
-		<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
 		<input type="hidden" name="add_group" value="y" />
 		<strong><?php echo $Language->getText('tracker_admin','group_name')?>:</strong><br />
 		<input type="text" name="name" value="" size="15" maxlength="30" /><br />
diff -urNad gforge/www/tracker/admin/form-deletetracker.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-deletetracker.php
--- gforge/www/tracker/admin/form-deletetracker.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-deletetracker.php	2005-01-21 00:09:56.000000000 +0100
@@ -4,7 +4,7 @@
 
 		?>
 		<p>
-		<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
 		<input type="hidden" name="delete" value="y" /><br />
 		<?php echo $Language->getText('tracker_admin','delete_warning'); ?>
 		<p>
diff -urNad gforge/www/tracker/admin/form-extrafieldcopy.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-extrafieldcopy.php
--- gforge/www/tracker/admin/form-extrafieldcopy.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-extrafieldcopy.php	2005-01-21 00:09:56.000000000 +0100
@@ -26,7 +26,7 @@
 		echo '<td valign=top>';
 		?>
 		
-		<form action="<?php echo $PHP_SELF .'?group_id='.$group_id.'&boxid='.$boxid.'&atid='.$ath->getID(); ?>" method="post" >
+		<form action="<?php echo getStringFromServer('PHP_SELF') .'?group_id='.$group_id.'&boxid='.$boxid.'&atid='.$ath->getID(); ?>" method="post" >
 		<input type="hidden" name="copy_opt" value="copy" >
 		<input type="hidden" value="$return">
 		<?php
diff -urNad gforge/www/tracker/admin/form-updatecanned.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updatecanned.php
--- gforge/www/tracker/admin/form-updatecanned.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updatecanned.php	2005-01-21 00:09:56.000000000 +0100
@@ -6,6 +6,7 @@
 
 		echo "<h1>".$Language->getText('tracker_admin_update_canned','title', $ath->getName())."</h1>";
 
+		$id = getStringFromRequest('id');
 		$acr = new ArtifactCanned($ath,$id);
 		if (!$acr || !is_object($acr)) {
 			$feedback .= 'Unable to create ArtifactCanned Object';
@@ -15,7 +16,7 @@
 			?>
 			<p><?php echo $Language->getText('tracker_admin_add_canned','canned_response_info') ?></p>
 			<p>
-			<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
+			<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
 			<input type="hidden" name="update_canned" value="y" />
 			<input type="hidden" name="id" value="<?php echo $acr->getID(); ?>" />
 			<strong><?php echo $Language->getText('tracker_admin_add_canned','canned_response_title') ?>:</strong><br />
diff -urNad gforge/www/tracker/admin/form-updatecategory.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updatecategory.php
--- gforge/www/tracker/admin/form-updatecategory.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updatecategory.php	2005-01-21 00:09:56.000000000 +0100
@@ -10,6 +10,7 @@
 		echo '
 			<h1>'.$Language->getText('tracker_admin_update_cat','title',$ath->getName()).'</h1>';
 
+		$id = getStringFromRequest('id');
 		$ac = new ArtifactCategory($ath,$id);
 		if (!$ac || !is_object($ac)) {
 			$feedback .= 'Unable to create ArtifactCategory Object';
@@ -18,7 +19,7 @@
 		} else {
 			?>
 			<p>
-			<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
+			<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
 			<input type="hidden" name="update_cat" value="y" />
 			<input type="hidden" name="id" value="<?php echo $ac->getID(); ?>" />
 			<p>
diff -urNad gforge/www/tracker/admin/form-updateextrafieldelement.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updateextrafieldelement.php
--- gforge/www/tracker/admin/form-updateextrafieldelement.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updateextrafieldelement.php	2005-01-21 00:09:56.000000000 +0100
@@ -10,6 +10,7 @@
 		echo '
 			<h2>'.$Language->getText('tracker_admin_build_boxes','opt_update_title',$ath->getName()).'</h2>';
 
+		$id = getStringFromRequest('id');
 		$ao = new ArtifactExtraFieldElement($ath,$id);
 		if (!$ao || !is_object($ao)) {
 			$feedback .= 'Unable to create ArtifactExtraFieldElement Object';
@@ -19,7 +20,7 @@
 
 			?>
 			<p>
-			<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
+			<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
 			<input type="hidden" name="update_opt" value="y" />
 			<input type="hidden" name="id" value="<?php echo $ao->getID(); ?>" />
 
diff -urNad gforge/www/tracker/admin/form-updateextrafield.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updateextrafield.php
--- gforge/www/tracker/admin/form-updateextrafield.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updateextrafield.php	2005-01-21 00:09:56.000000000 +0100
@@ -11,6 +11,7 @@
 		echo '
 			<h2>'.$Language->getText('tracker_admin_build_boxes','box_update_title',$ath->getName()).'</h2>';
 
+		$id = getStringFromRequest('id');
 		$ac = new ArtifactExtraField($ath,$id);
 		if (!$ac || !is_object($ac)) {
 			$feedback .= 'Unable to create ArtifactExtraField Object';
@@ -19,7 +20,7 @@
 		} else {
 			?>
 			<p>
-			<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&id='.$id.'&boxid='.$box.'&atid='.$ath->getID(); ?>" method="post">
+			<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&id='.$id.'&boxid='.$box.'&atid='.$ath->getID(); ?>" method="post">
 			<input type="hidden" name="update_box" value="y" />
 			<input type="hidden" name="id" value="<?php echo $ac->getID(); ?>" />
 			<p>
diff -urNad gforge/www/tracker/admin/form-updategroup.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updategroup.php
--- gforge/www/tracker/admin/form-updategroup.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updategroup.php	2005-01-21 00:09:56.000000000 +0100
@@ -7,6 +7,7 @@
 		*/
 		$ath->adminHeader(array('title'=>$Language->getText('tracker_admin_update_group','title',$ath->getName()),'pagename'=>'tracker_admin_update_group','titlevals'=>array($ath->getName())));
 
+		$id = getStringFromRequest('id');
 		$ag = new ArtifactGroup($ath,$id);
 		if (!$ag || !is_object($ag)) {
 			$feedback .= 'Unable to create ArtifactGroup Object';
@@ -15,7 +16,7 @@
 		} else {
 			?>
 			<p>
-			<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
+			<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
 			<input type="hidden" name="update_group" value="y" />
 			<input type="hidden" name="id" value="<?php echo $ag->getID(); ?>" />
 			<p>
diff -urNad gforge/www/tracker/admin/form-updatetracker.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updatetracker.php
--- gforge/www/tracker/admin/form-updatetracker.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/form-updatetracker.php	2005-01-21 00:09:56.000000000 +0100
@@ -6,7 +6,7 @@
 
 		?>
 		<p>
-		<form action="<?php echo $PHP_SELF.'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
+		<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&atid='.$ath->getID(); ?>" method="post">
 		<input type="hidden" name="update_type" value="y" />
 		<p>
 		<?php echo $Language->getText('tracker_admin_update_type','name') ?><br />
diff -urNad gforge/www/tracker/admin/index.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/index.php
--- gforge/www/tracker/admin/index.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -21,6 +21,9 @@
 require_once('common/tracker/ArtifactExtraField.class');
 require_once('common/tracker/ArtifactExtraFieldElement.class');
 
+$group_id = getIntFromRequest('group_id');
+$atid = getIntFromRequest('atid');
+
 if ($group_id && $atid) {
 //
 //		UPDATING A PARTICULAR ARTIFACT TYPE
@@ -53,61 +56,61 @@
 		exit_permission_denied();
 	}
 
-	if ($post_changes) {
+	if (getStringFromRequest('post_changes')) {
 		include('updates.php');
 	} 
 //
 //		FORMS TO ADD/UPDATE DATABASE
 //
-	if ($add_extrafield) {  
+	if (getStringFromRequest('add_extrafield')) {  
 
 		include ('form-addextrafield.php');
 
-	} elseif ($add_opt) {
+	} elseif (getStringFromRequest('add_opt')) {
 
 		include ('form-addextrafieldoption.php');
 
-	} elseif ($add_cat) {
+	} elseif (getStringFromRequest('add_cat')) {
 
 		include ('form-addcategory.php');
 
-	} elseif ($copy_opt) {
+	} elseif (getStringFromRequest('copy_opt')) {
 
 		include ('form-extrafieldcopy.php');
 
-	} elseif ($add_group) {
+	} elseif (getStringFromRequest('add_group')) {
 
 		include ('form-addgroup.php');
 
-	} elseif ($add_canned) {
+	} elseif (getStringFromRequest('add_canned')) {
 
 		include ('form-addcanned.php');
 
-	} elseif ($update_canned) {
+	} elseif (getStringFromRequest('update_canned')) {
 
 		include ('form-updatecanned.php');
 
-	} elseif ($update_box) {
+	} elseif (getStringFromRequest('update_box')) {
 
 		include ('form-updateextrafield.php');
 
-	} elseif ($update_opt) {
+	} elseif (getStringFromRequest('update_opt')) {
 
 		include ('form-updateextrafieldelement.php');
 
-	} elseif ($update_cat) {
+	} elseif (getStringFromRequest('update_cat')) {
 
 		include ('form-updatecategory.php');
 
-	} elseif ($update_group) {
+	} elseif (getStringFromRequest('update_group')) {
 
 		include ('form-updategroup.php');
 
-	} elseif ($delete) {
+	} elseif (getStringFromRequest('delete')) {
 
 		include ('form-deletetracker.php');
 
-	} elseif ($update_type) {
+	} elseif (getStringFromRequest('update_type')) {
 
 		include ('form-updatetracker.php');
 
diff -urNad gforge/www/tracker/admin/ind.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/ind.php
--- gforge/www/tracker/admin/ind.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/ind.php	2005-01-21 00:09:56.000000000 +0100
@@ -20,13 +20,23 @@
 
 	$perm =& $group->getPermission( session_get_user() );
 
-	if ($post_changes) {
+	if (getStringFromRequest('post_changes')) {
+		$name = getStringFromRequest('name');
+		$description = getStringFromRequest('description');
+		$is_public = getStringFromRequest('is_public');
+		$allow_anon = getStringFromRequest('allow_anon');
+		$email_all = getStringFromRequest('email_all');
+		$email_address = getStringFromRequest('email_address');
+		$due_period = getStringFromRequest('due_period');
+		$use_resolution = getStringFromRequest('use_resolution');
+		$submit_instructions = getStringFromRequest('submit_instructions');
+		$browse_instructions = getStringFromRequest('browse_instructions');
 
 		if (!$perm || !is_object($perm) || !$perm->isArtifactAdmin()) {
 			exit_permission_denied();
 		}
 
-		if ($add_at) {
+		if (getStringFromRequest('add_at')) {
 			$res=new ArtifactTypeHtml($group);
 			if (!$res->create($name,$description,$is_public,$allow_anon,$email_all,$email_address,
 				$due_period,$use_resolution,$submit_instructions,$browse_instructions)) {
@@ -104,7 +114,7 @@
 
 	?><?php echo $Language->getText('tracker_admin','intro') ?>
 	<p>
-	<form action="<?php echo $PHP_SELF.'?group_id='.$group_id; ?>" method="post">
+	<form action="<?php echo getStringFromServer('PHP_SELF').'?group_id='.$group_id; ?>" method="post">
 	<input type="hidden" name="add_at" value="y" />
 	<p>
 	<?php echo $Language->getText('tracker_admin_update_type','name') ?><br />
diff -urNad gforge/www/tracker/admin/tracker.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/tracker.php
--- gforge/www/tracker/admin/tracker.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/tracker.php	2005-01-21 00:09:56.000000000 +0100
@@ -8,22 +8,22 @@
 //	Reference to build a selection box for a tracker like bugs, etc
 //
 		echo '<p>
-			<a href="'.$PHP_SELF.'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;add_extrafield=1"><strong>'.$Language->getText('tracker_admin','build_selection_box').'</strong></a><br />
+			<a href="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;add_extrafield=1"><strong>'.$Language->getText('tracker_admin','build_selection_box').'</strong></a><br />
 			'.$Language->getText('tracker_admin','build_selection_box_info').'</p>';
 		echo '<p>
-			<a href="'.$PHP_SELF.'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;add_cat=1"><strong>'.$Language->getText('tracker_admin','add_categories').'</strong></a><br />
+			<a href="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;add_cat=1"><strong>'.$Language->getText('tracker_admin','add_categories').'</strong></a><br />
 			'.$Language->getText('tracker_admin','add_categories_info').'</p>';
 		echo '<p>
-			<a href="'.$PHP_SELF.'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;add_group=1"><strong>'.$Language->getText('tracker_admin','add_groups').'</strong></a><br />
+			<a href="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;add_group=1"><strong>'.$Language->getText('tracker_admin','add_groups').'</strong></a><br />
 			'.$Language->getText('tracker_admin','add_group_infos').'</p>';
 		echo '<p>
-			<a href="'.$PHP_SELF.'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;add_canned=1"><strong>'.$Language->getText('tracker_admin','add_canned_responses').'</strong></a><br />
+			<a href="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;add_canned=1"><strong>'.$Language->getText('tracker_admin','add_canned_responses').'</strong></a><br />
 			'.$Language->getText('tracker_admin','add_canned_responses_info').'</p>';
 		echo '<p>
-			<a href="'.$PHP_SELF.'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;delete=1"><strong>'.$Language->getText('tracker_admin','delete').'</strong></a><br />
+			<a href="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;delete=1"><strong>'.$Language->getText('tracker_admin','delete').'</strong></a><br />
 			'.$Language->getText('tracker_admin','permanently_delete_info').'</p>';
 		echo '<p>
-			<a href="'.$PHP_SELF.'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;update_type=1"><strong>'.$Language->getText('tracker_admin','update_preferences').'</strong></a><br />
+			<a href="'.getStringFromServer('PHP_SELF').'?group_id='.$group_id.'&amp;atid='.$ath->getID().'&amp;update_type=1"><strong>'.$Language->getText('tracker_admin','update_preferences').'</strong></a><br />
 			'.$Language->getText('tracker_admin','update_preferences_info').'.</p>';
 
 		$ath->footer(array());
diff -urNad gforge/www/tracker/admin/updates.php /tmp/dpep.cr36JK/gforge/www/tracker/admin/updates.php
--- gforge/www/tracker/admin/updates.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/admin/updates.php	2005-01-21 00:09:56.000000000 +0100
@@ -2,7 +2,11 @@
 		//
 		//	Create an extra field
 		//
-		if ($add_extrafield) {
+		if (getStringFromRequest('add_extrafield')) {
+			$name = getStringFromRequest('name');
+			$field_type = getStringFromRequest('field_type');
+			$attribute1 = getStringFromRequest('attribute1');
+			$attribute2 = getStringFromRequest('attribute2');
 
 			$ab = new ArtifactExtraField($ath);
 		
@@ -22,7 +26,10 @@
 		//
 		//	Add an option to a box
 		//
-		} elseif ($add_opt) {
+		} elseif (getStringFromRequest('add_opt')) {
+			$name = getStringFromRequest('name');
+			$boxid = getStringFromRequest('boxid');
+
 			$ao = new ArtifactExtraFieldElement($ath);
 			if (!$ao || !is_object($ao)) {
 				$feedback .= 'Unable to create ArtifactExtraFieldElement Object';
@@ -43,7 +50,9 @@
 		//
 		//	Add a category
 		//
-		} elseif ($add_cat) {
+		} elseif (getStringFromRequest('add_cat')) {
+			$name = getStringFromRequest('name');
+			$assign_to = getStringFromRequest('assign_to');
 
 			$ac = new ArtifactCategory($ath);
 			if (!$ac || !is_object($ac)) {
@@ -62,7 +71,8 @@
 		//
 		//	Add a group
 		//
-		} elseif ($add_group) {
+		} elseif (getStringFromRequest('add_group')) {
+			$name = getStringFromRequest('name');
 
 			$ag = new ArtifactGroup($ath);
 			if (!$ag || !is_object($ag)) {
@@ -81,7 +91,9 @@
 		//
 		//	Add a canned response
 		//
-		} elseif ($add_canned) {
+		} elseif (getStringFromRequest('add_canned')) {
+			$title = getStringFromRequest('title');
+			$body = getStringFromRequest('body');
 
 			$acr = new ArtifactCanned($ath);
 			if (!$acr || !is_object($acr)) {
@@ -100,7 +112,10 @@
 		//
 		//	Update a canned response
 		//
-		} elseif ($update_canned) {
+		} elseif (getStringFromRequest('update_canned')) {
+			$id = getStringFromRequest('id');
+			$title = getStringFromRequest('title');
+			$body = getStringFromRequest('body');
 
 			$acr = new ArtifactCanned($ath,$id);
 			if (!$acr || !is_object($acr)) {
@@ -121,7 +136,10 @@
 		//
 		//	Copy Categories
 		//
-		} elseif ($copy_opt) {
+		} elseif (getStringFromRequest('copy_opt')) {
+			$copyid = getStringFromRequest('copyid');
+			$selectid = getStringFromRequest('selectid');
+
 			$copy_rows=count($copyid);
 			$tracker_rows=count($selectid);
 			if ($tracker_rows > 0 && $copy_rows > 0) {
@@ -195,7 +213,11 @@
 		//
 		//	Update an extra field
 		//
-		} elseif ($update_box) {
+		} elseif (getStringFromRequest('update_box')) {
+			$id = getStringFromRequest('id');
+			$name = getStringFromRequest('name');
+			$attribute1 = getStringFromRequest('attribute1');
+			$attribute2 = getStringFromRequest('attribute2');
 
 			$ac = new ArtifactExtraField($ath,$id);
 			if (!$ac || !is_object($ac)) {
@@ -216,7 +238,10 @@
 		//
 		//	Update an option 
 		//
-		} elseif ($update_opt) {
+		} elseif (getStringFromRequest('update_opt')) {
+			$id = getStringFromRequest('id');
+			$name = getStringFromRequest('name');
+			$boxid = getStringFromRequest('boxid');
 
 			$ao = new ArtifactExtraFieldElement($ath,$id);
 			if (!$ao || !is_object($ao)) {
@@ -237,7 +262,10 @@
 		//
 		//	Update ArtifactCategory
 		//
-		} elseif ($update_cat) {
+		} elseif (getStringFromRequest('update_cat')) {
+			$id = getStringFromRequest('id');
+			$name = getStringFromRequest('name');
+			$assign_to = getStringFromRequest('assign_to');
 
 			$ac = new ArtifactCategory($ath,$id);
 			if (!$ac || !is_object($ac)) {
@@ -258,7 +286,9 @@
 		//
 		//	Update an artifact group select box
 		//
-		} elseif ($update_group) {
+		} elseif (getStringFromRequest('update_group')) {
+			$id = getStringFromRequest('id');
+			$name = getStringFromRequest('name');
 
 			$ag = new ArtifactGroup($ath,$id);
 			if (!$ag || !is_object($ag)) {
@@ -279,7 +309,16 @@
 		//
 		//	Update a tracker
 		//
-		} elseif ($update_type) {
+		} elseif (getStringFromRequest('update_type')) {
+			$name = getStringFromRequest('name');
+			$description = getStringFromRequest('description');
+			$email_all = getStringFromRequest('email_all');
+			$email_address = getStringFromRequest('email_address');
+			$due_period = getStringFromRequest('due_period');
+			$status_timeout = getStringFromRequest('status_timeout');
+			$use_resolution = getStringFromRequest('use_resolution');
+			$submit_instructions = getStringFromRequest('submit_instructions');
+			$browse_instructions = getStringFromRequest('browse_instructions');
 
 			if (!$ath->update($name,$description,$email_all,$email_address,
 				$due_period,$status_timeout,$use_resolution,$submit_instructions,$browse_instructions)) {
@@ -292,7 +331,9 @@
 		//
 		//	Delete a tracker
 		//
-		} elseif ($delete) {
+		} elseif (getStringFromRequest('delete')) {
+			$sure = getStringFromRequest('sure');
+			$really_sure = getStringFromRequest('really_sure');
 
 			if (!$ath->delete($sure,$really_sure)) {
 				$feedback .= $Language->getText('tracker_admin','error_updating').' : '.$ath->getErrorMessage();
diff -urNad gforge/www/tracker/browse.php /tmp/dpep.cr36JK/gforge/www/tracker/browse.php
--- gforge/www/tracker/browse.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/browse.php	2005-01-21 00:09:56.000000000 +0100
@@ -25,6 +25,18 @@
 	exit_error('Error',$af->getErrorMessage());
 }
 
+$offset = getStringFromRequest('offset',$offset);
+$_sort_col = getStringFromRequest('_sort_col',$_sort_col);
+$_sort_ord = getStringFromRequest('_sort_ord',$_sort_ord);
+$max_rows = getStringFromRequest('max_rows',$max_rows);
+$set = getStringFromRequest('set',$set);
+$_assigned_to = getStringFromRequest('_assigned_to',$_assigned_to);
+$_status = getStringFromRequest('_status',$_status);
+$_category = getStringFromRequest('_category',$_category);
+$_group = getStringFromRequest('_group',$_group);
+$_changed_from = getStringFromRequest('_changed_from',$_changed_from);
+$_resolution = getStringFromRequest('_resolution',$_resolution);
+
 $af->setup($offset,$_sort_col,$_sort_ord,$max_rows,$set,$_assigned_to,$_status,$_category,$_group,$_changed_from, $_resolution);
 $_sort_col=$af->order_col;
 $_sort_ord=$af->sort;
@@ -123,7 +135,7 @@
 
 echo '
 <table width="10%" border="0">
-	<form action="'. $PHP_SELF .'?group_id='.$group_id.'&atid='.$ath->getID().'" method="post">
+	<form action="'. getStringFromServer('PHP_SELF') .'?group_id='.$group_id.'&atid='.$ath->getID().'" method="post">
 	<input type="hidden" name="set" value="custom" />
 	<tr>
 		<td><span style="font-size:smaller">'.$Language->getText('tracker','assignee').':&nbsp;<a href="javascript:help_window(\'/help/tracker.php?helpname=assignee\')"><strong>(?)</strong></a><br />'. $tech_box .'</span></td>'.
@@ -242,7 +254,7 @@
 
 	if ($IS_ADMIN) {
 		echo '
-		<form name="artifactList" action="'. $PHP_SELF .'?group_id='.$group_id.'&atid='.$ath->getID().'" METHOD="POST">
+		<form name="artifactList" action="'. getStringFromServer('PHP_SELF') .'?group_id='.$group_id.'&atid='.$ath->getID().'" METHOD="POST">
 		<input type="hidden" name="func" value="massupdate">';
 	}
 
@@ -271,7 +283,7 @@
 			$art_arr[$i]->getID() .'"> ':'').
 			$art_arr[$i]->getID() .
 			'</td>'.
-		'<td><a href="'.$PHP_SELF.'?func=detail&aid='.
+		'<td><a href="'.getStringFromServer('PHP_SELF').'?func=detail&aid='.
 			$art_arr[$i]->getID() .
 			'&group_id='. $group_id .'&atid='.
 			$ath->getID().'">'.
@@ -291,14 +303,14 @@
 		echo '
 			<tr><td colspan="2">';
 		if ($offset > 0) {
-			echo '<a href="'.$PHP_SELF.'?func=browse&group_id='.$group_id.'&atid='.$ath->getID().'&set='.
+			echo '<a href="'.getStringFromServer('PHP_SELF').'?func=browse&group_id='.$group_id.'&atid='.$ath->getID().'&set='.
 			$set.'&offset='.($offset-50).'"><strong><-- '.$Language->getText('tracker_browse','previous').'</strong></a>';
 		} else {
 			echo '&nbsp;';
 		}
 		echo '</td><td>&nbsp;</td><td colspan="2">';
 		if ($rows >= 50) {
-			echo '<a href="'.$PHP_SELF.'?func=browse&group_id='.$group_id.'&atid='.$ath->getID().'&set='.
+			echo '<a href="'.getStringFromServer('PHP_SELF').'?func=browse&group_id='.$group_id.'&atid='.$ath->getID().'&set='.
 			$set.'&offset='.($offset+50).'"><strong>'.$Language->getText('tracker_browse','next').' --></strong></a>';
 		} else {
 			echo '&nbsp;';
diff -urNad gforge/www/tracker/detail.php /tmp/dpep.cr36JK/gforge/www/tracker/detail.php
--- gforge/www/tracker/detail.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/detail.php	2005-01-21 00:09:56.000000000 +0100
@@ -37,7 +37,7 @@
 				?>&nbsp;<a href="javascript:help_window('/help/tracker.php?helpname=monitor')"><strong>(?)</strong></a>
 			</td>
 			<td>
-				<a href="<?php echo "$PHP_SELF?func=taskmgr&group_id=$group_id&atid=$atid&aid=$aid"; ?>"><?php echo
+				<a href="<?php echo getStringFromServer('PHP_SELF')."?func=taskmgr&group_id=$group_id&atid=$atid&aid=$aid"; ?>"><?php echo
 					html_image('ic/taskman20w.png','20','20',array()); ?><strong><?php echo $Language->getText('tracker_detail','build_task_relation') ?></strong></a>
 			</td>
 		</tr>
@@ -71,7 +71,7 @@
 
 		<tr><td colspan="2"><strong><?php echo $Language->getText('tracker','summary') ?>:</strong><br /><?php echo $ah->getSummary(); ?></td></tr>
 
-		<form action="<?php echo $PHP_SELF; ?>?group_id=<?php echo $group_id; ?>&atid=<?php echo $ath->getID(); ?>" METHOD="POST">
+		<form action="<?php echo getStringFromServer('PHP_SELF'); ?>?group_id=<?php echo $group_id; ?>&atid=<?php echo $ath->getID(); ?>" METHOD="POST">
 
 		<tr><td colspan="2">
 			<br />
@@ -91,7 +91,7 @@
 	if (!session_loggedin()) {
 		?>
 		<h3><FONT COLOR="RED">
-		<?php echo $Language->getText('tracker','please_login',array('<a href="/account/login.php?return_to='.urlencode($REQUEST_URI).'">','</a>')) ?></FONT></h3><br />
+		<?php echo $Language->getText('tracker','please_login',array('<a href="/account/login.php?return_to='.urlencode(getStringFromServer('REQUEST_URI')).'">','</a>')) ?></FONT></h3><br />
 		<?php echo $Language->getText('tracker','insert_email') ?>
 		<p>
 		<input type="TEXT" name="user_email" SIZE="20" MAXLENGTH="40">
diff -urNad gforge/www/tracker/download.php /tmp/dpep.cr36JK/gforge/www/tracker/download.php
--- gforge/www/tracker/download.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/download.php	2005-01-21 00:09:56.000000000 +0100
@@ -20,7 +20,7 @@
 require_once('common/tracker/ArtifactType.class');
 require_once('common/tracker/ArtifactType.class');
 
-$arr=explode('/',$REQUEST_URI);
+$arr=explode('/',getStringFromServer('REQUEST_URI'));
 $group_id=$arr[3];
 $atid=$arr[4];
 $aid=$arr[5];
diff -urNad gforge/www/tracker/include/ArtifactFileHtml.class /tmp/dpep.cr36JK/gforge/www/tracker/include/ArtifactFileHtml.class
--- gforge/www/tracker/include/ArtifactFileHtml.class	2004-02-19 00:26:16.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/include/ArtifactFileHtml.class	2005-01-21 00:09:56.000000000 +0100
@@ -29,14 +29,15 @@
 		return $this->ArtifactFile($Artifact,$data); 
 	}
 
-	function upload($input_file,$input_file_name,$input_file_type,$description) {
+	function upload($input_file,$description) {
 		if (!util_check_fileupload($input_file)) {
 			$this->setError('ArtifactFile: Invalid filename');
 			return false;
 		}
-		$size = @filesize($input_file);
-		$input_data = fread(fopen($input_file, 'r'), $size);
-		return $this->create($input_file_name,$input_file_type,$size,$input_data,$description);
+		$filename = $input_file['tmp_name'];
+		$size = @filesize($filename);
+		$input_data = fread(fopen($filename, 'r'), $size);
+		return $this->create($input_file['name'],$input_file['type'],$size,$input_data,$description);
 	}
 
 }
diff -urNad gforge/www/tracker/include/ArtifactTypeHtml.class /tmp/dpep.cr36JK/gforge/www/tracker/include/ArtifactTypeHtml.class
--- gforge/www/tracker/include/ArtifactTypeHtml.class	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/include/ArtifactTypeHtml.class	2005-01-21 00:09:56.000000000 +0100
@@ -29,7 +29,7 @@
 	}
 
 	function header($params) {
-		global $DOCUMENT_ROOT, $HTML, $Language, $sys_use_tracker;
+		global $HTML, $Language, $sys_use_tracker;
 		if (!$sys_use_tracker) {
 			exit_disabled();
 		}
diff -urNad gforge/www/tracker/index.php /tmp/dpep.cr36JK/gforge/www/tracker/index.php
--- gforge/www/tracker/index.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,8 @@
 	exit_disabled();
 }
 
+$group_id = getIntFromRequest('group_id');
+$atid = getIntFromRequest('atid');
 
 if ($group_id && $atid) {
 	include('tracker.php');
diff -urNad gforge/www/tracker/mod-limited.php /tmp/dpep.cr36JK/gforge/www/tracker/mod-limited.php
--- gforge/www/tracker/mod-limited.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/mod-limited.php	2005-01-21 00:09:56.000000000 +0100
@@ -36,12 +36,12 @@
 				?>&nbsp;<a href="javascript:help_window('/help/tracker.php?helpname=monitor')"><strong>(?)</strong></a>
 			</td>
 			<td>
-				<a href="<?php echo "$PHP_SELF?func=taskmgr&group_id=$group_id&atid=$atid&aid=$aid"; ?>"><?php echo 
+				<a href="<?php echo getStringFromServer('PHP_SELF')."?func=taskmgr&group_id=$group_id&atid=$atid&aid=$aid"; ?>"><?php echo 
 					html_image('ic/taskman20w.png','20','20',array()); ?><strong><?php echo $Language->getText('tracker_mod','build_task_relation')?></strong></a>
 			</td>
 		</tr>
 <?php } ?>
-	<form action="<?php echo $PHP_SELF; ?>?group_id=<?php echo $group_id; ?>&atid=<?php echo $ath->getID(); ?>" METHOD="POST" enctype="multipart/form-data">
+	<form action="<?php echo getStringFromServer('PHP_SELF'); ?>?group_id=<?php echo $group_id; ?>&atid=<?php echo $ath->getID(); ?>" METHOD="POST" enctype="multipart/form-data">
 	<input type="hidden" name="func" value="postmod">
 	<input type="hidden" name="artifact_id" value="<?php echo $ah->getID(); ?>">
 
diff -urNad gforge/www/tracker/reporting/index.php /tmp/dpep.cr36JK/gforge/www/tracker/reporting/index.php
--- gforge/www/tracker/reporting/index.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/reporting/index.php	2005-01-21 00:09:56.000000000 +0100
@@ -29,6 +29,14 @@
 require_once('common/reporting/Report.class');
 require_once('www/tracker/include/ArtifactTypeHtml.class');
 
+$sw = getStringFromRequest('sw');
+$group_id = getIntFromRequest('group_id');
+$atid = getStringFromRequest('atid');
+$area = getStringFromRequest('area');
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 $report=new Report();
 if ($report->isError()) {
 	exit_error($report->getErrorMessage());
@@ -93,7 +101,7 @@
 ?>
 <h3>Project Activity</h3>
 <p>
-<form action="<?php echo $PHP_SELF; ?>" method="get">
+<form action="<?php echo getStringFromServer('PHP_SELF'); ?>" method="get">
 <input type="hidden" name="sw" value="<?php echo $sw; ?>">
 <input type="hidden" name="group_id" value="<?php echo $group_id; ?>">
 <table><tr>
diff -urNad gforge/www/tracker/reporting/trackeract_graph.php /tmp/dpep.cr36JK/gforge/www/tracker/reporting/trackeract_graph.php
--- gforge/www/tracker/reporting/trackeract_graph.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/reporting/trackeract_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,6 +30,12 @@
 require_once($sys_path_to_jpgraph.'jpgraph_line.php');
 require_once('common/reporting/ReportTrackerAct.class');
 
+$group_id = getIntFromRequest('group_id');
+$atid = getStringFromRequest('atid');
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
+
 if (!$SPAN) {
 	$SPAN=REPORT_TYPE_MONTHLY;
 }
diff -urNad gforge/www/tracker/reporting/trackerpie_graph.php /tmp/dpep.cr36JK/gforge/www/tracker/reporting/trackerpie_graph.php
--- gforge/www/tracker/reporting/trackerpie_graph.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/reporting/trackerpie_graph.php	2005-01-21 00:09:56.000000000 +0100
@@ -35,6 +35,12 @@
 
 session_require( array('group'=>$sys_stats_group) );
 
+$group_id = getIntFromRequest('group_id');
+$atid = getStringFromRequest('atid');
+$area = getStringFromRequest('area');
+$SPAN = getStringFromRequest('SPAN');
+$start = getStringFromRequest('start');
+$end = getStringFromRequest('end');
 //
 //	Create Report
 //
diff -urNad gforge/www/tracker/taskmgr.php /tmp/dpep.cr36JK/gforge/www/tracker/taskmgr.php
--- gforge/www/tracker/taskmgr.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/taskmgr.php	2005-01-21 00:09:56.000000000 +0100
@@ -26,6 +26,9 @@
 require_once('common/pm/ProjectGroupFactory.class');
 require_once('common/pm/ProjectTaskFactory.class');
 
+$group_project_id = getIntFromRequest('group_project_id');
+$aid = getIntFromRequest('aid');
+
 $a=new Artifact($ath,$aid);
 if (!$a || !is_object($a)) {
 	exit_error('ERROR','Artifact Could Not Be Created');
@@ -34,7 +37,16 @@
 //
 //	Add a relationship from this artifact to an existing task
 //
-if ($add_to_task) {
+if (getStringFromRequest('add_to_task')) {
+	$group = getStringFromRequest('group');
+	$offset = getStringFromRequest('offset');
+	$_order = getStringFromRequest('_order');
+	$max_rows = getStringFromRequest('max_rows');
+	$set = getStringFromRequest('set');
+	$_assigned_to = getStringFromRequest('_assigned_to');
+	$_status = getStringFromRequest('_status');
+	$_category_id = getStringFromRequest('_category_id');
+
 	$pg=new ProjectGroup($group,$group_project_id);
 	if (!$pg || !is_object($pg)) {
 		exit_error('Error','Could Not Get ProjectGroup');
@@ -66,7 +78,7 @@
 	echo '
 		<h3>'.$Language->getText('tracker_taskmgr','build_relationships').'</h3>
 		<p>
-		<form name="foo" action="'. $PHP_SELF .'?func=taskmgr&group_id='.$group_id.'&atid='.$atid.'&aid='.$aid.'" method="post">
+		<form name="foo" action="'. getStringFromServer('PHP_SELF') .'?func=taskmgr&group_id='.$group_id.'&atid='.$atid.'&aid='.$aid.'" method="post">
 		<strong>'.$Language->getText('tracker_taskmgr','tracker_item').':</strong> [#'.$a->getID().'] '.$a->getSummary().'<p>
 		<strong>'.$Language->getText('tracker_taskmgr','task_manager_project').':</strong><br />';
 	echo $pg->getName().'
@@ -84,14 +96,14 @@
 //
 //	Add the relationship and display finished message
 //
-} elseif ($done_adding) {
+} elseif (getStringFromRequest('done_adding')) {
 
 	Header ('Location: /pm/task.php?group_id='.$group_id.'&group_project_id='.$group_project_id.'&project_task_id='.$project_task_id.'&func=addartifact&add_artifact_id[]='. $a->getID() );
 
 //
 //	Create a new task and relate it to this artifact
 //
-} elseif ($new_task) {
+} elseif (getStringFromRequest('new_task')) {
 
 	Header ('Location: /pm/task.php?group_id='.$group_id.'&group_project_id='.$group_project_id.'&func=addtask&related_artifact_summary='. urlencode($a->getSummary()) .'&related_artifact_id='. $a->getID() );
 
@@ -116,7 +128,7 @@
 		'atid'=>$ath->getID(),'sectionvals'=>array($group->getPublicName())));
 
 	echo '<h3>'.$Language->getText('tracker_taskmgr','build_relationships').'</h3>
-		<p><form name="foo" action="'. $PHP_SELF .'?func=taskmgr&group_id='.$group_id.'&atid='.$atid.'&aid='.$aid.'" method="post">
+		<p><form name="foo" action="'. getStringFromServer('PHP_SELF') .'?func=taskmgr&group_id='.$group_id.'&atid='.$atid.'&aid='.$aid.'" method="post">
 		<strong>'.$Language->getText('tracker_taskmgr','tracker_item').':</strong> [#'.$a->getID().'] '.$a->getSummary().'<p>
 		<strong>'.$Language->getText('tracker_taskmgr','task_manager_project').':</strong><br />
 		<select name="group_project_id">';
diff -urNad gforge/www/tracker/tracker.php /tmp/dpep.cr36JK/gforge/www/tracker/tracker.php
--- gforge/www/tracker/tracker.php	2005-01-19 22:18:54.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/tracker/tracker.php	2005-01-21 00:09:56.000000000 +0100
@@ -30,13 +30,22 @@
 		exit_error($Language->getText('general','error'), $ath->getErrorMessage());
 	}
 }
-switch ($func) {
+switch (getStringFromRequest('func')) {
 
 	case 'add' : {
 		include ('add.php');
 		break;
 	}
 	case 'postadd' : {
+		$user_email = getStringFromRequest('user_email');
+		$category_id = getIntFromRequest('category_id');
+		$artifact_group_id = getIntFromRequest('artifact_group_id');
+		$summary = getStringFromRequest('summary');
+		$details = getStringFromRequest('details');
+		$assigned_to = getStringFromRequest('assigned_to');
+		$priority = getStringFromRequest('priority');
+		$extra_fields = getStringFromRequest('extra_fields');
+
 		/*
 			Create a new Artifact
 
@@ -58,14 +67,17 @@
 				//
 				//	Attach file to this Artifact.
 				//
-				if ($add_file) {
+				if (getStringFromRequest('add_file')) {
+					$input_file = getUploadedFile('input_file');
+					$file_description = getStringFromRequest('file_description');
+
 					$afh=new ArtifactFileHtml($ah);
 					if (!$afh || !is_object($afh)) {
 						$feedback .= 'Could Not Create File Object';
 //					} elseif ($afh->isError()) {
 //						$feedback .= $afh->getErrorMessage();
 					} else {
-						if (!$afh->upload($input_file,$input_file_name,$input_file_type,$file_description)) {
+						if (!$afh->upload($input_file,$file_description)) {
 							$feedback .= ' Could Not Attach File to Item: '.$afh->getErrorMessage();
 						}
 					}
@@ -77,6 +89,14 @@
 		break;
 	}
 	case 'massupdate' : {
+		$artifact_id_list = getStringFromRequest('artifact_id_list');
+		$priority = getStringFromRequest('priority');
+		$status_id = getStringFromRequest('status_id');
+		$category_id = getStringFromRequest('category_id');
+		$artifact_group_id = getStringFromRequest('artifact_group_id');
+		$resolution_id = getStringFromRequest('resolution_id');
+		$assigned_to = getStringFromRequest('assigned_to');
+
 		$count=count($artifact_id_list);
 
 		if (!$ath->userIsAdmin()) {
@@ -122,6 +142,19 @@
 		break;
 	}
 	case 'postmod' : {
+		$artifact_id = getIntFromRequest('artifact_id');
+		$priority = getIntFromRequest('priority');
+		$status_id = getIntFromRequest('status_id');
+		$category_id = getIntFromRequest('category_id');
+		$artifact_group_id = getIntFromRequest('artifact_group_id');
+		$resolution_id = getIntFromRequest('resolution_id');
+		$assigned_to = getStringFromRequest('assigned_to');
+		$summary = getStringFromRequest('summary');
+		$canned_response = getStringFromRequest('canned_response');
+		$details = getStringFromRequest('details');
+		$artfact_type_id = getIntFromRequest('artfact_type_id');
+		$extra_fields = getStringFromRequest('extra_fields');
+	
 		/*
 			Technicians can modify limited fields - to be certain
 			no one is hacking around, we override any fields they don't have
@@ -156,7 +189,10 @@
 			//
 			//  Attach file to this Artifact.
 			//
-			if ($add_file) {
+			if (getStringFromRequest('add_file')) {
+				$input_file = getUploadedFile('input_file');
+				$file_description = getStringFromRequest('file_description');
+
 				$afh=new ArtifactFileHtml($ah);
 				if (!$afh || !is_object($afh)) {
 					$feedback .= 'Could Not Create File Object';
@@ -166,7 +202,7 @@
 					if (!util_check_fileupload($input_file)) {
 						exit_error("Error","Invalid filename");
 					}
-					if (!$afh->upload($input_file,$input_file_name,$input_file_type,$file_description)) {
+					if (!$afh->upload($input_file,$file_description)) {
 						$feedback .= ' <br />'.$Language->getText('tracker','file_upload_upload').':'.$afh->getErrorMessage();
 						$was_error=true;
 					} else {
@@ -178,6 +214,7 @@
 			//
 			//	Delete list of files from this artifact
 			//
+			$delete_file = getStringFromRequest('delete_file');
 			if ($delete_file) {
 				$count=count($delete_file);
 				for ($i=0; $i<$count; $i++) {
@@ -207,6 +244,10 @@
 		break;
 	}
 	case 'postaddcomment' : {
+		$artifact_id = getIntFromRequest('artifact_id');
+		$details = getStringFromRequest('details');
+		$user_email = getStringFromRequest('user_email');
+
 		/*
 			Attach a comment to an artifact
 			Used by non-admins
@@ -228,6 +269,8 @@
 		break;
 	}
 	case 'monitor' : {
+		$artifact_id = getIntFromRequest('artifact_id');
+
 		$ah=new ArtifactHtml($ath,$artifact_id);
 		if (!$ah || !is_object($ah)) {
 			exit_error('ERROR','Artifact Could Not Be Created');
@@ -304,6 +347,8 @@
 		break;
 	}
 	case 'detail' : {
+		$aid = getStringFromRequest('aid');
+
 		//
 		//	users can modify their own tickets if they submitted them
 		//	even if they are not artifact admins
diff -urNad gforge/www/users /tmp/dpep.cr36JK/gforge/www/users
--- gforge/www/users	2005-01-19 22:18:45.000000000 +0100
+++ /tmp/dpep.cr36JK/gforge/www/users	2005-01-21 00:09:56.000000000 +0100
@@ -28,7 +28,7 @@
 require_once('pre.php');    
 require_once('common/include/User.class');    
 
-$expl_pathinfo = explode('/', $REQUEST_URI);
+$expl_pathinfo = explode('/', getStringFromServer('REQUEST_URI'));
 
 if (!$expl_pathinfo[2]) {
 	exit_error($Language->getText('general','error'),$Language->getText('users','no_user_name'));
