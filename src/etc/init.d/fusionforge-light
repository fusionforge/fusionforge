#!/bin/bash
### BEGIN INIT INFO
# Provides:          fusionforge-light
# Required-Start:    $local_fs $remote_fs $network $syslog $named postgresql
# Required-Stop:     $local_fs $remote_fs $network $syslog $named postgresql
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# X-Interactive:     true
# Short-Description: Start/stop FusionForge's system tasks daemon
### END INIT INFO
# Copyright (C) 2014  Inria (Sylvain Beucler)

PIDFILE=/var/run/fusionforge-light
DAEMON=$(forge_get_config binary_path)/light

function check_running() {
    if kill -0 $(cat $PIDFILE) 2>/dev/null; then
	return 0
    else
	return 1
    fi
}

case $1 in
    start)
	if check_running; then
	    echo "Already running"
	else
	    $DAEMON &
	    echo $! > $PIDFILE
	    if !check_running; then
		echo "Failed"
		rm -f $PIDFILE
		return 1
	    fi
	fi
	;;
    stop)
	kill $(cat $PIDFILE)
	rm -f $PIDFILE
	;;
    status)
	if check_running; then
	    echo "Running"
	else
	    echo "Stopped"
	    return 3
	fi
	;;
    restart)
	$0 stop
	$0 start
	;;
esac
